function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}$.Class.extend("bizagi.kendo.templates.services.service",{customTemplateFile:bizagi.loader.getResource("tmpl","bizagi.overrides."+bizagi.detectDevice()+".custom.templates"),cachedFiles:{},cachedTemplates:{},customTemplates:{}},{init:function(e){this.localization=e,this.cssRegex=/{{css "(.+)"}}/g,this.loadingFileDeferred={}},loadCustomTemplates:function(){var e=this,t=new $.Deferred;return $.when(this.getTemplateFile(this.Class.customTemplateFile)).done((function(r){var i=$("<div />").html(r),a=$("script",i);$.each(a,(function(t,r){r=$(r),e.Class.customTemplates[r.attr("id")]=r.html()})),t.resolve()})),t.promise()},getTemplate:function(e,t){var r=!1;if(e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),bizagi.enableCustomizations){var i=this.getHash(e);this.Class.customTemplates[i]&&(r=!0)}return r||"release"!==bizagi.loader.environment?this.internalGetTemplate(e,t).pipe((function(e){return e})):this.getTemplateForRelease(e,t).pipe((function(e){return e}))},getTemplateWidget:function(e,t){var r=!1;if(e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),bizagi.enableCustomizations){var i=this.getHash(e);this.Class.customTemplates[i]&&(r=!0)}return r||"release"!==bizagi.loader.environment?this.internalGetTemplate(e,t).pipe((function(e){return e})):this.getTemplateForRelease(e,t).then((function(e){return e}))},getTemplateWebpart:function(e,t){return e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),this.internalGetTemplate(e,t).pipe((function(e){return e}))},getTemplateForRelease:function(e,t){var r,i,a=this,s=$.Deferred();return a.containsHash(e)?(r=a.getUrlWithoutHashes(e),i=a.getHash(e)):(r=e,i=""),a.Class.cachedTemplates[r]?s.resolve(a.processAndReturnTemplate(r,i,t)):$.when(a.loadTemplateFileForRelease(r)).done((function(){s.resolve(a.processAndReturnTemplate(r,i,t))})),s.promise()},loadTemplateFileForRelease:function(e){var t=this,r=$.Deferred();return t.Class.cachedTemplates[e]?t.Class.cachedTemplates[e]:t.loadingFileDeferred[e]?($.when(t.loadingFileDeferred[e]).done((function(){r.resolve(t.Class.cachedTemplates[e])})),r.promise()):(t.loadingFileDeferred[e]=$.Deferred(),$.when($.ajax({url:e,dataType:"text"}),t.localization.ready()).done((function(i){var a,s,o;for(a in i||r.reject(""),"string"!=typeof i&&(i=JSON.parse(i[0])),t.Class.cachedTemplates[e]=i,i)i.hasOwnProperty(a)&&(s=i[a],o=(o=t.localization.translate(s)).replace(t.cssRegex,""),t.Class.cachedTemplates[e][a]=o);t.loadingFileDeferred[e].resolve(),r.resolve(i)})),r.promise())},processAndReturnTemplate:function(e,t,r){var i=this.Class.cachedTemplates[r];if(!i){if(!(i=this.Class.cachedTemplates[e][t]))throw"template "+i+"doesn't exist";this.Class.cachedTemplates[r]=i}return i},internalGetTemplate:function(e,t){var r=this,i=new $.Deferred,a=this.Class.cachedTemplates[t];if(a)i.resolve(a);else if(r.containsHash(e)){var s=r.getUrlWithoutHashes(e),o=r.getHash(e);if(r.Class.customTemplates[s]&&r.Class.customTemplates[s][t])return i.resolve(r.Class.customTemplates[o]),i.promise();$.when(r.getTemplatePart(s,o,t)).done((function(e){r.Class.cachedTemplates[t]=e,i.resolve(e)}))}else $.when(r.getTemplateFile(e)).done((function(e){r.Class.cachedTemplates[t]=e,i.resolve(e)}));return i.promise()},getTemplatePart:function(e,t){var r=this,i=new $.Deferred;return $.when(r.loadingTemplatePartExecution).done((function(){r.loadingTemplatePart=!0,r.loadingTemplatePartExecution=new $.Deferred,$.when(r.getTemplateFile(e)).done((function(a){var s=$("<div />").html(a),o=$("#"+t,s);"debug"===BIZAGI_ENVIRONMENT&&0===o.length&&console.warn("No template part ("+t+") found in content for:"+e),a=o.html(),r.loadingTemplatePartExecution.resolve(),r.loadingTemplatePart=!0,i.resolve(a)}))})),i.promise()},getTemplateFile:function(e){var t=this,r=this.Class.cachedFiles[e];return r||$.when($.ajax({url:e,dataType:"text"}),t.localization.ready()).pipe((function(r){if(!r)return"";"string"!=typeof r&&(r=r[0]);var i=t.localization.translate(r),a=i.match(t.cssRegex);return a&&$.each(a,(function(e,r){var i=r.replace(t.cssRegex,"$1");bizagi.loader.loadFile({src:i,type:"css",environment:"debug"})})),i=i.replace(t.cssRegex,""),t.Class.cachedFiles[e]="string"==typeof i?i:i[0].outerHTML,i}))},containsHash:function(e){return-1!==e.indexOf("#")},getHash:function(e){return e.substring(e.indexOf("#")+1,e.length)},getUrlWithoutHashes:function(e){return e.substring(0,e.indexOf("#"))}}),bizagi.override.enableMSF||(jQuery.fn.fastEmpty=function(){$(this).kendoTmplEmpty()},jQuery.fasttmpl=function(e,t){return jQuery.kendoTmpl(e,t)},jQuery.cacheTemplate=function(e,t){jQuery.cacheKendoTemplate(e,t)}),jQuery.fn.kendoTmplEmpty=function(){this.children().remove();var e=$(this);e.hasClass("ui-bizagi-component-loading")&&e.loadingMessage()},jQuery.kendoTmpl=function(e,t){if(void 0===e)return"";e=(e=e.replace(/(\n*)|(\r*)|(\t*)/g,"")).replace(/\s+/g," ");var r=kendo.template(e,{useWithBlock:!1})(t);return $.trim(r.replace(/>\s*</g,"><"))},jQuery.kendoTmpls=function(e,t){return $(jQuery.kendoTmpl(e,t))},jQuery.cacheKendoTemplate=function(e,t){var r=bizagi.kendo.templates.services.service.cachedTemplates[e];return jQuery.kendoTmpl(r,t)},function(){var e,t,r=window.steal||{},i=window.bizagi||{};i.loader=i.loader||{},"release"===i.loader.environment&&(t={registerMobileWebpart:function(e){"string"==typeof e&&(e=[e]),this.webparts=this.webparts||{},e.map(function(e){this.webparts[e]||(this.webparts[e]={class:"bizagi.workportal.webparts."+e,devices:null,location:"",name:e,js:[],css:[],tmpl:[]}),this.webparts[e].initialized=!0,this.webparts[e].initializing=!1,this.webparts[e].loadingDeferred=this.webparts[e].loadingDeferred||new $.Deferred}.bind(this))}},Object.keys(t).map((function(e){i.loader[e]=t[e]})),e=!1,r.origRequest=r.request,r.request=function(t,a,s){if(!(arguments[0]&&arguments[0].src&&(arguments[0].src+"").match(/\/workportalflat\/webparts\//i)))return this.origRequest(t,a,s);var o=i.detectDevice().replace(/[^a-z0-9]+/gi,"");if(!e){var n=i.loader.useAbsolutePath?i.loader.basePath+i.loader.getLocationPrefix():""+i.loader.getLocationPrefix(),l=n+"jquery/workportalflat/production/"+o+"/webpart."+o+".production.js?build="+i.loader.build,c=n+"jquery/workportalflat/production/"+o+"/webpart."+o+".production.css?build="+i.loader.build;e=!0,i.loader.loadFile({type:"js",src:l}),i.loader.loadFile({type:"css",src:c})}var d=arguments[0].id+"";i.loader.registerMobileWebpart(o),r.resources[d].completed.resolve(),r.resources[d].loaded.resolve(),r.resources[d].loading=!1,r.resources[d].executing=!1,r.resources[d].options.text=JSON.stringify(i.loader.webparts[o]),a(r.resources[d].options.text)})}(),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.smartphone=void 0!==bizagi.util.smartphone?bizagi.util.smartphone:{},bizagi.util.tablet=void 0!==bizagi.util.tablet?bizagi.util.tablet:{},bizagi.util.mobility=void 0!==bizagi.util.mobility?bizagi.util.mobility:{},bizagi.util.smartphone.startLoading=function(){bizagi.loading.start()},bizagi.util.smartphone.stopLoading=function(){bizagi.loading.stop()},bizagi.util.mobility.getResource=function(e,t){return bizagi.localization.getResource(e,t)},bizagi.loader.initWebpartOld=bizagi.loader.initWebpart,bizagi.loader.initWebpart=function(e,t,r){return null!=e&&(e.initialized?steal.then((function(){r&&r()})):e.devices?void 0!==e.devices[t]?bizagi.loader.initWebpartOld($.extend(e,e.devices[t]),t,r):console.log("No existe la definicion del device "+t+" Para el webpart "+e.name):bizagi.loader.initWebpartOld(e,t,r)),this},bizagi.util.initWebpart=function(e,t){var r=new $.Deferred;return t=t||bizagi.detectDevice(),e.initialized?r.resolve():e.initializing?$.when(e.loadingDeferred.promise()).done((function(){r.resolve()})):(e.loadingDeferred=new $.Deferred,e.initializing=!0,bizagi.loader.initWebpart(e,t,(function(){e.loadingDeferred.resolve(),e.initializing=!1,r.resolve()}))),r.promise()},bizagi.util.isDate=function(e){var t=!1,r="string"==typeof(e=e||"")?e.split("/"):"";try{if(3==r.length)new Date(e).getYear()>0&&(t=!0)}catch(e){t=!1}return t},bizagi.util.setContext=function(e,t){e=e||{},(t=t||!1)&&(bizagi.context={}),$.each(e,(function(e,t){bizagi.context[e]=t}))},bizagi.getTimeAgo=function(e){return $.timeago(new Date(e))},bizagi.getGroupedData=function(e){var t={},r=new Date,i=r.getFullYear(),a=r.getMonth(),s=r.getDate();e=bizagi.util.isDate(e)?e:r;var o=new Date(e),n=o.getMonth(),l=o.getFullYear(),c=o.getDate();return new Date(l,n,c,0,0,0)-new Date(i,a,s,0,0,0)<0?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-overdue"),t.status="red"):s===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-today"),t.status="yellow"):s+1===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),t.status="yellow"):(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-upcomming"),t.status="green"),t},bizagi.util.getTaskStatus=function(e){var t=new Date,r=t.getMonth(),i=t.getDate(),a=t.getFullYear(),s=e||"";if(!bizagi.util.isDate(s))return"--";var o=new Date(s),n=o.getDate(),l=o.getMonth(),c=o.getFullYear();return new Date(c,l,n,0,0,0)-new Date(a,r,i,0,0,0)<0?bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM"):r===l&&i===n?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):r===l&&i+1===n?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM")},bizagi.util.formatDataType=function(e,t){return"NText"===t||"VarChar"===t?"<div>"+bizagi.util.replaceLineBreak(e)+"</div>":"Boolean"===t?bizagi.util.formatBoolean(e):"Int"===t||"BigInt"===t||"SmallInt"===t||"TinyInt"===t?e:"Money"===t?bizagi.util.formatMonetaryCell(e):"Float"===t||"Real"===t?bizagi.util.formatDecimalCell(e):"DateTime"===t?bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" "+bizagi.localization.getResource("timeFormat")):e},bizagi.util.formatDateTime=function(e){if(e="string"!=typeof(e=null==e?"":e)?e.toString():e,Date.parse(e)){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()+" "+((t.getHours()<12&&e.toLowerCase().indexOf("pm")>0?t.getHours()+12:t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()))}return e},bizagi.util.formatMonetaryCell=function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},bizagi.util.formatDecimal=function(e,t){var r=$("<i/>").text(e);return r.formatCurrency&&r.formatCurrency(t),r.text()},bizagi.util.syntaxHighlight=function(e){return void 0===e||null==e?"":(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),"<span class='"+t+"'>"+e+"</span>"}))},bizagi.util.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.util.tablet=void 0!==bizagi.util.tablet?bizagi.util.tablet:{},bizagi.util.mobility=void 0!==bizagi.util.mobility?bizagi.util.mobility:{},bizagi.environment="undefined"!=typeof BIZAGI_ENVIRONMENT?BIZAGI_ENVIRONMENT:queryString.environment||"debug",bizagi.util.tablet.startLoading=function(){bizagi.loading.start()},bizagi.util.tablet.stopLoading=function(){bizagi.loading.stop()},bizagi.util.tablet.startkendo=function(e){void 0===bizagi.kendoMobileApplication?(bizagi.kendoMobileApplication=new kendo.mobile.Application($("body"),{transition:"slide",skin:"flat",initial:"initKendo",init:function(t){kendo.ui.progress($(".km-flat"),!0),e.started&&e.started()}}),bizagi.kendoMobileApplication.bizagiNavigate=function(e,t){this.navigate(e,t)}):e.started&&e.started()},$.Class.extend("bizagi.workportal.controllers.controller",{},{init:function(e,t,r){this.workportalFacade=e,this.dataService=t,this.resources=bizagi.localization,this.container=r.container||document,this.componentContainers={},bizagi.workportal.controllers.instances={},bizagi.workportal.controllers.instances.controller=this},getWorkportal:function(){return this.workportalFacade.workportal},publish:function(e,t){return $(this.container).triggerHandler(e,t)},subscribe:function(e,t){$(this.container).bind(e,t)},subscribeEvent:function(e,t){$(document).bind(e,t)},subscribeOneTime:function(e,t){$(this.container).one(e,t)},unsubscribe:function(e,t){t?$(this.container).unbind(e,t):$(this.container).unbind(e)},render:function(){bizagi.showMessageBox("controllers render","Error");var e=this,t=new $.Deferred;return $.when(e.renderContent()).done((function(){e.postRender(),t.resolve(e.getContent())})),t.promise()},getContent:function(){return this.content},getResource:function(e,t){return this.resources.getResource(e,t)},renderContent:function(){return""},postRender:function(){}}),$.Class.extend("bizagi.workportal.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.workportal.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return void 0===this.endPoints[e]&&bizagi.log("Url not found","No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.workportal.services.getEndPoints(e)}}),bizagi.workportal=void 0!==bizagi.workportal?bizagi.workportal:{},bizagi.workportal.services=void 0!==bizagi.workportal.services?bizagi.workportal.services:{},bizagi.workportal.services.endPoints=[],bizagi.workportal.services.getEndPoints=function(e){if("workportal"==e.context){var t,r=(t={"user-handler":e.proxyPrefix+"RestServices/UserHandler.ashx","process-handler":e.proxyPrefix+"RestServices/ProcessHandler.ashx","query-handler":e.proxyPrefix+"Rest/Handlers/Query","case-handler":e.proxyPrefix+"RestServices/CaseHandler.ashx","query-form":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-edit":e.proxyPrefix+"App/ListaDetalle/SaveQuery.aspx","query-form-delete":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-delete-cube":e.proxyPrefix+"Rest/Queries/Cubes/{idCube}","favorites-handler":e.proxyPrefix+"RestServices/FavoritesHandler.ashx","file-handler":e.proxyPrefix+"RestServices/EntityHandler.ashx","login-handler":e.proxyPrefix+"Rest/Users/UserAuthentication","login-handlerv10":e.proxyPrefix+"RestServices/UserHandler.ashx?action=authenticateUser&userName={0}&password={1}&domain={2}","logoff-handler":e.proxyPrefix+"RestServices/UserHandler.ashx?action=logOff","logoff-handlerv1":e.proxyPrefix+"Rest/Users/LogOff","authorization-handler-getMenuAuthorization":e.proxyPrefix+"Rest/Authorization/MenuAuthorization","authorization-handler-isCaseCreationAuthorized":e.proxyPrefix+"Rest/Authorization/Processes/{0}/IsCaseCreationAuthorized","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-releaseActivity":e.proxyPrefix+"Rest/Cases/{idCase}/ReleaseActivity","case-handler-getCasesList":e.proxyPrefix+"Rest/Processes/SearchCases","case-handler-getActivityList":e.proxyPrefix+"Api/Cases/Activities","offline-getProcessTree":e.proxyPrefix+"Rest/Processes/OfflineProcessTree","offline-tasks":e.proxyPrefix+"Api/Cases/GetOfflineTasks","offline-getForms":e.proxyPrefix+"Rest/RenderForm/offlineForms","offline-sendForm":e.proxyPrefix+"Rest/Cases/SaveAsynchWorkItemOffLine","case-handler-getCaseTasks":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks","case-handler-getCaseEvents":e.proxyPrefix+"Rest/Cases/{idCase}/Events","case-handler-getCaseSubprocesses":e.proxyPrefix+"Rest/Cases/{idCase}/Subprocesses","case-handler-getTaskAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks/{idTask}/Assignees","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Assignees","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getAsynchExecutionState":e.proxyPrefix+"Rest/Cases/{idCase}/AsynchExecutionState","case-handler-addNewCase":e.proxyPrefix+"Rest/Cases","case-handler-startProcess":e.proxyPrefix+"Rest/Processes/StartProcess/{idProcess}","handler-execute-action-start":e.proxyPrefix+"Api/Cases/{processId}/Start","case-handler-supportedLogTypes":e.proxyPrefix+"Rest/Cases/SupportedLogsTypes","case-handler-getActivityLog":e.proxyPrefix+"Rest/Cases/{idCase}/ActivityLog","case-handler-getActivityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idWorkItemFrom}/ActivityDetailLog","case-handler-getEntityLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityLog","case-handler-getEntityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityDetailLog","case-handler-getUserLog":e.proxyPrefix+"Rest/Cases/{idCase}/UserLog","case-handler-getUserDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idUser}/UserDetailLog","case-handler-getAdminLog":e.proxyPrefix+"Rest/Cases/{idCase}/AdminLog","case-handler-getCaseFormsRenderVersion":e.proxyPrefix+"Rest/Cases/{idCase}/FormsRenderVersion","case-handler-validateHasStartForm":e.proxyPrefix+"Api/Processes/{processId}/StartContext","favorites-handler-saveFavorite":e.proxyPrefix+"Rest/Favorites","favorites-handler-deleteFavorite":e.proxyPrefix+"Rest/Favorites/{guidFavorite}","process-getIcon":e.proxyPrefix+"Api/Processes/{processId}/Icon","collections-getIcon":e.proxyPrefix+"Api/CurrentUser/Collections/{collectionId}/Icon","bamAnalytics-handler-getAnalisysQueries":e.proxyPrefix+"Rest/BAMAnalytics/AnalisysQueries","bamAnalytics-handler-updateQuery":e.proxyPrefix+"Rest/BAMAnalytics/Reports/Ids/{idQuery}","inbox-handler-getInboxSummary":e.proxyPrefix+"Rest/Inbox/Summary","inbox-handler-getFullInboxSummary":e.proxyPrefix+"Rest/Inbox/FullSummary","MessageHandler-NewComment":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-GetComments":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-SetCategoryToComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-RemoveComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-ReplyComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies","MessageHandler-RemoveReply":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies/{idReply}","MessageHandler-GetCategoryColors":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors","MessageHandler-RenameCategoryColor":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors/{idColorCategory}","MessageHandler-CountNewComments":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/NewComments/Count","process-handler-getAllProcesses":e.proxyPrefix+"Rest/Processes","process-handler-getFavourites":e.proxyPrefix+"Rest/Home/MyFavorites/Count","process-handler-getFavouriteCases":e.proxyPrefix+"Rest/Home/MyFavorites","process-handler-getCustomizedColumnsData":e.proxyPrefix+"Rest/Processes/CustomizedColumnsData","process-handler-getCategory":e.proxyPrefix+"Rest/Processes/Categories","process-handler-getRecentProcesses":e.proxyPrefix+"Rest/Processes/RecentProcesses","process-handler-getCustomizedColumnsDataInfo":e.proxyPrefix+"Rest/Processes/CustomizedColumnsDataInfo","process-handler-getOrganizations":e.proxyPrefix+"Rest/Profile/Organizations","process-handler-getOrganizationsByUser":e.proxyPrefix+"Rest/Profile/OrganizationsByUser","smartinbox-entity-values":e.proxyPrefix+"api/SmartInbox/Detail/EntityValues/{entityGuid}","smartinbox-getAllInbox":e.proxyPrefix+"api/SmartInbox/All","smartinbox-user-tasks":e.proxyPrefix+"api/SmartInbox/Detail/UserTasks/{smartInboxId}","smartinbox-user-tasks-process":e.proxyPrefix+"api/SmartInbox/Detail/UserTasks/ByProcess/{workflowId}","process-handler-getMyStuff":e.proxyPrefix+"Api/CurrentUser/Collections","process-handler-getIdCasesOfProcessEntities":e.proxyPrefix+"Api/Entities/Cases","templates-handler-getCollectionData":e.proxyPrefix+"Api/Collection/{idFact}/Data","data-navigation-handler-collection":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/Data/{surrogateKey}","data-navigation-handler-entity":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Data/{surrogateKey}/{xpath}","data-navigation-handler-entity-filters":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Filters/{surrogateKey}/{xpath}","action-handler-getProcessAddAction":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/{surrogateKey}/Actions","my-search-getSearchLists":e.proxyPrefix+"Api/CurrentUser/Searches","my-search-getFilters":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Filters","my-search-getFiltersData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/FilterData","my-search-getData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Data","templates-handler-getVirtualCollectionData":e.proxyPrefix+"Api/Collection/{guidVirtualCollection}/VirtualData","templates-handler-getMultipleActions":e.proxyPrefix+"Rest/Entities/multipleInstancesActions","process-handler-getMapping":e.proxyPrefix+"Rest/Entities/Mapping","process-handler-getForm":e.proxyPrefix+"Rest/Handlers/Render","process-handler-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","process-handler-rule":e.proxyPrefix+"Api/Rules/{ruleId}/Execute","process-action-execute":e.proxyPrefix+"Api/Rules/{ruleId}/ExecuteMultiple","process-handler-getActivitiesData":e.proxyPrefix+"Api/Processes/CasesData/MyActivities","process-handler-getPendingsData":e.proxyPrefix+"Api/Processes/CasesData/MyPendings","entities-handler-getActions":e.proxyPrefix+"Api/Entities/{guidEntity}/{surrogateKey}/actions","entities-handler-getUsersAndEvents":e.proxyPrefix+"Rest/Processes/CasesData/UsersAndEvents","entities-handler-getUsers":e.proxyPrefix+"Api/Cases/{caseId}/Users","entities-handler-getEvents":e.proxyPrefix+"Api/Cases/{caseId}/CurrentEvents","entities-handler-getUsersImages":e.proxyPrefix+"Rest/Users/UserPictures","entities-handler-getShotCuts":e.proxyPrefix+"Api/CurrentUser/Shortcuts","query-handler-getqueries":e.proxyPrefix+"Rest/Queries","query-handler-getQueryForm":e.proxyPrefix+"Rest/Handlers/Render","user-handler-getCurrentUser":e.proxyPrefix+"Rest/Users/CurrentUser","old-render":e.proxyPrefix+"App/ListaDetalle/Detalle.aspx",Reports:e.proxyPrefix+"RestServices/BAMAnalyticsHandler.ashx","reports-handler-deleteQueries":e.proxyPrefix+"Rest/BAMAnalytics/Reports/{QueryId}","folders-handler-getUserQueries":e.proxyPrefix+"Rest/SmartFolders","folders-associate-deleteSmartFolder":e.proxyPrefix+"Rest/SmartFolders/{idSmartFolder}","folders-handler":e.proxyPrefix+"RestServices/SmartFoldersHandler.ashx","folders-associate":e.proxyPrefix+"App/Ajax/AJAXGateway.aspx","smartfolders-integration":e.proxyPrefix+"App/WorkPortal/ConfigureFilteredFolder.aspx",AlarmAdmin:e.proxyPrefix+"App/Admin/AlarmsAdmin.aspx",AnalyticsProcess:e.proxyPrefix+"App/Cockpit/AnalyticsProcess.aspx",AnalyticsSensor:e.proxyPrefix+"App/Cockpit/AnalyticsSensor.aspx",AnalyticsTask:e.proxyPrefix+"App/Cockpit/AnalyticsTask.aspx",AsynchronousWorkitemRetries:e.proxyPrefix+"App/Admin/AsynchDisabledWorkitems.aspx",AuthenticationLogQuery:e.proxyPrefix+"App/Admin/AuthLogQuery.aspx",BAMProcess:e.proxyPrefix+"App/Cockpit/BAMProcess.aspx",BAMTask:e.proxyPrefix+"App/Cockpit/BAMTask.aspx",BusinessPolicies:e.proxyPrefix+"App/Admin/BusinessPolicies/BusinessPoliciesSelector.aspx",CaseAdmin:e.proxyPrefix+"App/Admin/CaseSearch.aspx",adminReassignCases:"CaseAdmin",asyncECMUpload:"asyncECMUpload",CasesMonitor:e.proxyPrefix+"App/Admin/CasesMonitor.aspx",Closed:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Cerrados&I_ProcessState=Completed",CurrentUser:e.proxyPrefix+"App/Admin/CurrentUser.aspx",EncryptionAdmin:e.proxyPrefix+"App/Admin/Encrypt.aspx",MobileUpdatesAdmin:e.proxyPrefix+"App/MobileUpdates/default.aspx",EntityAdmin:e.proxyPrefix+"App/Admin/Entity.aspx",LocationResources:e.proxyPrefix+"App/Admin/AdminLocResources.aspx",NewCase:e.proxyPrefix+"App/Radicar/application.aspx",Pending:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Pendientes&I_processState=Running",Profiles:e.proxyPrefix+"App/Admin/ProfilesAdminSearch.aspx",Search:e.proxyPrefix+"App/ListaDetalle/Search.aspx",UserAdmin:e.proxyPrefix+"App/Admin/ListUsers.aspx",UserDefaultAssignation:e.proxyPrefix+"App/Admin/DefaultAssignationUser.aspx?h_AdminDefaultAssign=1",UserPendingRequests:e.proxyPrefix+"App/Admin/UserPendingRequests.aspx",ListPreferences:""!==bizagi.UserPreferencesUrl?e.proxyPrefix+bizagi.UserPreferencesUrl:e.proxyPrefix+"App/Admin/CurrentUser.aspx",GRDimensionAdmin:e.proxyPrefix+"App/Cockpit/DimensionEdit.aspx",Licenses:e.proxyPrefix+"App/Admin/Licenses.aspx",AnalysisQueries:e.proxyPrefix+"App/Inicio/WPAnalysisQuery.aspx",DocumentTemplates:e.proxyPrefix+"App/Admin/AdminDocumentTemplates.aspx",ProcessAdmin:e.proxyPrefix+"App/Admin/AdminProcess.aspx",ResourceBAM:e.proxyPrefix+"App/Cockpit/BAMResourceMonitor.aspx",WorkPortalVersion:e.proxyPrefix+"Rest/Util/Version","entities-administration":"RestServices/EntityHandler.ashx","theme-handler-getLogoImagePath":e.proxyPrefix+"Rest/Theme/LogoImage",logout:e.proxyPrefix+"Rest/Authentication/logout",logoutDotNet:e.proxyPrefix+"App/Inicio/LogOff.aspx",authenticationConfig:e.proxyPrefix+"Api/Authentication/BizagiConfig","logout-oauth2":e.proxyPrefix+"Api/Authentication/OAuth2/IdentityProvider/Server/Logout",FederateLogoffUrl:e.proxyPrefix+"Api/Authentication/FederateLogoffUrl",oauth2AuthenticationConfig:e.proxyPrefix+"Api/Authentication/OAuth2/OAuth2AuthenticationConfig","massive-activity-assignments-getOrganizationInfo":e.proxyPrefix+"Rest/Users/OrganizationInfo","massive-activity-assignments-getCasesByOrganization":e.proxyPrefix+"Rest/Queries/GetCasesByOrganization","massive-activity-assignments-reassignCases":e.proxyPrefix+"Rest/Cases/ReassignCases","massive-activity-assignments-searchUsers":e.proxyPrefix+"Rest/Users/","async-ecm-upload-baseService":e.proxyPrefix+"Rest/Handlers/Metadata",domains:e.proxyPrefix+"Rest/Authentication/Domains",getCurrentTheme:e.proxyPrefix+"Api/Theme/Current","admin-getAuthenticationLog":e.proxyPrefix+"Rest/Users/AuthLog","admin-getAuthenticationDomains":e.proxyPrefix+"Rest/Users/Domains","admin-getAuthenticationEventsTypes":e.proxyPrefix+"Rest/Users/EventTypes","admin-getAuthenticationEventSubTypes":e.proxyPrefix+"Rest/Users/EventSubTypes","admin-EncryptString":e.proxyPrefix+"Rest/Util/EncryptString","admin-UserPendingRequests":e.proxyPrefix+"Rest/Users/UserPendingRequests","admin-UserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UserAuthenticationInfo","admin-updateUserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UpdateUserAuthenticationInfo","admin-generateRandomPassword":e.proxyPrefix+"Rest/Util/GenerateRandomPassword","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendEmail":e.proxyPrefix+"Rest/Util/SendEmail/","admin-getApplicationList":e.proxyPrefix+"Rest/Application","admin-getApplicationProcesses":e.proxyPrefix+"Rest/Application/{idApp}/Process","admin-getProcessVersion":e.proxyPrefix+"Rest/Processes/Version","admin-getProcessTasks":e.proxyPrefix+"Rest/Processes/Version/{version}/Tasks","admin-getTaskAlarms":e.proxyPrefix+"Rest/Alarm/TaskAlarms","admin-getLapseMode":e.proxyPrefix+"Rest/Alarm/LapseMode","admin-getRecurrMode":e.proxyPrefix+"Rest/Alarm/RecurrMode","admin-getScheduleType":e.proxyPrefix+"Rest/Alarm/ScheduleType","admin-getBossList":e.proxyPrefix+"Rest/Alarm/Boss","admin-addAlarm":e.proxyPrefix+"Rest/Alarm","admin-editAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}","admin-deleteAlarm":e.proxyPrefix+"Rest/Alarm","admin-alarmRecipients":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient","admin-deleteAlarmRecipients":e.proxyPrefix+"Rest/Alarm/Recipient","admin-recipientToAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient/{idRecipient}","admin-enableAlarm":e.proxyPrefix+"Rest/Alarm/Task/{idTask}/ToggleAlarm","admin-getCategoriesList":e.proxyPrefix+"Rest/Application/Category","admin-getCasesList":e.proxyPrefix+"Rest/Queries/SearchCases","admin-abortItems":e.proxyPrefix+"Rest/Cases/Abort","admin-reassignItems":e.proxyPrefix+"Rest/Cases/Reassign","admin-getDefaultAssignationUserToAllProcess":e.proxyPrefix+"Rest/Users/{serviceAction}/","admin-getDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-setDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-getProfilesTypes":e.proxyPrefix+"Rest/Profile/Types","admin-searchProfiles":e.proxyPrefix+"Rest/Profile","admin-getUsersByProfile":e.proxyPrefix+"Rest/Users/Profile/{type}/{id}","admin-removeUserFromProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-addUserToProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-async-activities-get-activities":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities","admin-async-activities-get-retry-now":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/RetryNow","admin-async-activities-get-activities-by-task":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities/Task","admin-async-activities-enable-execution":e.proxyPrefix+"Rest/Cases/Asynchronous/Enable","admin-async-activities-enable-multiple":e.proxyPrefix+"Rest/Cases/Asynchronous/EnableMultiple","admin-async-activities-async-execution":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idWorkitem}/AsynchExecution","admin-async-activities-async-execution-log":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/AsynchExecutionLog","admin-Licenses":e.proxyPrefix+"Rest/Licenses","admin-GetDimensions":e.proxyPrefix+"Rest/Dimensions","admin-EditDimension":e.proxyPrefix+"Rest/Dimensions/{id}","admin-CreateAdministrableDimension":e.proxyPrefix+"Rest/Dimensions/Administrable","admin-DeleteDimension":e.proxyPrefix+"Rest/Dimensions/{id}?isAdministrable={administrable}","admin-EntityPathChildNodesAction":e.proxyPrefix+"Rest/Dimensions/EntityChildNodes","admin-GetActiveWFClasses":e.proxyPrefix+"Rest/Dimensions/ActiveProcess","admin-document-templates-storeDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/StoreDocumentTemplates","admin-document-templates-restoreDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/RestoreDocumentTemplate","admin-document-templates-uploadDocumentTemplate":e.proxyPrefix+"Rest/DocumentTemplates/UploadDocumentTemplate","admin-processes-workflowClasses":e.proxyPrefix+"Rest/Processes/WorkflowClasses","admin-processes-tasksByWorkflow":e.proxyPrefix+"Rest/Processes/TasksByWorkflow","admin-processes-modifyProcessDuration":e.proxyPrefix+"Rest/Processes/{idWorkflow}/Duration/","admin-processes-modifyTaskDuration":e.proxyPrefix+"Rest/Processes/Task/{idTask}/Duration/","admin-language-resource":e.proxyPrefix+"Rest/Multilanguage/Resource","admin-language-languages":e.proxyPrefix+"Rest/Multilanguage/Languages","bam-resourcemonitor-myteam":e.proxyPrefix+"Rest/Reports/BAM/Resources/MyTeam","reports-analysisquery":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-update":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-delete":e.proxyPrefix+"Rest/Reports/AnalysisQueries","processviewer-processdefinition":e.proxyPrefix+"Rest/Reports/Components/ProcessDefinition","processviewer-processgraphicinfo":e.proxyPrefix+"Rest/Reports/Components/ProcessGraphicInfo","mobile-getLastUpdate":e.proxyPrefix+"Rest/Util/mobileUpdates","discussion-case":e.proxyPrefix+"Api/CaseResource/Discussion?globalParent={globalParent}","discussion-case-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/Discussion","get-users":e.proxyPrefix+"Rest/Users/UserPictures","new-discussion":e.proxyPrefix+"Api/CaseResource/Discussion","count-comments":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment/Count","comment-case":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment","new-comment":e.proxyPrefix+"Api/CaseResource/Comment","new-comment-attach":e.proxyPrefix+"Api/CaseResource/Attachment","get-list-files":e.proxyPrefix+"Api/CaseResource/File?globalParent={globalParent}","get-list-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File","project-resource-action":e.proxyPrefix+"Api/CaseResource/{typeResource}","thumbnail-file":e.proxyPrefix+"Api/CaseResource/File/Thumbnails?globalParent={globalParent}","get-attachment":e.proxyPrefix+"Api/CaseResource/Attachment/{idAttachment}","get-mobile-attachment":e.proxyPrefix+"Api/CaseResource/Mobile/Attachment/{idAttachment}","project-files-upload":e.proxyPrefix+"Api/CaseResource/File","count-files":e.proxyPrefix+"Api/CaseResource/File/Count?globalParent={globalParent}","count-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File/Count","remove-comment":e.proxyPrefix+"Api/CaseResource/Comment","time-schemas-effectiveduration":e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDuration?idUser={idUser}&fromDate={fromDate}&toDate={toDate}"},_defineProperty(t,"case-handler-getCaseAssignees",e.proxyPrefix+"Rest/Cases/{idCase}/Assignees"),_defineProperty(t,"project-users-get",e.proxyPrefix+"Rest/Users/UserPictures"),_defineProperty(t,"case-summary-task-options",e.proxyPrefix+"Rest/Cases/WorkItems/{idWorkitem}/TaskOptions?idCase={idCase}"),_defineProperty(t,"project-plan-get",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-activities",e.proxyPrefix+"Api/Plans/{idPlan}/Activities"),_defineProperty(t,"project-plan-workitems",e.proxyPrefix+"Api/Plans/{idPlan}/WorkItems"),_defineProperty(t,"project-plan-transitions-get",e.proxyPrefix+"Api/Plans/{idPlan}/Activities/Transitions"),_defineProperty(t,"project-plan-activity-edit",e.proxyPrefix+"Api/Plans/{idPlan}/Activities/{id}"),_defineProperty(t,"project-plan-get-by-parent",e.proxyPrefix+"Api/Plans?parentWorkItem={parentWorkItem}"),_defineProperty(t,"project-plan-parent",e.proxyPrefix+"Api/Plans/{idPlan}/ParentCase"),_defineProperty(t,"project-plan-update",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-execute",e.proxyPrefix+"Api/Plans/Execute"),_defineProperty(t,"project-plan-close",e.proxyPrefix+"Api/Plans/Close"),_defineProperty(t,"project-plan-delete",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-first-parent-plan",e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlan"),_defineProperty(t,"PreferencesWorkportalCurrentUser",e.proxyPrefix+"Api/Users/Data/WindowPreferences"),_defineProperty(t,"diagnostics-sync-system-error",e.proxyPrefix+"api/ErrorLogs/Import"),t);return bizagi.util.getFeatureObject("userService.v1.enabled")&&(r["user-handler-getCurrentUser"]=e.proxyPrefix+"Rest/Users/CurrentUserGuid",r["get-users"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["entities-handler-getUsersImages"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["project-users-get"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["entities-handler-getUsers"]=e.proxyPrefix+"Api/Cases/{caseId}/UsersGuid",r["case-handler-getCaseSummary"]=e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid",r["case-handler-getCaseAssignees"]=e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid",r["discussion-case"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid?globalParent={globalParent}",r["new-discussion"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid",r["comment-case"]=e.proxyPrefix+"Api/CaseResource/{idParent}/CommentGuid",r["new-comment"]=e.proxyPrefix+"Api/CaseResource/CommentGuid",r["project-files-upload"]=e.proxyPrefix+"Api/CaseResource/FileGuid",r["get-list-files"]=e.proxyPrefix+"Api/CaseResource/FileGuid?globalParent={globalParent}",r["time-schemas-effectiveduration"]=e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDurationGuid?idUser={idUser}&fromDate={fromDate}&toDate={toDate}",r["project-plan-get"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",r["project-plan-update"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",r["project-plan-activities"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid",r["project-plan-workitems"]=e.proxyPrefix+"Api/Plans/{idPlan}/WorkItemsGuid",r["project-plan-first-parent-plan"]=e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlanGuid",r["project-plan-activity-edit"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid/{id}"),r}return{}},$.Class.extend("bizagi.workportal.services.service",{BA_CONTEXT_PARAMETER_PREFIX:"h_",ENTITIES_QUERY_PAGE_SIZE:10},{init:function(e){(e="object"==_typeof(e)?e:{}).context=bizagi.util.isEmpty(e.context)?"workportal":e.context,e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,e.proxyPrefix=this.normalizeUrl(e.proxyPrefix),bizagi.RPproxyPrefix=e.proxyPrefix,e.sharepointProxyPrefix=bizagi.util.isEmpty(e.sharepointProxyPrefix)?"":e.sharepointProxyPrefix,e.sharepointProxyPrefix=this.normalizeUrl(e.sharepointProxyPrefix),this.serviceLocator=new bizagi.workportal.services.context(e),this.pageSize=10,this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode(),"undefined"!=typeof BIZAGI_INBOX_ROWS_PER_PAGE&&(this.pageSize=$.isNumeric(BIZAGI_INBOX_ROWS_PER_PAGE)?BIZAGI_INBOX_ROWS_PER_PAGE:this.pageSize),this.activeForm=void 0,this.configureGlobalHandlers()},getUrl:function(e){return this.serviceLocator.getUrl(e.endPoint)},normalizeUrl:function(e){return""!==e&&("/"!=e[e.length-1]&&(e=e.concat("/")),-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&(e="http://"+e)),e},getOverrides:function(){return $.ajax({url:this.serviceLocator.getUrl("overrides")}).pipe((function(e){return e=e||{},$.each(e,(function(t,r){var i=r.toUpperCase();"TRUE"!=i&&"FALSE"!=i||(e[t]=bizagi.util.parseBoolean(r))})),e}))},getCurrentTheme:function(){var e=this.serviceLocator.getUrl("getCurrentTheme");return $.read(e)},authenticatedUser:function(e){var t=this,r=t.serviceLocator.getUrl("login-handler");return $.read({url:r,data:{userName:BIZAGI_USER,password:BIZAGI_PASSWORD,domain:BIZAGI_DOMAIN}}).pipe((function(e){return e}),(function(e){return r=(r=(r=(r=t.serviceLocator.getUrl("login-handlerv10")).replace("{0}",BIZAGI_USER||"")).replace("{1}",BIZAGI_PASSWORD||"")).replace("{2}",BIZAGI_DOMAIN||""),$.ajax({url:r,type:"GET",dataType:"json"})}))},logoutUser:function(e){var t=this.serviceLocator.getUrl("logoff-handlerv1");return $.read({url:t})},logOffUser:function(e){var t=this.serviceLocator.getUrl("logoff-handler");return $.read({url:t})},getCurrentUser:function(e){return $.read(this.serviceLocator.getUrl("user-handler-getCurrentUser"))},getInboxSummary:function(e){return $.read(this.serviceLocator.getUrl("inbox-handler-getInboxSummary")).pipe((function(e){return e.inboxSummary}))},getAllProcesses:function(e){var t=this;e=e||{};var r={},i=t.serviceLocator.getUrl("process-handler-getAllProcesses");return null!=e.taskState&&(r.taskState=e.taskState),null!=e.onlyFavorites&&""!=e.onlyFavorites&&(r.onlyFavorites=e.onlyFavorites),null!=e.myActivities&&""!=e.myActivities&&(r.myActivities=e.myActivities),null!=e.myPendings&&""!=e.myPendings&&(r.myPendings=e.myPendings),e.smartfoldersParameters&&(i=i+"?"+e.smartfoldersParameters),bizagi.isMobile()&&(r.mobileDevice=!0),$.read(i,r).pipe((function(r){if(e.skipAggrupate)return t.includeAllProcessesItem(r),r;var i={},a={},s=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),o={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:s,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};for(key in a[s]=[],a[s].workflows=[],a[s].workflows.push(o),r.workflows&&$.each(r.workflows.workflow,(function(e,t){a[t.category]||(a[t.category]=[],a[t.category].workflows=[]),a[t.category].workflows.push(t),o.count+=Number(t.count)})),i.categories=[],a)i.categories.push({name:key,workflows:a[key].workflows});return i}))},getUserWorkportalPreferences:function(){var e=this,t=new $.Deferred;return void 0!==e._userPreferences?t.resolve(e._userPreferences):e.getPreferencesWorkportalCurrentUser().done((function(r){e._userPreferences=bizagi.util.tryCatch((function(){return r.workportal}),{}),bizagi.util.storeMobileFeatures({userPreferences:e._userPreferences}),t.resolve(e._userPreferences)})).fail((function(e){console.error(e),t.resolve({})})),t},getUserPreferences:function(e){var t=bizagi.util.getMobileFeatures(),r=t||{},i=r.userPreferences?r.userPreferences:{},a=this._userPreferences||i;return void 0===e?a:a[e]},getLastProcessInboxWorkflow:function(){var e=new $.Deferred,t=bizagi.util.getLastProcessInboxProcessInfo();return 0==bizagi.util.validateFeatureSupport("defaultInboxEnabled")||0==bizagi.util.isMobileInboxByProcessSupported()?(-1!=t.idWorkflow&&bizagi.util.setLastProcessInbox(t.processInfoName,t.idWorkflow),e.resolve(t)):$.when(this.getUserWorkportalPreferences(),this.getAllProcesses({taskState:"all",onlyFavorites:!1,inputtray:"inbox",skipAggrupate:!0,mobileDevice:!0}),this.getAllSmartInbox()).then((function(r,i,a){var s=t.idWorkflow,o=t.smartInboxId,n=parseInt(r.defaultOpenInboxWorkflowId),l=r.defaultOpenInboxSmartInboxId,c=n>0,d=!bizagi.util.isEmpty(l);if(-1==s&&c&&bizagi.util.isEmpty(o)?(s=n,o=null):bizagi.util.isEmpty(o)&&d&&-1==s&&(o=l,s=-1),i&&i.workflows&&-1!=s){var u=$.first(i.workflows.workflow,(function(e){return e.idworkflow==s}));u?bizagi.util.setLastProcessInbox(u.name,s):bizagi.util.setLastProcessInbox(null,-1)}else if(a&&a.length>0&&!bizagi.util.isEmpty(o)){var p=$.first(a,(function(e){return e.id==o}));p?bizagi.util.setLastProcessInbox(p.name,-1,o):bizagi.util.setLastProcessInbox(null,-1)}e.resolve(bizagi.util.getLastProcessInboxProcessInfo())})).fail((function(){e.reject("Error in bizagi.workportal.services.service.getLastProcessInboxWorkflow")})),e.promise()},getFavourites:function(){var e=this.serviceLocator.getUrl("process-handler-getFavourites");return $.read(e,{}).pipe((function(e){return e}))},getMyStuff:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getMyStuff");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getFavouriteCases:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getFavouriteCases");return t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),$.read(r,t).pipe((function(e){return e}))},getCasesList:function(e){var t={},r=this.serviceLocator.getUrl("case-handler-getCasesList");return e=e||{},t.pageSize=e.pageSize||10,t.page=e.page||1,t.numberOfFields=e.numberOfFields||"-1",t.idWfClass=e.idWfClass||"-1",$.read(r,t).pipe((function(e){for(var t={overdue:[],today:[],tomorrow:[],upcoming:[],page:e.page,totalPages:e.totalPages},r=new Date,i=r.getMonth(),a=r.getDate(),s=r.getYear(),o=void 0!==e.elements?e.elements.length:0,n=0;o>n;n++){var l=e.elements[n],c=new Date(l[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();a>d||i>u||s>p?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.overdue.push(l)):a==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.today.push(l)):a+1==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.tomorrow.push(l)):(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.upcoming.push(l))}return t}))},getCasesListBeta:function(e){var t=this;return t.getMobileCasesList(e).then((function(e){return t.adapterDataOfActivitiesToTemplate(e)}))},getMobileCasesList:function(e){var t=this,r={};if(e=e||{},bizagi.util.validateFeatureSupport("advancedSearch"))return $.when(t.getMobileActivities(e)).then((function(e){for(var r,i={elements:[],rows:[]},a=-1;r=e.rows[++a];){for(var s,o={},n=["","","","","","",[],"","","","","",""],l=-1;s=e.headers[++l];)o[s.fieldName.toLowerCase()]={displayName:s.displayName,value:r[l]},t.serializeActivity(n,s.fieldName.toLowerCase(),o[s.fieldName.toLowerCase()]);e.syncErrors&&(t.appendActivityElementSyncError(n,e.syncErrors),t.appendActivityRowsSyncError(o,e.syncErrors)),i.elements.push(n),i.rows.push(o)}return{page:e.page||e.currentPage,totalPages:e.totalPages,elements:i.elements,rows:i.rows,advanceSearch:!0}}));var i=t.serviceLocator.getUrl("case-handler-getCasesList");return void 0!==e.radNumber&&(r.radNumber=e.radNumber),r.pageSize=e.pageSize||10,r.page=e.page||1,r.numberOfFields=e.numberOfFields||"-1",r.idWfClass=e.idWfClass||"-1",$.read(i,r)},adapterDataOfActivitiesToTemplate:function(e){for(var t={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:e.advanceSearch||!1,headers:e.headers,rows:e.rows},r=new Date,i=e.advanceSearch?this.defineActivityStateByTaskState:this.defineActivityStateByDate,a=0;e.elements.length>a;a++){var s=e.elements[a],o={};if(o=i(s[3],s.taskstate),s.length>=10&&parseInt(s[11],10)>0){var n=new Date(s[3]);r.getTime()>n.getTime()?o.state="red":r.getTime()>n.getTime()-6e4*parseInt(s[11],10)?o.state="yellow":o.state="green"}t.elements.push($.extend({},s,o,{endDate:s[3],idworkitem:s[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?s[10]:s[7]}))}return t},adapterServerResponseTemplateBindingObject:function(e){for(var t,r={elements:[],rows:[]},i=-1;t=e.rows[++i];){for(var a,s={},o=["","","","","","",[],"","","","","",""],n=-1;a=e.headers[++n];)s[a.fieldName.toLowerCase()]={displayName:a.displayName,value:t[n]},this.serializeActivity(o,a.fieldName.toLowerCase(),s[a.fieldName.toLowerCase()]);e.syncErrors&&(this.appendActivityElementSyncError(o,e.syncErrors),this.appendActivityRowsSyncError(s,e.syncErrors)),r.elements.push(o),r.rows.push(s)}return{page:e.page||e.currentPage,totalPages:e.totalPages,elements:r.elements,rows:r.rows,advanceSearch:!0,headers:e.headers}},defineActivityStateByDate:function(e){var t={};if(e){var r=new Date(e),i=new Date,a=new Date(i.getFullYear(),i.getMonth(),i.getDate());t=r.getTime()<a.getTime()?{group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<i.getTime()+6e4?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"red",type:"today",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<a.getTime()+864e5?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"yellow",type:"today",icon:"ontime",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<a.getTime()+1728e5?{group:"3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),state:"green",type:"tomorrow",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:{group:"4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),state:"green",type:"upcoming",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}}else t={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",shortEndDate:"--",icon:"overdue"};return t},defineActivityStateByTaskState:function(e,t){var r={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:t,type:"overdue",shortEndDate:"--",icon:"overdue"};if(e&&t){var i=new Date(e),a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(r={group:"",state:t,type:"",icon:"",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))},i.getTime()<s.getTime()?(r.group="1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),r.type="overdue"):i.getTime()<s.getTime()+864e5?(r.group="2|"+bizagi.localization.getResource("workportal-taskfeed-today"),r.type="today"):i.getTime()<s.getTime()+1728e5?(r.group="3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),r.type="tomorrow"):(r.group="4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),r.type="upcoming"),t){case"green":r.icon="upcoming";break;case"yellow":r.icon="ontime";break;case"red":default:r.icon="overdue"}}return r},serializeActivity:function(e,t,r){switch(t){case"radnumber":e[6].push([r.displayName,r.value]),e.radNumber=r.value;break;case"wfclsdisplayname":e[4]=null!=r.value?r.value.toString():bizagi.localization.getResource("workportal-project-activity-plan");break;case"currenttask":e[5]=null!=r.value?r.value.toString():bizagi.localization.getResource("workportal-project-casedashboard-activity");break;case"cascreationdate":e[12]=r.value;break;case"wiestimatedsolutiondate":e[3]=r.value;break;case"cassolutiondate":break;case"idcase":e[0]=r.value;break;case"idworkitem":e[1]=r.value.toString();break;case"wientrydate":break;case"taskid":e[2]=r.value;break;case"taskstate":e.taskstate=r.value?(""+r.value).toLowerCase():"";break;case"idwfclass":e[10]=e.idwfclass=r.value;break;case"isfavorite":e[9]=r.value;break;case"atrisktime":e[11]=r.value;break;case"guidfavorite":e[8]=r.value;break;case"isevent":e.isEvent=r.value;break;case"datachangesetversion":e.dataChangeset=r.value;break;case"creatorfullname":e.creatorFullName=r.value}},appendActivityElementSyncError:function(e,t){var r=t[e[0]+"-"+e[1]];r&&(e.syncError=r,e.hasSyncError=!0)},appendActivityRowsSyncError:function(e,t){var r=t[e.idcase.value+"-"+e.idworkitem.value];r&&(e.syncerror={displayName:"syncError",value:r},e.hassyncerror={displayName:"hasSyncError",value:!0})},getCurrentActivities:function(e){var t=this,r={};e=e||{},r.page=e.page||1,r.pageSize=e.pageSize||10,void 0!==e.radNumber&&(r.radNumber=e.radNumber);var i=t.serviceLocator.getUrl("case-handler-getActivityList");return $.read(i,r).then((function(e){return t.processActivitiesResponse(e)}))},processActivitiesResponse:function(e,t,r){var i,a=-1;for(e.elements=[],e.processes=[];i=e.rows[++a];){for(var s,o={},n=-1;s=e.headers[++n];)o["o_"+s.fieldName.toLowerCase()]={displayName:s.displayName,value:i[n]},o[s.fieldName.toLowerCase()]=i[n];$.extend(o,this.defineActivityStateByDate(o.wiestimatedsolutiondate),{highlightedNumber:this.highlightsString(o.radnumber,t)}),e.elements.push(o),void 0===e.processes.find((function(e){return e.processname==o.wfclsdisplayname}))&&e.processes.push({processname:o.wfclsdisplayname,idwfclass:o.idwfclass,active:r?"active":""})}return e},highlightsString:function(e,t){if("string"!=typeof e||"string"!=typeof t)return e;var r=new RegExp(t,"gi");return e.replace(r,(function(e,t){return"<strong>"+e+"</strong>"}))},getDiscussionCase:function(e){var t=t||{};t.globalParent=e.globalParent;var r=bizagi.util.validateFeatureSupport("discussionCase")?this.serviceLocator.getUrl("discussion-case"):this.serviceLocator.getUrl("discussion-case-v1");return $.read({url:r,data:t,contentType:"application/json"}).pipe((function(e){return e}))},editDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getUsersDiscussion:function(e){var t=t||{};t.userIds=e,t.width=50,t.height=50;var r=this.serviceLocator.getUrl("get-users");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:r,data:t,type:"POST",dataType:"json"}):$.read(r,t).pipe((function(e){return e}))},getEffectiveDuration:function(e){var t=this.serviceLocator.getUrl("time-schemas-effectiveduration");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getUsersData:function(e){var t=this.serviceLocator.getUrl("project-users-get");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:t,data:e,type:"POST",dataType:"json"}):$.read({url:t,data:e,dataType:"json"})},getSummaryCaseTaskOptions:function(e){var t=this.serviceLocator.getUrl("case-summary-task-options");return e=e||{},$.read(t,{idWorkitem:e.idWorkitem,idCase:e.idCase})},createNewDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return e=e||{},$.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createNewComment:function(e){var t=(e=e||{}).data||{},r=this.serviceLocator.getUrl("new-comment");return $.create({url:r.replace("{typeResource}","Comment"),data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},updateProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesCount:function(e){e=e||{};var t=bizagi.util.validateFeatureSupport("filesCount")?this.serviceLocator.getUrl("count-files"):this.serviceLocator.getUrl("count-files-v1");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getCommentCase:function(e){e=e||{};var t=this.serviceLocator.getUrl("comment-case");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getCommentsByParent:function(e){e=e||{};var t=this.serviceLocator.getUrl("count-comments");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getFilesList:function(e){var t=bizagi.util.validateFeatureSupport("filesList")?this.serviceLocator.getUrl("get-list-files"):this.serviceLocator.getUrl("get-list-files-v1");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},deleteFile:function(e){var t=this.serviceLocator.getUrl("project-resource-action");return $.destroy({url:t.replace("{typeResource}","Attachment"),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesThumbnail:function(e){e=e||{};var t=this.serviceLocator.getUrl("thumbnail-file");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},getAttachment:function(e){var t=this.serviceLocator.getUrl("get-attachment");return t=t.replace("{idAttachment}",e.idAttachment)},getMobileAttachment:function(e){var t=this.serviceLocator.getUrl("get-mobile-attachment");return(t=t.replace("{idAttachment}",e.idAttachment))+"?sessionId="},getAllAdministrableEntities:function(e){e=e||{};var t={action:"entitiesList",kind:"administrable"};return $.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:t,type:"POST",dataType:"json"}).pipe((function(e){var t={entities:[]};return $.each(e,(function(e,r){t.entities.push(r)})),t}))},getEntitiesList:function(e){return(e=e||{}).action="entitiesList",e.kind="entitiesData",$.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:e,type:"POST",dataType:"json"})},getCasesByWorkflow:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsDataInfo");if(bizagi.util.isEmpty(e.taskState)||(t.taskState=e.taskState),bizagi.util.isEmpty(e.smartInboxId)?bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow):t.smartInboxGuid=e.smartInboxId,1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return(e.radnumber||e.radNumber)&&(t.radNumber=e.radNumber?e.radNumber:e.radnumber),(e.idcase||e.idCase)&&bizagi.util.isNumeric(e.idcase||e.idCase)&&(t.idCase=e.idCase?e.idCase:e.idcase),$.read(r,t).pipe((function(e){return $.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?(e.cases.rows[t].radnumber=a.Value,e.cases.rows[t].casenumberdisplayname=a.DisplayName):null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getOrganizationsList:function(){var e=this.serviceLocator.getUrl("process-handler-getOrganizations"),t={type:12,name:""};return $.read(e,t)},getOrganizationsByUserList:function(){var e=this.serviceLocator.getUrl("process-handler-getOrganizationsByUser");return $.read(e,{})},getCustomizedColumnsData:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",bizagi.isMobile()&&(t.mobileDevice=!0),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return $.read(r,t)},getCustomizedColumnsDataBeta:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",t.mobileDevice=!!bizagi.isMobile(),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return $.read(r,t).pipe((function(e){var t={columnTitle:[],lstIdCases:[],elements:[],page:e.page,totalPages:e.totalPages},r=new Date,i=r.getMonth(),a=r.getDate(),s=r.getYear();t.columnTitle=e.cases.columnTitle,t.lstIdCases=e.cases.lstIdCases,t.page=e.cases.page,t.totalPages=e.cases.totalPages;for(var o=0,n=e.cases.rows.length;o<n;o++){var l=e.cases.rows[o],c=new Date(l.fields[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();a>d||i>u||s>p?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"overdue"}))):a==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"today"}))):a+1==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"tomorrow"}))):(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"upcoming"})))}return(void 0===t.elements||void 0!==t.elements&&0===t.elements.length)&&t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t}))},getCategories:function(e){var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),bizagi.isMobile()&&(t.mobileDevice=!0),t.groupByApp=e.groupByApp||!1,$.read(this.serviceLocator.getUrl("process-handler-getCategory"),t)},getRecentProcesses:function(e){return(e=e||{}).mobileDevice=bizagi.isMobile()||"false",$.read(this.serviceLocator.getUrl("process-handler-getRecentProcesses"),e)},getCaseSummary:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSummary"),data:{idCase:e.idCase,eventAsTasks:e.eventAsTasks||"false",onlyUserWorkItems:e.onlyUserWorkItems||"true",mobileDevice:bizagi.isMobile()||"false"},serviceType:"GETSUMMARY"}).pipe((function(e){return e}))},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getCaseTasks:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseTasks"),{idCase:e.idCase})},getCaseEvents:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseEvents"),data:{idCase:e.idCase},serviceType:"GETEVENTS"}).pipe((function(e){return e}))},getCaseSubprocesses:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSubprocesses"),data:{idCase:e.idCase},serviceType:"GETSUBPROCESSES"}).pipe((function(e){return e}))},getCaseFormsRenderVersion:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseFormsRenderVersion"),{idCase:e.idCase})},getCaseFormsRenderVersionDataContent:function(e){var t=new $.Deferred;return $.when(this.getCaseFormsRenderVersion(e)).done((function(e){t.resolve(e)})),t.promise()},getTaskAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getTaskAssignees"),{idCase:e.idCase,idTask:e.idTask})},getWorkitems:function(e){var t={};return e=e||{},t.idCase=e.idCase,t.fromTask=e.fromTask,t.fromWorkItemId=e.fromWorkItemId,t.mobileDevice=bizagi.isMobile(),e.eventAsTasks&&(t.eventAsTasks=e.eventAsTasks),void 0!==e.onlyUserWorkItems&&(t.onlyUserWorkItems=e.onlyUserWorkItems),$.read({url:this.serviceLocator.getUrl("case-handler-getWorkItems"),data:t,serviceType:"GETWORKITEMS"})},getQueries:function(e){var t=this;if(t.hashQueries&&e.idElement)return t.hashQueries[e.idElement];var r=new $.Deferred;return $.read(t.serviceLocator.getUrl("query-handler-getqueries")).done((function(e){t.hashQueries={},t.hashQueries[0]={},t.processQueries(e.query),r.resolve(t.hashQueries[-1])})),r.promise()},processQueries:function(e){var t=this;$.each(e,(function(e,r){t.hashQueries[r.idParent]||(t.hashQueries[r.idParent]=[]),t.hashQueries[r.idParent].push(r),r.nodes?t.processQueries(r.nodes):r.nodes={}}))},createNewCase:function(e){return e=e||{},$.create({url:this.serviceLocator.getUrl("case-handler-addNewCase"),data:{idWfClass:e.idWfClass,caseData:e.caseData?JSON.stringify(e.caseData):null,idOrganization:e.idOrganization?e.idOrganization:null},serviceType:"NEWCASE"})},validateHasStartForm:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("case-handler-validateHasStartForm"),data:t,batchRequest:!0})},startProcess:function(e){var t=this,r={idProcess:(e=e||{}).idProcess,entityMapping:e.mapping?JSON.stringify(e.mapping):{}};void 0!==e.idParentCase&&(r.idParentCase=e.idParentCase);var i=$.Deferred();return $.create({url:t.serviceLocator.getUrl("case-handler-startProcess"),data:r,serviceType:"STARTPROCESS"}).fail((function(r){if("error"!==$.parseJSON(r.responseText).status||bizagi.util.isVersionSupported())i.reject(r);else{var a={idWfClass:e.idProcess||e.idWfClass,idOrganization:e.idOrganization||null};t.createNewCase(a).then((function(e){e.oldVersion=!0,i.resolve(e)})).fail((function(e){i.reject(e)}))}})).done((function(e){i.resolve(e)})),i.promise()},actionCreateCase:function(e){var t={processId:void 0!==e.idProcess?e.idProcess:e.guidProcess};return void 0!==e.parentCaseId&&(t.parentCaseId=e.parentCaseId),void 0!==e.mapping&&(t.entityMapping=e.mapping?JSON.stringify(e.mapping):{}),$.create({url:this.serviceLocator.getUrl("handler-execute-action-start"),data:t,serviceType:"STARTPROCESS"})},getFirstParentPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-first-parent-plan"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json"})).done((function(e){r.resolve(e)})).fail((function(){r.resolve(null)})),r.promise()},searchCases:function(e){e=e||{};var t={h_action:"SEARCHCASES",onlyUserCases:!1,active:!1};return t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryCases:function(e){e=e||{};var t={h_action:"QUERYCASES"};return t.onlyUserCases=e.onlyUserCases||!1,t.active=e.active&&!0,t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType="asc"==e.orderType||1==e.orderType?1:0,t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryEntities:function(e){e=e||{};var t={h_action:"QUERYENTITIES"};return t.page=e.page||1,t.pageSize=this.Class.ENTITIES_QUERY_PAGE_SIZE,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEnt"]=e.idEntity,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"",t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},getMenuAuthorization:function(){return $.read(this.serviceLocator.getUrl("authorization-handler-getMenuAuthorization"))},isCaseCreationAuthorized:function(e){var t=this.serviceLocator.getUrl("authorization-handler-isCaseCreationAuthorized");return t=t.replace("{0}",e.idWfClass||""),$.read({url:t})},getAsynchExecutionState:function(e){return(e=e||{}).idCase,$.read({url:this.serviceLocator.getUrl("case-handler-getAsynchExecutionState"),data:{idCase:e.idCase,idAsynchWorkitem:e.idAsynchWorkitem},serviceType:"ASYNCHEXECUTION"})},supportedLogTypes:function(){return $.read(this.serviceLocator.getUrl("case-handler-supportedLogTypes"))},getActivityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getActivityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityDetailLog"),{idCase:e.idCase,idWorkItemFrom:e.idWorkItemFrom,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getEntityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getEntityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityDetailLog"),{idCase:e.idCase,idEntity:e.idEntity||-1,userFullName:e.userFullName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getUserLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getUserDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserDetailLog"),{idCase:e.idCase,idUser:e.idUser,entDisplayName:e.entDisplayName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getAdminLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getAdminLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},addFavorite:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("favorites-handler-saveFavorite"),{idObject:e.idObject,favoriteType:e.favoriteType}).pipe((function(e){return e}))},delFavorite:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("favorites-handler-deleteFavorite"),{guidFavorite:e.idObject}).pipe((function(e){return e}))},summaryAssigness:function(e){var t=new $.Deferred,r=e.idCase||"";return $.when(this.getCaseAssignees({idCase:r})).done((function(e){for(var r=e.assignees||[],i=r.length,a={showAssignees:!!(bizagi.override.showAssignees&&r.length>0),assignees:{},events:"",activities:""},s="",o="",n=[],l=[],c=0;c<i;c++)bizagi.util.parseBoolean(r[c].isEvent)?-1==n.indexOf(r[c].idUser)&&(n.push(r[c].idUser),s+=r[c].Name+", "):-1==l.indexOf(r[c].idUser)&&(l.push(r[c].idUser),o+=r[c].Name+", ");a.events=s.substring(0,s.length-2),a.activities=o.substring(0,o.length-2),t.resolve(a)})),t.promise()},summarySubProcess:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseSubprocesses({idCase:r})).done((function(e){if(e.showSubProcess=e.subProcesses.length>=1,e.showSubProcesColumns=void 0!==e.CustFields[0]&&e.CustFields[0][0].length>=1,e.showSubProcesColumns){var r;e.subProcPersonalized={};for(var i=0;i<e.CustFields.length;i++){r=0;for(var a=0;a<e.subProcesses.length;a++)e.subProcesses[a].idCustData==i&&(e.subProcPersonalized[i]=e.subProcPersonalized[i]||{},e.subProcPersonalized[i].subProcesses=e.subProcPersonalized[i].subProcesses||{},e.subProcPersonalized[i].subProcesses[r++]=e.subProcesses[a]);-1!=e.subProcesses[i].idCustData&&null!=e.subProcPersonalized[i]&&(e.subProcPersonalized[i].CustFields=e.CustFields[i],e.subProcPersonalized[i].idCase=e.idCase)}}t.resolve(e)})),t.promise()},summaryCaseEvents:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseEvents({idCase:r})).done((function(e){e.showEvents=e.events.length>=1,t.resolve(e)})).fail((function(e){t.reject()})),t.promise()},summaryCaseDetails:function(e){var t=new $.Deferred,r=e.idWorkitem||0;return $.when(this.getCaseSummaryDataContent(e)).done((function(e){e.currentState=e.currentState||[];var a=e.currentState.length;for(e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosedForAllUsers=bizagi.util.parseBoolean(e.isClosed),e.isClosed=!bizagi.util.parseBoolean(e.isOpen),e.showAssignees=!!(bizagi.override.showAssignees&&e.countAssigness>0),e.showSubProcess=e.countSubProcesses>0,e.showForm=!!bizagi.util.parseBoolean(e.hasGlobalForm),e.allowsReassign="false",i=0;i<a;i++)e.currentState[i].idWorkItem==r&&(e.allowsReassign=e.currentState[i].allowsReassign);var s=[],o=0;for(i=0;i<a;i++)!bizagi.util.parseBoolean(e.currentState[i].isEvent)&&bizagi.util.parseBoolean(e.currentState[i].assignToCurrentUser)&&e.currentState[i].idWorkItem!=r&&(s[o++]=e.currentState[i]);e.currentStateTypes=s,e.showActivities=s.length>0,t.resolve(e)})),t.promise()},releaseActivity:function(e){var t=this.serviceLocator.getUrl("case-handler-releaseActivity");t=t.replace("{idCase}",e.idCase);var r={};return e&&(r.idCase=e.idCase,r.idWorkItem=e.idWorkItem),$.ajax({url:t,data:r,type:"POST",dataType:"json"})},summaryActivities:function(e){var t={},r=e.data||{},i=i||e.idWorkitem||0;try{t.showActivities=r.currentStateTypes.length>=1,t.currentState=r.currentStateTypes,t.globalIdWorkitem=i,t.creationDate=r.creationDate}catch(e){}return t},getCaseSummaryDataContent:function(e){var t=this,r=new $.Deferred;return $.when(t.getCaseSummary(e)).done((function(e){e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),r.resolve(e)})),r.promise()},getSmartFolders:function(e){var t=this,r={};return r.idFolder=e||"",$.read(t.serviceLocator.getUrl("folders-handler-getUserQueries"),r).pipe((function(r){return-1==e||""==e?r:t.searchFolders(e,r)||[]}))},deleteSmartFolder:function(e){var t={action:"6"};return e=e||{},t.idSmartFolder=e.idSmartFolder||"",t.idUser=e.idUser||"",$.destroy(this.serviceLocator.getUrl("folders-associate-deleteSmartFolder"),t)},getFolders:function(e){var t=this,r={action:"getUserFolder"};return r.idFolder=e||"",$.ajax({url:t.serviceLocator.getUrl("folders-handler"),type:"POST",data:r,dataType:"json"}).pipe((function(r){return""==e?{folders:[{name:bizagi.localization.getResource("workportal-widget-folders"),id:"-1",idParent:0,childs:r}]}:-1==e?r:t.searchFolders(e,r)||[]}))},searchFolders:function(e,t){for(var r=0;r<t.folders.length;r++){if(t.folders[r].id==e)return t.folders[r].childs}},getCasesByFolder:function(e){return e=e||"",$.ajax({cache:!0,url:"RestServices/"+e,type:"GET",dataType:"json"})},makeFolder:function(e){var t={action:"CreateUpdateFolder"};return t.folderName=e.folderName||"No Name",null!=e.idParentFolder&&e.idParentFolder>1&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},updateFolder:function(e){var t={};return e=e||{},t.action="CreateUpdateFolder",t.idFolder=e.idFolder||"",e.folderName&&(t.folderName=e.folderName),e.idParentFolder&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},associateCaseToFolder:function(e){var t={action:"4"};return e=e||{},t.idCase=e.idCase||"",t.idCustomFolder=e.idCustomFolder,$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},dissasociateCaseFromFolder:function(e){var t={action:"DeleteCaseFromFolder"};return e=e||{},t.idFolder=e.idFolder,t.idCase=e.idCase,$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},deleteFolder:function(e){var t={action:"5"};return e=e||{},t.idCustomFolder=e.idCustomFolder||"",$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},getFile:function(e){var t={},r=this.serviceLocator.getUrl("file-handler");return e=e||{},t.action="getFileContent",t.uploadId=e.uploadId||"",t.entityId=e.entityId||"",t.entityKey=e.entityKey||"",bizagi.services.ajax.pathToBase+r+"?"+jQuery.param(t)},getComments:function(e){var t=this;return e=e||{},$.read(encodeURI(t.serviceLocator.getUrl("MessageHandler-GetComments")),{idCase:e.idCase||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:"",pag:e.pag||1,pagSize:e.pagSize||10}).pipe((function(e){var r=new $.Deferred,i="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";return e.comments?$.each(e.comments,(function(t,r){e.comments[t].hasOwnProperty("CategoryColor")||(e.comments[t].CategoryColor="")})):e.comments=[],e.users?$.each(e.users,(function(t,r){e.users[t].Picture=""===e.users[t].Picture?i:e.users[t].Picture})):$.when(t.getCurrentUser()).done((function(t){e.users=[],e.users.push({Id:t.idUser,Name:t.user,DisplayName:t.userName,Picture:i})})),r.resolve(e),r.promise()}))},makeNewComment:function(e){return $.create(this.serviceLocator.getUrl("MessageHandler-NewComment"),{idCase:e.idCase||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe((function(e){if(e.comments){var t=[e.comments];$.each(t,(function(e,r){t[e].CategoryColor=""})),e.comments=t}if(e.users){var r=[e.users];$.each(r,(function(e,t){r[e].Picture=""==r[e].Picture?"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABJwSURBVHhe7Vt5UJPnuj+ddvSqdcpotQougCyGRfY9QCQQwhKIrAqurUtbbbVV1KO2UrXH46lL1aOOdWvrcl3QuosIBUSGongA5bLXqLjCVbarrX/97vO8SSAieLRVJ86czPwmX0L8vve3PM/7vp/JX/7yn8d/FHhVCkykC+144403NL16vQ1TU1MtBpqiR48eoL8VE9YQnF/VgF7VdVLffPPNRkdHJ0SER0CpDIdCEYqQkBAtgvlZgdDQUHh5ecHMzIzFyCbIXtUAX9Z12MliN1c3JCcnIzkpGWp1jCBrSD6YBAgODoZczpALBMmCYGFhwULsIJi8rAG+zPM6s+vseGLiaMTFxSM2JlaQl8lkAoGBgQgMCERAQAD8/f0hlfrDz88Pfr5+8PX1FXByctKXxmslgiAfEqxAdFQ0VKooqCJVwnVvb1+Ct4i6l6cXPDw8CR5wd3OHm5sbXF1d4ezMcIYTlQwLYGNjoxfhZRr2ws7NTmm8vLwRSnWuIMelflK46kkRISbl6OAIB4K9vT3s7ewhkdgRJLC1sRWEra2tYWVlhWHDhonnPn36sAjcII3+kWplZQ0Pd08RYXt7Bx0pW0FKT8xqmBUsLYfB0sISFkMtMHToUAwZPASDBw8WTdDU1AwDBw4UGDBggAClikUwN2YFTLp37y5izvFlId7t+y4G9B8gSGmJaae9gQO0xPr3649+/fqJz/UlsNN9TPrAxMRE4J133hGf43RwEnRN0Wg1mMVR5q5vQc72pLl99sfj0b3bW3j77beJYF8t+vRtI9qjR0+80/sdIqoly8e9e/d+DJaWlrC1tRXlwn8z5lmh2MvTm2rYFt26dcOSeTNQnn8U2Ue2w8pyCHp076EjTwIIl/vgrbfeYkKCGAvQ+ykCcAq4VOjzE40xAiYm5CIvdvpRrHv26I6a8+nQXMxAbdFpFGcfxJTx8YIsk9fHnB3n9xicho7uc3K4D3ACGNxDjLUZyrh+hwwZSvXcD3J/T1wrPYNrJRkC10uzUPFLOnZvWQ13Zwf06tVL29yoPzBJqZc7fD2cRaN7913qG/Q3fuY+wKLwbMACGKwSjS4EsoHU3MzMBoOTwLVfV5pJOCNw41I2bpadxbVLubiUn46VyxZhYP9+QghujBx/pVyKr+d/goH9+gpRWAR2n4Xg1wwWmfcSRsee65IF4O7OdTxn+gTcvJyFm5cyBW6V5eB2xTncrvoFd2qKoLmcj5L8DHy37hsE+HmR828xMVgOMcWejcsw98MkSN3tRY/gBOgF4EToSsbo+oBMTG0UaRZg/fL5uFOWTcgSuFuRi7uV+aivKUTDlYtouFqKe9fLUVddgrLCLGQc/hGLPp+GQF83mPZ/F9tXzkPegfU4vHkJUmeOx9houSCuE4B3jWpjS4GMu3p/FuDtXqgsOIr6ihzUl2cLNFSeRUN1Ae7VXsD9qyVovH4JTTcq0XyrBo115bhbfQG1FzJQmrUfpWd24VbREdwpOoTrBftQkfk9StO3GApglCtCE65nruUFMz8gwrm4V0WozCHkorEmH02a82i5XoLWG5fx8E4VHt6txcP6q3hwuwotdaVovHIe96vO4l7ZGTSUHkd98WHUXzxEOIj6ojT4eziAF1rkfKqxuS/G06vHfzXy9HZo+2oikovmmjy01BKunEPr1UI8uF6EhzdK8dvtcvx2txq/37uKR/ev47f6WvHew7pitF4pQFNlFu5dOoF7JUcIh3Gv+BDukQiBXo7o2bMnkiOkvEU2rsepTYsmTklQigXQ0R/XoonIN1ZRCVzOQF3RUdy4eAI3S07jFs0It2hGaL5eSgJo8KhRJ8CtMjRQn7hRdBx1hRT9/L24lrcL1wm3C/eRAGmQ+7qKafIfcyfjxIZFxtUDTmxamHpwy3JRp0d/WIP6skxcPX8ENXn7tTiXhqqzB1CZewDl2VTXOQdwX1NCCbhGCagRopRn7iLsRGXWTlRR3ddkfY/abC2uZG+Hr6stYkOlyNi9Fic3LphlVBFgRzL3rINc6o7D36+ixpeJO5cycLs0nVxnZBDJLJoOc2k9kIfawpO4XpzZJoCm8DiuFaWjrphw4QjqqPnV5e/GDcJNwp3CvVi9YDLy9qxC5u7VOLVpocyoBDi1abH52X1ryZ3VKCMn66mRNVVlaxtaWQYayrNoVshFfRVNhdWFtCYowNWiDDy6RwmgfnC7/BzulucK0e4UH8edC2m4c36fQP2FfWgsPoCajC24eHQT8ug6P61ZbGJUAvBgzmxdqrlB7p3bv0643lKdQ6B6r8pCU3Uu9QWaCa4UounqRTReLUZFbppohCwAv3e/Oh/3K7Jx/3K6aH73i9MEGhkXqXRObsSVvL04tflLXgcY34PLoOjwP5Gz8x+4UXyCunkmWog8o5Vmg1bNLzQTXMRvNBM0XrlgIECVeO/htfNorTmLlvIMNJUeQWPJwTbyjRf345e934DPb3QN0NAKHtzhdXM1tef2o+HyaTSTCM1VmYJYq6YAD64VCbL1tCoUCWjQUAJ0AtBU2UpJaSk/TQIcfox8w/k9OLFxocaoyeuFOLouRV14aANulxwnAc4IEVprcmmOzycBLtB8X4o62iZX5OgEuFOpTYCGBchBc5lOAIo9O8+ozviOGt8io1v/d1mHxzYs1Fw7fwjNFRlCBCbWWnsOD66eJwFKUJ13SEyFIgFCgBI8oBJpocbZXJaOppJDbeRZgPzdf2/8aYcRNr6uFDi4NiW1NH0bLWlPCBFaqRlqBShEMy159WuB3xuuCAFYlAdUIkKAyydJAKp/nfvXcraT+18a5fq/ywTwNJW+dUljXeFBNFNTa9U1wgcU84fXi2lKzKOF0SFKAAlwu0IrAC2DW2gZ3HyZGqiBAOQ+Tu1Ybm58bf/fjIhTUHhwPRrJ0RbRB86KmD/kmeDmJXK+Cr/XswC0DyBRHlCP6CgAu396y1fGufl5FkfSVqdoNDR3t3AfoEbILrcLUEkC6DZCJEpHAbjzZ21bguzXqfY7inJk/bzU01uXUC84KRohk3yomwq59oUAtBFiUToKUHKI1vybv+D9xev7OLBqdmpe2gZcOLIJTRVZbQJot8UsQE2nAlRnbEPe7hU4s33p6y3AwbVzf6osPIHMXatQcnIbWmib/OAqrQWEABWdClCbsxOZ25eh/DSt/SkFp79b7PzaRuDExkXZdbQLrCg4JkS4cGwrmmupD9BiqDMBanL3kOvLaNOzgTZB+3Hp2Aac2rLYuHZ+z+PGqiUp2Q/qLtJuLwdVdJ/wwvFtyPh+BYpP78QN+r8C3gXepnsB1WfTkLNrJU5Sv/jl0HrcKNgjFkNHvluKxTMnvz4rQBYnOjraPDIycs1IpVrj6S9HQcY+tNISuJlmgJt0X6A0ay/O7F2Hw0Ru/7qF+OGbFPy4ai69XoJ8mjYr6WYI3wW6SSKMT1TDL3oilFHxGpVKlcrnfh4DXulnaYATw1SjsmWxk+GS/CXsx6+Ac9znUCpCsHPzSnFfkPcDfHOk/Ox+nDv8HY5uX4E9//wSaXT7+wwl4PyRjUIAvgs8LoHIK+NgN26FOBefk8/N1+BrvVJyXV2MHWFnFOrRjd6jZ8Nx3NdisIbwSPgMsuBQxKhV2LlpBUqz9wsBCqgfnPxxVZsAx7b9DdtWzkfK9IniuwU+ihjYJS974nx8Db5WaFR8oy4VJq9cDF3Md4SMGgv3pAVPDLKjCE5jl0AaMxUjQ1Xi+0BMcNzoWIyJi0K8OgKhIXLx/SD+3pBvRBJcEufDTgj5d9iPM8Ryek0Yuxx2BLfR8xE8KhlUcjteSXnQRUxY9Wcl3lEIJuSS9AU8ElPgE/shvEZNE3CLm0mk5wlSdmP/pkUy42sDLINdkh5L6ZgwZikkBNeEFMjVSS83EeHh4c4RqlGaJx0nh/6NU12SaiPExLSE9KQkY5YQOcJoxlftSEyFpA2LIUnQYjjBPXYm94hiHusLLQs+oUKd2OiYTAPUxe+FkUokck8hNTzhSwyPZ3zxOOIWYXgbFmJ4rBZ2sfMQokpofGEicOzDyXmHMam6CHblkoFTTyVFZDojFUcEuyBlG7sAAjGMvz6OUfNhKzBPC/U8SNRzKAnqF3PzlOd01/g5HVziGLZHTxB6UaRGEcFOSDExG/VcLaIZKe2IouOoOTrMpufZcFVNo+8oqv7cVppjFKQeB4lBBG05ap04xe936VQbocedsnkqKT0hfiZSqnZYqz6HdaQen9GxFlbhn8I6YlYbRqpG40/NDqRgtnM8RSquPX7Dwj/RRvAFkrImcl2RMiRkHTET1uHtYMJWYYxPBCxDpmFY6HRYKWfAOmwGHCI+FlPkH2qIERERsqBRE+AQvwCSmPlt8bMImdohfp07JQh15lTEZ1i3Ox38SJ6/ntzqQKgDKUFOyZhhACLJRHUYFvoxhik+hqV8MsxHTqLjj2BN7w0PnwGZaswfSwG5/5M71b5j7HxqKlRjOpcGS8c8GT+D2GkdezqpdbtOagWYu7ZTUoKQjhSTaUMIHYd82I5gcrwNU2FB5If4jSEhpsCa0jBc+RGcwqc9fwq4buRU+y7x8+EYkwJJ1OewIWIWwVMwyDtO1FrH+GmdMnSJjzu4pCO1dudxIUDSnNXwSpiDUdO/hrN6lpaYASnL4KkQkDOmtCOIjoMm6/ABLEdqMVSaDDP3aDp+H9aUBoliGhzCPoI8MuH5UsCd3yd2BlxiU+Co/hwSFblKNTVEmgQzrxhRaxy/rp0ycKkTUmt/OCoE+HHPfvz888/49ddf8ejRI6Sl58M5imo5qJ0UE7MgQhYyPSbRsQ6BE2HRhgkY4pOIAU6hsAycAOugSZCETIaDciq8wyfwjDDrmXtBuCpW4xGfApcY2uBEzYIk4hNRU4O8YmHmqYYFDdAweu0uGTj1mEvsVjupb78/IgRYunIjZi5eg282/zf+936TeC8j71+PkbIImAA9zAPGw9xfj3F0rIN0LMwJg73i8J6DHOa+o2EtmwCJfBIcFZPhpJwCZYT62b5ep5/6PGJnw4Vi6Rj5CSRhH8Oa4jTQOUxEjFXXRtDQKXKoM6cec4kdm4Bvd/wkyI7+dDn0pEaEfYjm1gfifWn8Z4JQO5Jh7qdHEob6EXwZY9rhMwaDPWLwnn0QhnrGwDpgLCQjJ8AxZBJclJMRGJaAZ1od8uJBGvMhPGJmwSXqUzjSVCIJnQZrqn8+uambSijfHj0iZeCSBbvUmVMGhNZsOyiITv3rah0xLamCf5WL9xOnL9ESI1JDfUa3wzsRQ9uQgCFeesTTcTwGuUXjPYkMg8goG/8xkMjGwlE+AS6KSfBUJD9TGXQjlU66Rc2Ah/pTuKimw5GcsVNQVw16H/1s/WDqEikGK+L3mEvkWJtL7JbepY5OjcZX3/4giBZc/J82QmHj5rYlwFc9XRAS8NQjjo518IjFkDbEYLC7FoNcVHhveCAGjQiBjV8iJAFJGBE0Fi4hE+AUNI6325upDwwjvNlVP3DkD/lEvg/P6OlwjfgII6iJ2AW/Dyv/JPRnAUhd4cpj8TNwif9m4NJQ7yedciBX6m7VCxH4mYVobvk/8XrrnmNErp3UYPdRRI7gxlAbIBqDXQ0RBTOncAwY7o+BBBvfOEj8EzFCRvcX5OMgVSbS75KkK4m4G0HSlQBu9J1+mUKhyB6pSoZb+GSMUHwAuyCqee8Y9LfxhamTUufO4/HTOmXgEh8buNSRlI9qKgqKLgvS/GABtu4++gSpQS5R5CxDpYUzI7IdThEYpIOZoxIDbKUYaOMDGxqvnV88nAMTEUi31pgTc9MJwCJ0+uiv/wD9tmeqUqnMDoqIp/qhxY831Red2NRRIZoNE3p+p6KIoJ6QISkDQkzOgNQgcpVhNoJBTZjhqIeSjnVwCIWZfQgG2PhhkK0PPGVqyJVq+p2iMpu5GBBn8n2fNiX21tUJf1AkwsfHJ5V+23csSBF5y1sWCSf/aEh89PH7g6QEoY6kDAgxMSbVBgURVMBUIKQddiGwdQuFs68SvrJwjJSH3eKx8pg7OM58zAndnnU9wI2CleJ/5KhXkE/KinKv4AvJFcoiaVDErYDgSHgERMKdYO8dgeGe4QJWbkRS79JzkDK1C4aVi0KQs3VTwM4jFO7SMAH/oHBIRypvyYNDi+iHlnt4LDymTgjzuHn8zKPLxvesgrByJgRTXUJsOsRKpIUHwmAHeGCG4DqkSBY9DSxqx39Hvy2crT9vJyRFUgk8Hu7wPD4e5zM7/awCdPU5VpbLhsE9hAdgKBIPTA/njqJ18Zo/Z/jvDMnxufk6+mv+qfH/Pz9r9qvYcZe2AAAAAElFTkSuQmCC":r[e].Picture})),e.users=r}return e}))},makeNewReply:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("MessageHandler-ReplyComment"),{idCase:e.idCase||"",idComment:e.idComment||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe((function(e){if(e.comments&&(e.Replies=[e.comments]),e.users){var t=[e.users];$.each(t,(function(e,r){t[e].Picture=""==t[e].Picture?"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":t[e].Picture})),e.users=t}return e}))},removeMobileComment:function(e){var t=this.serviceLocator.getUrl("remove-comment");return e=e||{},$.destroy({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},removeComment:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveComment"),{idCase:e.idCase||"",idComment:e.idComment||""})},removeReply:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveReply"),{idCase:e.idCase||"",idComment:e.idComment||"",idReply:e.idReply||""})},renameCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-RenameCategoryColor"),{idColorCategory:e.idColorCategory>=0?e.idColorCategory:"",colorName:e.colorName||""})},setCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-SetCategoryToComment"),{idCase:e.idCase||"",idComment:e.idComment||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:""})},getCommentsCategories:function(){return $.read(this.serviceLocator.getUrl("MessageHandler-GetCategoryColors")).pipe((function(e){return e.length>1&&e[0].categories?e[0]:e}))},getNewComments:function(e){return e=e||{},$.read(encodeURI(this.serviceLocator.getUrl("MessageHandler-CountNewComments")),{idCase:e.idCase||0,idComment:e.idComment||0})},getAnalisysQueries:function(){return $.read(this.serviceLocator.getUrl("bamAnalytics-handler-getAnalisysQueries"))},updateQueries:function(e){return $.update(this.serviceLocator.getUrl("bamAnalytics-handler-updateQuery"),{idQuery:e.idQuery>=0?e.idQuery:"",queryName:e.queryName||"",queryDescription:e.queryDescription||""})},deleteQueries:function(e){var t={action:"1612"};return t.QueryId=e||"",$.destroy(this.serviceLocator.getUrl("reports-handler-deleteQueries"),t)},getConfiguration:function(){var e=this.serviceLocator.getUrl("authenticationConfig");return $.read(e)},logout:function(){sessionStorage.removeItem("bizagiAuthentication");try{var e=$.create(this.serviceLocator.getUrl("logout"));$.when(e).done((function(){location.reload()})).fail((function(){bizagi.log("Error logging out")}))}catch(e){}},logoutMobile:function(){var e=this,t={sourceLogout:"user"};if(sessionStorage.removeItem("bizagiAuthentication"),bizagi.util.removeLastProcessInbox(),bizagi.util.isCordovaSupported()){var r=e.serviceLocator.getUrl("logout");return $.create(r)}try{$.when(e.getConfiguration()).done((function(r){if(r.redirectErrorPage)window.location.href=r.redirectErrorPage;else switch(r.authenticationType){case"Federate":var i=r.logOffURL,a=r.federationLogoutBindingProtocol,s=r.authenticationSubType;if("WSFederated"===s)$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){location.href=i})).fail((function(){bizagi.log("Error logging out")})).always((function(){location.href=r.logOffURL}));else if("Saml"===s){$.when($.read(e.serviceLocator.getUrl("FederateLogoffUrl"),{})).done((function(r){r.federateLogoffUrl&&(i=r.federateLogoffUrl),$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){"POST"===a?(window.document.open("text/html"),window.document.write(i),window.document.close()):window.location.href=i})).fail((function(){bizagi.log("Error logging out")})).always((function(){}))})).fail((function(){bizagi.log("Error logging out")})).always((function(){}))}break;case"SAML":loader.nativeAjax(loader.getPathUrl(e.serviceLocator.getUrl("logout"),t),(function(e){var t=JSON.parse(e.responseText);if(!0===t.logout)if(void 0!==t.samlUrlRedirect){var r=decodeURI(t.samlUrlRedirect),i=document.createElement("iframe");document.getElementsByTagName("body")[0].appendChild(i),$(i).on("load",(function(){(bizagi.util.isIE8()?$(this.contentWindow.document.body):$(this.contentWindow.eval("document.body"))).text();location.reload()})),i.src=r}else location.reload();else bizagi.log("Error logging out")}));break;case"OAuth2":$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){$.when($.read(e.serviceLocator.getUrl("oauth2AuthenticationConfig"))).done((function(e){if(e.logoutUrl&&""!=e.logoutUrl){var t=e.logoutUrl,r=e.homeUrl;t=t.replace(/post_logout_redirect_uri=[^&]*/,"post_logout_redirect_uri="+r),location.href=t}else location.reload()})).fail((function(){bizagi.log("Error logging out")}))})).fail((function(){bizagi.log("Error logging out")}));break;default:$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){window.location=bizagi.services.ajax.loginPage})).fail((function(){bizagi.log("Error logging out")}))}})).fail((function(e){bizagi.log(e)}))}catch(e){bizagi.log(e)}},getOrganizationInfo:function(e){var t={};return t.objectType=e,$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getOrganizationInfo"),data:t,type:"GET",dataType:"json"})},getCasesByOrganization:function(e){var t={};return t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getCasesByOrganization"),data:t,type:"GET",dataType:"json"})},reassignCases:function(e){var t={};return t.users=e.user?"["+e.user.toString()+"]":"[]",t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-reassignCases"),data:t,type:"POST",dataType:"json"})},searchUsers:function(e){var t={};return t.userName=e.userName||"",t.fullName=e.fullName||"",t.domain=e.domain||"",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-searchUsers"),data:t,type:"GET",dataType:"json"})},getDomainList:function(){var e=this.serviceLocator.getUrl("domains");return $.read(e)},getEcmAllScheduledJobs:function(){var e={action:"getEcmAllScheduledJobs"};return $.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),e)},retryECMPendingScheduledJob:function(e){var t={action:"retryECMPendingScheduledJob"};return t.idJob=e,$.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),t)},getWorkPortalVersion:function(){return $.ajax({url:this.serviceLocator.getUrl("WorkPortalVersion"),type:"GET",dataType:"json"}).always((function(e){return""==(e=e||{}).version&&(e.version=bizagi.loader.productBuild||""),e}))},getAuthenticationLogData:function(e){var t="";return t="domains"==e.dataType?"admin-getAuthenticationDomains":"events"==e.dataType?"admin-getAuthenticationEventsTypes":"admin-getAuthenticationEventSubTypes",$.ajax({url:this.serviceLocator.getUrl(t),data:{},type:"GET",dataType:"json"})},getAuthenticationLogResult:function(e){var t={};return t.action=e.action,t.domain=e.domain,t.userName=e.userName,t.dtFrom=e.dtFrom,t.dtTo=e.dtTo,t.eventSubType=e.eventSubType,t.eventType=e.eventType,t.pag=e.pag,t.pagSize=e.pagSize,$.ajax({url:this.serviceLocator.getUrl("admin-getAuthenticationLog"),data:t,type:"GET",dataType:"json"})},encryptString:function(e){var t={};return e=e||{},t.entry=e.entry,$.ajax({url:this.serviceLocator.getUrl("admin-EncryptString"),data:t,type:"POST",dataType:"json"})},userPendingRequests:function(e){var t={pag:e.pag,pagSize:e.pagSize};return $.read(this.serviceLocator.getUrl("admin-UserPendingRequests"),t)},userAuthenticationInfo:function(e){return $.read(this.serviceLocator.getUrl("admin-UserAuthenticationInfo"),{idUser:e.idUser})},updateUserAuthenticationInfo:function(e){return $.create(this.serviceLocator.getUrl("admin-updateUserAuthenticationInfo"),{idUser:e.idUser,password:e.password,enable:e.enable,expired:e.expired,locked:e.locked})},generateRandomPassword:function(e){return(e=e||{}).action="generateRandomPassword",$.ajax({url:this.serviceLocator.getUrl("admin-generateRandomPassword"),data:e,type:"POST",dataType:"json"})},generateDataToSendByEmail:function(e){e=e||{};var t={action:"GenerateDataToSendByEmail"};return t.idUser=e.idUser,t.password=e.password,$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendEmail:function(e){e=e||{};var t={action:"sendEmail"};return t.emailTo=e.emailTo,t.subject=e.subject,t.body=e.body,$.ajax({url:this.serviceLocator.getUrl("admin-sendEmail"),data:e,type:"POST",dataType:"json"})},getApplicationCategoriesList:function(e){var t={},r="";return"Applications"==e.action?(r="admin-getApplicationList",$.ajax({url:this.serviceLocator.getUrl(r),type:"GET",dataType:"json"})):(r="admin-getCategoriesList",t.idApp=e.idApp,t.idCategory=e.idCategory,""==t.idCategory&&(t.idCategory=-1),void 0!==e.filterStartEvent&&(t.filterStartEvent=e.filterStartEvent),$.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"GET",dataType:"json"}))},getAdminCasesList:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-getCasesList"),data:t,type:"GET",dataType:"json"})},getApplicationProcesses:function(e){var t=this.serviceLocator.getUrl("admin-getApplicationProcesses"),r={};return r.idApp=e.idApp?e.idApp:-1,$.read(t,r)},getProcessVersion:function(e){var t=this.serviceLocator.getUrl("admin-getProcessVersion"),r={};return r.idWfClass=e.idWFClass,$.read(t,r)},getProcessTasks:function(e){var t=this.serviceLocator.getUrl("admin-getProcessTasks"),r={};return r.idWfClass=e.idWFClass,r.version=e.version?e.version:void 0,$.read(t,r)},getTaskAlarms:function(e){var t=this.serviceLocator.getUrl("admin-getTaskAlarms"),r={};return r.idTask=e.idTask,$.read(t,r)},getLapseMode:function(){var e=this.serviceLocator.getUrl("admin-getLapseMode");return $.read(e)},getRecurrMode:function(){var e=this.serviceLocator.getUrl("admin-getRecurrMode");return $.read(e)},getScheduleType:function(){var e=this.serviceLocator.getUrl("admin-getScheduleType");return $.read(e)},getBossList:function(e){var t=this.serviceLocator.getUrl("admin-getBossList");return $.read(t)},addAlarm:function(e){var t=this.serviceLocator.getUrl("admin-addAlarm"),r={};return r.idTask=e.idTask,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},editAlarm:function(e){var t=this.serviceLocator.getUrl("admin-editAlarm"),r={};return r.idTask=e.idTask,r.idAlarm=e.idAlarm,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},deleteAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarm");return e.idAlarm,$.destroy(t,e)},getAlarmRecipients:function(e){var t=this.serviceLocator.getUrl("admin-alarmRecipients"),r={};return r.idAlarm=e.idAlarm,$.read(t,r)},addRecipientToAlarm:function(e){var t=this.serviceLocator.getUrl("admin-recipientToAlarm"),r={};return r.idAlarm=e.idAlarm,r.idRecipient=e.idRecipient,$.update(t,r)},deleteRecipientsFromAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarmRecipients"),r={};return r.idRecipients=e.idRecipients,$.destroy(t,r)},enableAlarm:function(e){var t=this.serviceLocator.getUrl("admin-enableAlarm"),r={};return r.idTask=e.idTask,$.create(t,r)},abortReassignItems:function(e){var t=e||{},r="abort"==e.action?"admin-abortItems":"admin-reassignItems";return $.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"POST",dataType:"json"})},asyncActivitiesServices:function(e){var t=e,r="",i="GET";return"getActivities"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-get-activities"):"retryNow"==e.action?(i="POST",r=(r=(r=(r=this.serviceLocator.getUrl("admin-async-activities-get-retry-now")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkitem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem)):"getActivitiesByTask"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-get-activities-by-task"):"enableExecution"==e.action?(i="POST",r=this.serviceLocator.getUrl("admin-async-activities-enable-execution")):"enableMultiple"==e.action?(r=this.serviceLocator.getUrl("admin-async-activities-enable-multiple"),i="POST"):"asyncExecution"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-async-execution"):"asyncExecutionLog"==e.action?r=(r=(r=(r=this.serviceLocator.getUrl("admin-async-activities-async-execution-log")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkItem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem):"getAsyncExecution"==e.action&&(r=this.serviceLocator.getUrl("admin-async-activities-async-get-current-execution-log")),$.ajax({url:r,data:t,type:i,dataType:"json"})},getDefaultAssignationUserToAllProcess:function(e){return $.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToAllProcess"),{serviceAction:"getDefaultAssignationUserToAllProcess"})},getDefaultAssignationUserToProcess:function(e){var t;return t=""==e.idWFClass?-1:e.idWfClass,$.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToProcess"),{serviceAction:"getDefaultAssignationUserToProcess",process:t})},setDefaultAssignationUserToProcess:function(e){return""==e.idWFClass?process=-1:process=e.idWfClass,$.create(this.serviceLocator.getUrl("admin-setDefaultAssignationUserToProcess"),{serviceAction:"setDefaultAssignationUserToProcess",process:process,idUser:e.idUser})},getProcessIcon:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("process-getIcon"),data:t,batchRequest:!0})},getCollectionIcon:function(e){var t={collectionId:e.collectionId};return $.read({url:this.serviceLocator.getUrl("collections-getIcon"),data:t,batchRequest:!0})},getProfilesTypes:function(e){return $.read(this.serviceLocator.getUrl("admin-getProfilesTypes"))},searchProfiles:function(e){var t=this.serviceLocator.getUrl("admin-searchProfiles"),r={};return r.type=e.profileType,r.name=e.profileName,r.orgId=e.orgId?e.orgId:null,$.read(t,r)},getUsersByProfile:function(e){var t=this.serviceLocator.getUrl("admin-getUsersByProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,$.read(t,r)},removeUserFromProfile:function(e){var t=this.serviceLocator.getUrl("admin-removeUserFromProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.destroy(t,r)},addUserToProfile:function(e){var t=this.serviceLocator.getUrl("admin-addUserToProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.update(t,r)},licenses:function(){var e=this.serviceLocator.getUrl("admin-Licenses");return $.read(e)},getDimensions:function(){var e=this.serviceLocator.getUrl("admin-GetDimensions");return $.read(e)},editDimension:function(e){e=e||{};var t={};t.id=e.id,t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.description=e.description;var r=this.serviceLocator.getUrl("admin-EditDimension");return $.create(r,t)},createAdministrableDimension:function(e){e=e||{};var t={};return t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.Description=e.description,$.ajax({url:this.serviceLocator.getUrl("admin-CreateAdministrableDimension"),data:e,type:"PUT",dataType:"json"})},deleteDimension:function(e){var t=this.serviceLocator.getUrl("admin-DeleteDimension");e=e||{};var r={};return r.id=e.id,r.idDimension=e.id,r.administrable=e.administrable,$.destroy(t,r)},entityPathChildNodesAction:function(e){e=e||{};var t={};return t.pathNodeType=e.nodeType,t.idNode=e.idNode,t.nodeDisplayPath=e.nodeDisplayPath,t.nodePath=e.nodePath,t.idWfClass=e.idWfClass,$.ajax({url:this.serviceLocator.getUrl("admin-EntityPathChildNodesAction"),data:e,type:"GET",dataType:"json"})},getActiveWFClasses:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-GetActiveWFClasses"),data:t,type:"GET",dataType:"json"})},storeDocumentTemplates:function(){var e=this.serviceLocator.getUrl("admin-document-templates-storeDocumentTemplates");return $.read(e)},restoreDocumentTemplates:function(e){var t=this.serviceLocator.getUrl("admin-document-templates-restoreDocumentTemplates");return t+="?Guid="+e.Guid,$.read(t)},getWorkFlowClasses:function(){var e=this.serviceLocator.getUrl("admin-processes-workflowClasses");return $.read(e)},getTaskByWorkFlow:function(e){var t=this.serviceLocator.getUrl("admin-processes-tasksByWorkflow"),r={};return r.idWorkflow=e.idWorkflow,$.read(t,r)},modifyProcessDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyProcessDuration"),r={};return r.idWorkflow=e.idWorkflow,r.duration=e.duration,$.create(t,r)},modifyTaskDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyTaskDuration"),r={};return r.idTask=e.idTask,r.duration=e.duration,$.create(t,r)},getDataForMyTeam:function(){return $.ajax({url:this.serviceLocator.getUrl("bam-resourcemonitor-myteam"),type:"GET",dataType:"json"})},getReporstAnalysisQuery:function(){return $.read(this.serviceLocator.getUrl("reports-analysisquery"))},updateReportData:function(e){return $.update(this.serviceLocator.getUrl("reports-analysisquery-update"),e)},deleteReportData:function(e){return $.destroy(this.serviceLocator.getUrl("reports-analysisquery-delete")+"?"+e)},getStoreLanguageTemplates:function(){var e=this.serviceLocator.getUrl("admin-language-languages");return $.read(e,{justActives:!1})},getLanguageTemplate:function(e){var t=$.Deferred(),r=this.serviceLocator.getUrl("admin-language-resource")+"?cultureName="+e.cultureName;return t.resolve("OK"),window.location.href=r,t.promise()},processDefinition:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processdefinition"),e)},graphicInfo:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processgraphicinfo"),e)},getLastUpdateByMobile:function(){return $.read({url:this.serviceLocator.getUrl("mobile-getLastUpdate")})},getCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getCollectionData");return t.idFact=e.idFact,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe((function(e){return e}))},getVirtualCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getVirtualCollectionData");return t.guidVirtualCollection=e.guidVirtualCollection,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe((function(e){return e}))},getSearchData:function(e){var t=this,r=t.serviceLocator.getUrl("my-search-getData");r=r.replace("{guidSearch}",e.guidSearch);var i=e.filters||[],a={filters:JSON.stringify(i),pag:e.page||1,calculateFilters:e.calculateFilters||!1,pagSize:e.pageSize||10};return $.read(r,a).then((function(e){return t.serializeEntityData(e)}))},getCollectionEntityData:function(e){var t,r=this,i={templateType:"VIRTUAL"===(e=e||{}).referenceType||"FACT"===e.referenceType?"List":"Content",surrogateKey:e.surrogateKey,pag:e.page||1,pagSize:e.pageSize||10,defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return"VIRTUAL"===e.referenceType?(t=r.serviceLocator.getUrl("data-navigation-handler-collection"),i.reference=e.reference):(t=r.serviceLocator.getUrl("data-navigation-handler-entity"),i.reference=e.guidEntityCurrent,i.xpath=e.xpath,i.collectionId=e.reference),$.read(t,i).then((function(e){return r.serializeEntityData(e)}))},getFiltersEntityData:function(e){var t={reference:(e=e||{}).guidEntityCurrent,collectionId:e.reference,surrogateKey:e.surrogateKey,xpath:e.xpath,templateType:"List",defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return $.read({url:this.serviceLocator.getUrl("data-navigation-handler-entity-filters"),data:t})},getProcessAddAction:function(e){var t=this.serviceLocator.getUrl("action-handler-getProcessAddAction");return $.read(t,e).pipe((function(e){return e}))},getMultipleActions:function(e){var t=this.serviceLocator.getUrl("templates-handler-getMultipleActions");return $.read(t,e).pipe((function(e){return e}))},getMapping:function(e){return $.ajax({url:this.serviceLocator.getUrl("process-handler-getMapping"),data:e,type:"POST",dataType:"json"})},getForm:function(e){return e[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,e[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,$.ajax({url:this.serviceLocator.getUrl("process-handler-getForm"),data:e,type:"POST",dataType:"json"})},hasStartForm:function(e){var t={};return e.guid&&(t.guidWFClass=e.guid),$.read(this.serviceLocator.getUrl("process-handler-startform"),t)},executeAction:function(e){var t={surrogateKey:JSON.stringify(e.surrogatedKey),entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-action-execute"),data:t})},actionRule:function(e){var t={surrogateKey:e.surrogateKey,entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-handler-rule"),data:t,batchRequest:!1})},getActivitiesData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getActivitiesData"),i={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(i.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(i.idCase=e.idCase),$.read(r,i).then((function(e){return t.serializeEntityData(e)}))},getPendingsData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getPendingsData"),i={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(i.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(i.idCase=e.idCase),void 0!==e.taskState&&e.taskState&&(i.taskState=e.taskState),$.read(r,i).then((function(e){return t.serializeEntityData(e)}))},getActionsData:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("entities-handler-getActions"),data:e,batchRequest:!0}).pipe((function(e){return e}))},getUsersAndEvents:function(e){var t={};return e.idCases&&e.idCases.length>0&&(t.idCases=e.idCases.toString()),$.read(this.serviceLocator.getUrl("entities-handler-getUsersAndEvents"),t)},getUsers:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getUsers"),data:e,batchRequest:!0})},getEvents:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getEvents"),data:e,batchRequest:!0})},getUsersImages:function(e,t){var r={},i=this.serviceLocator.getUrl("entities-handler-getUsersImages");return t&&t.length>0&&(r.userIds=t.toString()),r.width=e.width,r.height=e.height,r.square=e.square,bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:i,data:r,type:"POST",dataType:"json"}):$.read({url:i,data:r,dataType:"json"})},getPreferencesCurrentUser:function(){var e=this.serviceLocator.getUrl("currentUser");return $.ajax({url:e,type:"GET"})},getPreferencesWorkportalCurrentUser:function(){return $.read(this.serviceLocator.getUrl("PreferencesWorkportalCurrentUser"))},getShortCuts:function(e){var t={},r=this.serviceLocator.getUrl("entities-handler-getShotCuts");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getSearchLists:function(){return $.read(this.serviceLocator.getUrl("my-search-getSearchLists"),{})},getIdCasesOfProcessEntities:function(e){e=e||{};var t={ids:JSON.stringify(e)};return bizagi.version.server.lessThanOrEqualsTo("11.0.0.2608")?$.read({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t}):$.ajax({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t,type:"POST"})},getQueryForm:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("query-handler-getQueryForm"),data:e,type:"POST",dataType:e.dataType||"json"})},defineFilterObject:function(e,t,r){var i=e.properties,a=i.xpath.split("@")[0],s=t.find((function(e){return e.xpath==a}));if(s){if("from"==i.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.min=e.value;else if("to"==i.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.max=e.value;else{e.properties.typeSearch=s.searchType;var o=l(e);$.extend(s,o)}i.orderType&&(s.orderType=i.orderType),r&&r(bizagi.clone(s))}else{var n=i.defaultFilter||!1;s=l(e),i.orderType&&(s.orderType=i.orderType),(void 0!==s.value||s.orderType||n)&&(t.push(s),r&&r(bizagi.clone(s)))}function l(e){var t=e.properties,r=t.typeSearch,i=e.value;if("boolean"==t.type&&("null"===i.toLowerCase()?(i=null,r="Nullable"):(i=bizagi.util.parseBoolean(i),r="exact")),"number"!=t.type&&"money"!=t.type&&"date"!=t.type||(r="exact"),"object"==_typeof(e.value)){if(i=[],Array.isArray(e.value))for(var s=0,o=e.value.length;s<o;s++){var n=parseInt(e.value[s].id);isNaN(n)||i.push(n)}else{n=parseInt(e.value.id);isNaN(n)||i.push(n)}r="exact",i=i.length>0?i:void 0}t.rangeQuery&&"none"!==t.rangeQuery&&(i={min:e.value,max:e.value},r="range");var l={xpath:a,searchType:r=r||"approx"};return void 0!==i&&(l.value=i),l}},getPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getActivities:function(e){var t=this.serviceLocator.getUrl("project-plan-activities");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},updatePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-update");return $.update({url:t.replace("{idPlan}",e.id),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},putExecutePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-execute");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},deletePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-delete");return $.destroy({url:t.replace("{idPlan}",e.id),data:e,contentType:"application/x-www-form-urlencoded"})},closePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-close");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},getWorkitemsPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-workitems");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getTransitionsByPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-transitions-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},editActivityPlan:function(e){var t={};e.activity?(t=e.activity).items=e.items:t=e;var r=this.serviceLocator.getUrl("project-plan-activity-edit").replace("{idPlan}",t.idPlan).replace("{id}",t.id);return $.update({url:r,data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},getPlanByParent:function(e){var t=this.serviceLocator.getUrl("project-plan-get-by-parent"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json",contentType:"application/json"})).done((function(e){r.resolve(e)})),r.promise()},getItemsByActivity:function(e){var t=this.serviceLocator.getUrl("project-plan-activity-tasks-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getPlanParent:function(e){var t=this.serviceLocator.getUrl("project-plan-parent");return $.read({url:t,data:e,dataType:"json"})},serializeEntityData:function(e){var t=e;function r(e,t){var r={data:{},guid:t.guidEntity,timestamp:e.timestamp},i=e.columns,a=t.row;for(name in t)t.hasOwnProperty(name)&&"row"!==name.toString()&&"id"!==name.toString()&&(r[name]=t[name]);for(var s=0,o=i.length;s<o;s+=1)r.data[i[s]]=a[s];return r}t.entities=[];for(var i,a=-1;i=e.rows[++a];)for(var s,o=-1;s=e.cells[++o];)if(s.id===i.id){var n=r(s,i);t.entities.push(n);break}return t},getCardViewCustomizedColumns:function(e){return(e=e||{}).sortData=bizagi.util.getLastProcessInboxSort(),this.getMobileActivities(e)},getMobileActivities:function(e){var t=this,r=t.serviceLocator.getUrl("case-handler-getActivityList"),i=e||{},a=e.sortData;a&&(bizagi.util.isMobileInboxByProcessSupported()&&a.sortOrder&&a.sortDirection&&a.sortFieldName?(i.orderFieldName=a.sortFieldName,i.orderType="asc"==a.sortDirection?0:1,i.order=a.sortOrder):delete i.sortData),void 0!==e.radNumber&&(i.radNumber=e.radNumber),-1!=e.idWfClass&&(i.idWfClass=e.idWfClass),i.mobileDevice=bizagi.util.isMobileDevice(),i.page=i.page||1,i.pageSize=i.pageSize||10,null!=i.idWfClass&&i.idWfClass<0&&delete i.idWfClass,e.smartInboxId&&(i.smartInboxGuid=e.smartInboxId),e.liveFilterData&&(i.smartInboxFilter=t.encodeLiveFilter(e.liveFilterData),delete e.liveFilterData);var s,o={url:r,data:i,type:"GET",dataType:"json"};return e.avoidLoader&&(o.avoidLoader=!0,delete i.avoidLoader),$.ajax(o).then((function(r){return bizagi.util.setLastProcessInboxProcessColumns(r.headers),s=r,e.includeSyncErrors&&"inbox"==e.inputtray?t.getInboxSyncErrors():void 0})).then((function(e){return null!=e&&(s.syncErrors=e),s}))},encodeLiveFilter:function(e){var t,r,i="",a=a||function(e,t){var r={},i=r.lib={},a=function(){},s=i.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var a=0;a<e;a++)t[i+a>>>2]|=(r[a>>>2]>>>24-a%4*8&255)<<24-(i+a)%4*8;else if(65535<r.length)for(a=0;a<e;a+=4)t[i+a>>>2]=r[a>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],i=0;i<t;i+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),n=r.enc={},l=n.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],i=0;i<e;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(r,t/2)}},c=n.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],i=0;i<e;i++)r.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(r,t)}},d=n.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,i=r.words,a=r.sigBytes,s=this.blockSize,n=a/(4*s);if(t=(n=t?e.ceil(n):e.max((0|n)-this._minBufferSize,0))*s,a=e.min(4*t,a),t){for(var l=0;l<t;l+=s)this._doProcessBlock(i,l);l=i.splice(0,t),r.sigBytes-=a}return new o.init(l,a)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=r.algo={};return r}(Math);r=(t=a).lib.WordArray,t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp(),e=[];for(var a=0;a<r;a+=3)for(var s=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,o=0;4>o&&a+.75*o<r;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,i=this._map;(a=i.charAt(64))&&-1!=(a=e.indexOf(a))&&(t=a);for(var a=[],s=0,o=0;o<t;o++)if(o%4){var n=i.indexOf(e.charAt(o-1))<<o%4*2,l=i.indexOf(e.charAt(o))>>>6-o%4*2;a[s>>>2]|=(n|l)<<24-s%4*8,s++}return r.create(a,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,r,i,a,s,o){return((e=e+(t&r|~t&i)+a+o)<<s|e>>>32-s)+t}function r(e,t,r,i,a,s,o){return((e=e+(t&i|r&~i)+a+o)<<s|e>>>32-s)+t}function i(e,t,r,i,a,s,o){return((e=e+(t^r^i)+a+o)<<s|e>>>32-s)+t}function s(e,t,r,i,a,s,o){return((e=e+(r^(t|~i))+a+o)<<s|e>>>32-s)+t}for(var o=a,n=(c=o.lib).WordArray,l=c.Hasher,c=o.algo,d=[],u=0;64>u;u++)d[u]=4294967296*e.abs(e.sin(u+1))|0;c=c.MD5=l.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var o=0;16>o;o++){var n=e[l=a+o];e[l]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}o=this._hash.words;var l=e[a+0],c=(n=e[a+1],e[a+2]),u=e[a+3],p=e[a+4],f=e[a+5],g=e[a+6],m=e[a+7],h=e[a+8],y=e[a+9],v=e[a+10],b=e[a+11],C=e[a+12],A=e[a+13],E=e[a+14],P=e[a+15],x=t(x=o[0],w=o[1],R=o[2],T=o[3],l,7,d[0]),T=t(T,x,w,R,n,12,d[1]),R=t(R,T,x,w,c,17,d[2]),w=t(w,R,T,x,u,22,d[3]);x=t(x,w,R,T,p,7,d[4]),T=t(T,x,w,R,f,12,d[5]),R=t(R,T,x,w,g,17,d[6]),w=t(w,R,T,x,m,22,d[7]),x=t(x,w,R,T,h,7,d[8]),T=t(T,x,w,R,y,12,d[9]),R=t(R,T,x,w,v,17,d[10]),w=t(w,R,T,x,b,22,d[11]),x=t(x,w,R,T,C,7,d[12]),T=t(T,x,w,R,A,12,d[13]),R=t(R,T,x,w,E,17,d[14]),x=r(x,w=t(w,R,T,x,P,22,d[15]),R,T,n,5,d[16]),T=r(T,x,w,R,g,9,d[17]),R=r(R,T,x,w,b,14,d[18]),w=r(w,R,T,x,l,20,d[19]),x=r(x,w,R,T,f,5,d[20]),T=r(T,x,w,R,v,9,d[21]),R=r(R,T,x,w,P,14,d[22]),w=r(w,R,T,x,p,20,d[23]),x=r(x,w,R,T,y,5,d[24]),T=r(T,x,w,R,E,9,d[25]),R=r(R,T,x,w,u,14,d[26]),w=r(w,R,T,x,h,20,d[27]),x=r(x,w,R,T,A,5,d[28]),T=r(T,x,w,R,c,9,d[29]),R=r(R,T,x,w,m,14,d[30]),x=i(x,w=r(w,R,T,x,C,20,d[31]),R,T,f,4,d[32]),T=i(T,x,w,R,h,11,d[33]),R=i(R,T,x,w,b,16,d[34]),w=i(w,R,T,x,E,23,d[35]),x=i(x,w,R,T,n,4,d[36]),T=i(T,x,w,R,p,11,d[37]),R=i(R,T,x,w,m,16,d[38]),w=i(w,R,T,x,v,23,d[39]),x=i(x,w,R,T,A,4,d[40]),T=i(T,x,w,R,l,11,d[41]),R=i(R,T,x,w,u,16,d[42]),w=i(w,R,T,x,g,23,d[43]),x=i(x,w,R,T,y,4,d[44]),T=i(T,x,w,R,C,11,d[45]),R=i(R,T,x,w,P,16,d[46]),x=s(x,w=i(w,R,T,x,c,23,d[47]),R,T,l,6,d[48]),T=s(T,x,w,R,m,10,d[49]),R=s(R,T,x,w,E,15,d[50]),w=s(w,R,T,x,f,21,d[51]),x=s(x,w,R,T,C,6,d[52]),T=s(T,x,w,R,u,10,d[53]),R=s(R,T,x,w,v,15,d[54]),w=s(w,R,T,x,n,21,d[55]),x=s(x,w,R,T,h,6,d[56]),T=s(T,x,w,R,P,10,d[57]),R=s(R,T,x,w,g,15,d[58]),w=s(w,R,T,x,A,21,d[59]),x=s(x,w,R,T,p,6,d[60]),T=s(T,x,w,R,b,10,d[61]),R=s(R,T,x,w,c,15,d[62]),w=s(w,R,T,x,y,21,d[63]),o[0]=o[0]+x|0,o[1]=o[1]+w|0,o[2]=o[2]+R|0,o[3]=o[3]+T|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,a=8*t.sigBytes;r[a>>>5]|=128<<24-a%32;var s=e.floor(i/4294967296);for(r[15+(a+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,i=0;4>i;i++)a=r[i],r[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(c),o.HmacMD5=l._createHmacHelper(c)}(Math),function(){var e,t=a,r=(e=t.lib).Base,i=e.WordArray,s=(e=t.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=(n=this.cfg).hasher.create(),a=i.create(),s=a.words,o=n.keySize,n=n.iterations;s.length<o;){l&&r.update(l);var l=r.update(e).finalize(t);r.reset();for(var c=1;c<n;c++)l=r.finalize(l),r.reset();a.concat(l)}return a.sigBytes=4*o,a}});t.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)}}(),a.lib.Cipher||function(e){var t=(g=a).lib,r=t.Base,i=t.WordArray,s=t.BufferedBlockAlgorithm,o=g.enc.Base64,n=g.algo.EvpKDF,l=t.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,i){return("string"==typeof r?m:f).encrypt(e,t,r,i)},decrypt:function(t,r,i){return("string"==typeof r?m:f).decrypt(e,t,r,i)}}}});t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},d=function(e,t,r){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var a=0;a<r;a++)e[t+a]^=i[a]},u=(t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();u.Encryptor=u.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;d.call(this,e,t,i),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),u.Decryptor=u.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,a=e.slice(t,t+i);r.decryptBlock(e,t),d.call(this,e,t,i),this._prevBlock=a}}),c=c.CBC=u,u=(g.pad={}).Pkcs7={pad:function(e,t){for(var r,a=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,s=[],o=0;o<r;o+=4)s.push(a);r=i.create(s,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:c,padding:u}),reset:function(){l.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=t.createEncryptor;else r=t.createDecryptor,this._minBufferSize=1;this._mode=r.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var p=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:r})}},t.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,r,i){i=this.cfg.extend(i);var a=e.createEncryptor(r,i);return t=a.finalize(t),a=a.cfg,p.create({ciphertext:t,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,r,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(r,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,r,a){return a||(a=i.random(8)),e=n.create({keySize:t+r}).compute(e,a),r=i.create(e.words.slice(t),4*r),e.sigBytes=4*t,p.create({key:e,iv:r,salt:a})}},m=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:g}),encrypt:function(e,t,r,i){return r=(i=this.cfg.extend(i)).kdf.execute(r,e.keySize,e.ivSize),i.iv=r.iv,(e=f.encrypt.call(this,e,t,r.key,i)).mixIn(r),e},decrypt:function(e,t,r,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),r=i.kdf.execute(r,e.keySize,e.ivSize,t.salt),i.iv=r.iv,f.decrypt.call(this,e,t,r.key,i)}})}(),function(){for(var e=a,t=e.lib.BlockCipher,r=e.algo,i=[],s=[],o=[],n=[],l=[],c=[],d=[],u=[],p=[],f=[],g=[],m=0;256>m;m++)g[m]=128>m?m<<1:m<<1^283;var h=0,y=0;for(m=0;256>m;m++){var v=(v=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&v^99;i[h]=v,s[v]=h;var b=g[h],C=g[b],A=g[C],E=257*g[v]^16843008*v;o[h]=E<<24|E>>>8,n[h]=E<<16|E>>>16,l[h]=E<<8|E>>>24,c[h]=E,E=16843009*A^65537*C^257*b^16843008*h,d[v]=E<<24|E>>>8,u[v]=E<<16|E>>>16,p[v]=E<<8|E>>>24,f[v]=E,h?(h=b^g[g[g[A^b]]],y^=g[g[y]]):h=y=1}var P=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=t.extend({_doReset:function(){for(var e=(r=this._key).words,t=r.sigBytes/4,r=4*((this._nRounds=t+6)+1),a=this._keySchedule=[],s=0;s<r;s++)if(s<t)a[s]=e[s];else{var o=a[s-1];s%t?6<t&&4==s%t&&(o=i[o>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o]):(o=i[(o=o<<8|o>>>24)>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o],o^=P[s/t|0]<<24),a[s]=a[s-t]^o}for(e=this._invKeySchedule=[],t=0;t<r;t++)s=r-t,o=t%4?a[s]:a[s-4],e[t]=4>t||4>=s?o:d[i[o>>>24]]^u[i[o>>>16&255]]^p[i[o>>>8&255]]^f[i[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,n,l,c,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,u,p,f,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,i,a,s,o,n){for(var l=this._nRounds,c=e[t]^r[0],d=e[t+1]^r[1],u=e[t+2]^r[2],p=e[t+3]^r[3],f=4,g=1;g<l;g++){var m=i[c>>>24]^a[d>>>16&255]^s[u>>>8&255]^o[255&p]^r[f++],h=i[d>>>24]^a[u>>>16&255]^s[p>>>8&255]^o[255&c]^r[f++],y=i[u>>>24]^a[p>>>16&255]^s[c>>>8&255]^o[255&d]^r[f++];p=i[p>>>24]^a[c>>>16&255]^s[d>>>8&255]^o[255&u]^r[f++],c=m,d=h,u=y}m=(n[c>>>24]<<24|n[d>>>16&255]<<16|n[u>>>8&255]<<8|n[255&p])^r[f++],h=(n[d>>>24]<<24|n[u>>>16&255]<<16|n[p>>>8&255]<<8|n[255&c])^r[f++],y=(n[u>>>24]<<24|n[p>>>16&255]<<16|n[c>>>8&255]<<8|n[255&d])^r[f++],p=(n[p>>>24]<<24|n[c>>>16&255]<<16|n[d>>>8&255]<<8|n[255&u])^r[f++],e[t]=m,e[t+1]=h,e[t+2]=y,e[t+3]=p},keySize:8}),e.AES=t._createHelper(r)}();try{i=JSON.encode(e)}catch(r){i=JSON.encode("[]")}var s=a.enc.Utf8.parse(i);return a.enc.Base64.stringify(s)},includeAllProcessesItem:function(e){var t={idworkflow:"-1",guidWFClass:"-1",name:bizagi.localization.getResource("workportal-widget-inbox-all-processes"),path:"App/",count:0,isFavorite:"false",icon:"",category:"Processes",guidFavorite:"",orderValue:String.fromCharCode(0)};e.workflows&&($.each(e.workflows.workflow,(function(r,i){e.workflows.workflow[r].orderValue=e.workflows.workflow[r].name,t.count+=Number(i.count)})),e.workflows.workflow.unshift(t))},isInboxSystemHeaderSortable:function(e,t,r){var i=!1,a={};if("detailView"===r?a={radnumber:!0,wiestimatedsolutiondate:!0,isfavorite:!0,currenttask:!0,wfclsdisplayname:!0}:"cardView"===r&&(a={radnumber:!0,wiestimatedsolutiondate:!0,isfavorite:!0,currenttask:!0,wfclsdisplayname:!0,taskstate:!0}),a.wfclsdisplayname){var s=null!=t.smartInboxId&&null!=t.smartInboxId&&"wfclsdisplayname"==e.fieldName&&!e.isSmartInbox;(-1!=t.idWorkflow||s)&&(a.wfclsdisplayname=!1)}e&&e.fieldName&&(a[e.fieldName.toLowerCase()]&&(e.order||e.fieldFilterName)&&(i=!0));return i},isInboxHeaderASystemColumn:function(e){return{taskstate:!0,taskstateColor:!0,radnumber:!0,wfclsdisplayname:!0,currenttask:!0,cascreationdate:!0,wiestimatedsolutiondate:!0,cassolutiondate:!0,idcase:!0,idworkitem:!0,taskid:!0,atrisktime:!0,currentuser:!0,currentfullname:!0,fieldName:!0,idwfclass:!0,isfavorite:!0,guidfavorite:!0,creatorfullname:!0}[e.toLowerCase()]||!1},validateCustomColumn:function(e,t,r){var i={isValid:!1,selectedColumnsCount:r};return r<t&&(e.isSmartInbox||e.isCustomColumn)&&(i.isValid=!0,i.selectedColumnsCount=r+1),i},configureGlobalHandlers:function(){var e=this;$(document).off("openForm.services"),$(document).on("openForm.services",(function(t,r){e.activeForm=r.form})),$(document).off("disposeForm.services"),$(document).on("disposeForm.services",(function(t,r){e.activeForm=void 0}))},getAllSmartInbox:function(){return $.read({url:this.serviceLocator.getUrl("smartinbox-getAllInbox"),data:{}})},getSpecificSmartInbox:function(e){var t=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return t=(t=t.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.read({url:t,data:{}})},getAllProcessesSmartInbox:function(e){return $.read({url:this.serviceLocator.getUrl("smartinbox-processes"),data:{}})},getAllCustomizedColumnsSmartInbox:function(e){var t=JSON.stringify(e);return $.ajax({url:this.serviceLocator.getUrl("smartinbox-customized-columns"),data:t,type:"POST",dataType:"json",contentType:"application/json"})},createSmartInbox:function(e){var t=JSON.stringify(e);return $.ajax({url:this.serviceLocator.getUrl("smartinbox-createinbox"),data:t,type:"POST",dataType:"json",contentType:"application/json"})},updateSmartInbox:function(e,t){var r=JSON.stringify(t),i=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return i=(i=i.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.ajax({url:i,data:r,type:"PUT",dataType:"json",contentType:"application/json"})},deleteSmartInbox:function(e){var t=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return t=(t=t.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.ajax({url:t,type:"DELETE",dataType:"json",contentType:"application/json"})},shareSmartInbox:function(e,t){var r=JSON.stringify(t),i=this.serviceLocator.getUrl("smartinbox-share").replace("{smartInboxId}",e.smartInboxId);return $.ajax({url:i,data:r,type:"POST",dataType:"json",contentType:"application/json"})},getEntityValuesForInboxFilter:function(e){var t=this.serviceLocator.getUrl("smartinbox-entity-values");return t=t.replace("{entityGuid}",e.entityGuid),$.ajax({url:t,type:"GET",dataType:"json",contentType:"application/json"})},getUserTasksForInboxFilter:function(e){var t="";return t=e.isSmartInbox?(t=this.serviceLocator.getUrl("smartinbox-user-tasks")).replace("{smartInboxId}",e.id):(t=this.serviceLocator.getUrl("smartinbox-user-tasks-process")).replace("{workflowId}",e.id),$.ajax({url:t,type:"GET",dataType:"json",contentType:"application/json"})},callServiceWithNetworkRetries:function(e,t,r,i,a,s,o){var n=this;o=o||$.Deferred();return s=isNaN(s)?0:s,i=isNaN(i)?1:i,a=isNaN(a)?100:a,s>=i?(console.error("Max retries reached"),void o.reject("Max retries reached")):($.when(t.apply(e,r)).then((function(e){o.resolve(e)})).fail((function(l){0===l.status?setTimeout((function(){n.callServiceWithNetworkRetries(e,t,r,i,a,s+1,o)}),a):o.reject(l)})),o.promise())},getAndSaveMobileFeaturesFromBizagiConfig:function(){bizagi.util.validateIfSaveMobileFeaturesIsEnabled()&&$.when(this.getConfiguration()).then((function(e){e&&e.features&&bizagi.util.storeMobileFeatures(e.features)}))}}),$.Class.extend("bizagi.workportal.services.routing",{BIZAGI_WORKPORTAL_WIDGET_START_FORM:"startForm"},{init:function(e){e=e||{},this.params=e.params||{},this.dataService=e.dataService||{},this.modules={render:"activityform",oldRender:"oldrenderintegration",async:"async",activitySelector:"routing"},this.renderVersion=2,this.resetRouteInformation()},resetRouteInformation:function(){this.route={module:"",moduleParams:{}}},setRenderParams:function(e){this.params=this.getRenderParams(e)},getRenderParams:function(e){var t,r=(t={idCase:parseInt(e.idCase||0),idWorkflow:parseInt(e.idWorkflow||0),idWorkitem:e.idWorkitem||e.idWorkItem||0,idTask:parseInt(e.idTask||0),eventAsTasks:e.eventAsTasks||!1,onlyUserWorkItems:e.onlyUserWorkItems||"true",formsRenderVersion:e.formsRenderVersion||0,referrer:e.referrer||"",isComplex:void 0!==e.isComplex},_defineProperty(t,"formsRenderVersion",2),_defineProperty(t,"onClose",e.onClose||""),_defineProperty(t,"isOfflineForm",e.isOfflineForm||!1),_defineProperty(t,"radNumber",e.radNumber||null),_defineProperty(t,"offlineType",e.offlineType||null),t),i=!0;try{i=BIZAGI_SETTINGS.skipSubprocessGlobalForm||!0}catch(e){}return this.skipSubprocessGlobalForm="true"==i,r},getRoute:function(e){var t=this,r=new $.Deferred;t.params=e||t.params;var i=e.fromTask||e.idTask||"",a=e.fromWorkItemId||e.idWorkitem||e.idWorkItem||"";return $.when(t.getRenderVersion(t.params)).done((function(s){t.renderVersion=s,t.route.moduleParams=t.getRenderParams(t.params),$.when(t.dataService.getWorkitems({idCase:t.params.idCase,onlyUserWorkItems:t.params.onlyUserWorkItems,isOfflineForm:t.params.isOfflineForm,fromTask:i,fromWorkItemId:a})).done((function(i){var a=i.workItems.length;if(t.route.moduleParams.hasWorkItems=!!a,t.route.moduleParams.isEvent=t.params.isEvent||!1,t.route.moduleParams.hasGlobalForm=bizagi.util.parseBoolean(i.hasGlobalForm),bizagi.util.isEmpty(i.idWfClass)||(t.route.moduleParams.idWfClass=i.idWfClass),!0===t.params.hasSyncError&&null!=t.params.syncError&&t.includeSyncErrorIntoModuleparams(t.params.syncError),t.route.moduleParams.idWorkitem>0){t.setRenderModuleName(t.getRenderModuleName(s)),0===t.route.moduleParams.idTask&&(t.route.moduleParams.idTask=t.searchIdTask(t.route.moduleParams.idWorkitem)),t.route.moduleParams.radNumber=bizagi.util.isEmpty(e.radNumber)?i.radNumber||"":e.radNumber,t.route.moduleParams.idWorkflow=i.idWorkFlow||"";var o=i.workItems.find((function(e){return Number(e.idWorkItem)===Number(t.route.moduleParams.idWorkitem)}));null!=o&&(null!=o.displayName&&(t.route.moduleParams.displayName=o.displayName),t.route.moduleParams.mobileAccess=!(!1===o.mobileAccess),t.route.moduleParams.forceOffline=!0===o.forceOffline,t.route.moduleParams.workitemstate=e.workitemstate),t.getSyncError(t.route.moduleParams).then((function(e){null!=e&&t.includeSyncErrorIntoModuleparams(e)})).always((function(){r.resolve(t.route),t.resetRouteInformation()}))}else{var n=t.checkAsyncWorkItems(i);if(0===a)t.route.moduleParams.idWorkflow=i.idWorkFlow||"",t.route.moduleParams.radNumber=i.radNumber||"",""!==$.trim(i.msgTask)?r.resolve(t.routeToMessageForm(i.msgTask)):bizagi.util.parseBoolean(i.hasGlobalForm)?(t.route.moduleParams.displayName=null,r.resolve(t.routeToGlobalForm(i))):r.resolve(t.routeToGlobalFormWithoutData());else if(1===a||n.length>0){var l=0;if(n.length>0)for(var c=0;c<a;c++)if("true"==i.workItems[c].isAsynch){l=c;break}t.route.moduleParams.idCase=i.workItems[l].idCase,t.route.moduleParams.idTask=i.workItems[l].idTask,t.route.moduleParams.fromTask=i.workItems[l].idTask,t.route.moduleParams.idWorkitem=i.workItems[l].idWorkItem,t.route.moduleParams.idWorkflow=i.workItems[l].idWorkFlow,t.route.moduleParams.displayName=i.workItems[l].displayName?i.workItems[l].displayName:"",t.route.moduleParams.radNumber=i.radNumber||"",t.route.moduleParams.mobileAccess=!(!1===i.workItems[l].mobileAccess),t.route.moduleParams.forceOffline=!0===i.workItems[l].forceOffline,n.length>0?t.setRenderModuleName(t.modules.async):t.setRenderModuleName(t.getRenderModuleName(s)),t.getSyncError(t.route.moduleParams).then((function(e){null!=e&&t.includeSyncErrorIntoModuleparams(e)})).always((function(){r.resolve(t.route),t.resetRouteInformation()}))}else i.checkProcess=!!(i.subProcesses.length>0&&t.skipSubprocessGlobalForm),i.checkWorkItems=a>1,i.fromSearchWidget="search"==t.params.referrer,t.setRenderModuleName(t.modules.activitySelector),t.route.moduleParams.data=i,r.resolve(t.route),t.resetRouteInformation()}})).fail((function(e){var i=bizagi.localization.getResource("workportal-menu-search-found-no-cases");r.resolve(t.routeToMessageForm(i))}))})).fail((function(e,t,i){r.reject()})),r.promise()},setRenderModuleName:function(e){this.route.module=e,this.route.moduleParams.widgetName=e},getRenderModuleName:function(e){return 1==e?this.modules.oldRender:this.modules.render},searchIdTask:function(e,t){for(var r=0,i=0,a=(e=e||[]).length;i<a;i++)if(parseInt(e[i].idWorkItem)==parseInt(t)){r=parseInt(e[i].idTask);break}return r},checkAsyncWorkItems:function(e){var t=[];return $.each(e.workItems,(function(r){"true"==e.workItems[r].isAsynch&&t.push({idCase:e.idCase,idWorkitem:e.workItems[r].idWorkItem,idTask:e.workItems[r].idTask})})),t},routeToGlobalForm:function(e){if(this.route.moduleParams.idCase=$.isNumeric(e.idCaseForGlobalForm)&&e.idCaseForGlobalForm>0?e.idCaseForGlobalForm:this.route.moduleParams.idCase,this.route.moduleParams.idWorkflow=parseInt(e.idWorkFlow||0),1==this.renderVersion){var t=this.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase=%s&idWorkitem=%s&idTask=%s",r=this.route.moduleParams.idCase||"",i=this.route.moduleParams.idWorkitem||"",a=this.route.moduleParams.idTask||"",s=printf(t,r,i,a);this.route.moduleParams.onlyUserWorkItems=this.route.moduleParams.idCase||"",this.setRenderModuleName(this.modules.oldRender),this.route.moduleParams.url=s}else this.setRenderModuleName(this.modules.render);return this.route},routeToGlobalFormWithoutData:function(){return this.setRenderModuleName(this.modules.render),this.route.moduleParams.withOutGlobalForm=!0,this.route},routeToMessageForm:function(e){return e=e||"",this.setRenderModuleName(this.modules.render),this.route.moduleParams.withOutGlobalForm=!0,this.route.moduleParams.messageForm=e,this.route},getRenderVersion:function(e){var t=new $.Deferred,r=e.formsRenderVersion||0;return 0!=r?t.resolve(r):$.when(this.dataService.getCaseFormsRenderVersion({idCase:e.idCase})).done((function(e){r=parseInt(e.formsRenderVersion),t.resolve(r)})).fail((function(e,r,i){t.reject()})),t.promise()},getSyncError:function(e){return bizagi.util.isOfflineErrorsViewSupported()&&"start"!=e.offlineType&&null==this.route.moduleParams.syncError?this.dataService.getTaskSyncError(e):$.Deferred().resolve(void 0).promise()},includeSyncErrorIntoModuleparams:function(e){if(bizagi.util.isOfflineErrorsViewSupported()){this.route.moduleParams.hasSyncError=!0,this.route.moduleParams.syncError=e,this.route.moduleParams.offlineType="start"==this.params.offlineType?"start":"task",this.route.moduleParams.idEdited=!0,this.route.moduleParams.isOfflineForm=!0,this.route.moduleParams.isOfflineErrorMode=!0}}}),$.Class("bizagi.workportal.command.security",{},{init:function(e){this.dataService=e,this.rawData={}},getSecurity:function(){var e=this,t=new $.Deferred;return e.security={},e.jsonSecurityList={},bizagi.menuSecurity?t.resolve(bizagi.menuSecurity):$.when(e.dataService.getMenuAuthorization()).done((function(r){bizagi.currentUser.associatedStakeholders&&bizagi.currentUser.associatedStakeholders.length>0&&r.permissions.push({associatedStakeholders:[]}),e.rawData=r,bizagi.menuSecurity=e.convertSecurityData(r),e.jsonSecurityList=r,$.each(e.security,(function(e,t){authMenu[e]=t})),t.resolve(bizagi.menuSecurity)})).fail((function(){t.reject()})),t.promise()},convertSecurityData:function(e){var t={};return function e(r){$.each(r,(function(r,i){"object"==_typeof(i)?("number"!=typeof r&&(t[r]=!0),e(i)):t[i]=!0}))}(e.permissions),t},checkSecurityPerm:function(e){e=e||"";var t=$.Deferred();return bizagi.menuSecurity?t.resolve(!!bizagi.menuSecurity[e]):this.getSecurity().done((function(r){t.resolve(!!r[e])})).fail((function(){t.resolve(!1)})),t.promise()},getRawData:function(){return this.rawData}}),$.Class.extend("bizagi.workportal.device.factory",{},{init:function(e){this.device=bizagi.util.detectDevice(),this.workportal=e,this.cachedFacade=null},getWorkportalFacade:function(e,t){var r=this,i=new $.Deferred;if(t=void 0===t||t,null!=r.cachedFacade)i.resolve(r.cachedFacade);else{if("desktop"===this.device)return r.cachedFacade=new bizagi.workportal.desktop.facade(this.workportal,e),$.when(r.cachedFacade.initAsyncStuff(t)).done((function(){i.resolve(r.cachedFacade)})),i.promise();if(bizagi.util.isTabletDevice())return r.cachedFacade=new bizagi.workportal.tablet.facade(e,this.device),$.when(r.cachedFacade.initAsyncStuff()).done((function(){i.resolve(r.cachedFacade)})),i.promise();if(bizagi.util.isSmartphoneDevice())return r.cachedFacade=new bizagi.workportal.smartphone.facade(e,this.device),$.when(r.cachedFacade.initAsyncStuff()).done((function(){i.resolve(r.cachedFacade)})),i.promise();bizagi.showMessageBox("Not supported device: "+this.device,"Error"),i.resolve("")}return i.promise()},getDataService:function(){return this.dataService}}),-1!=location.href.indexOf("#")&&(document.location="index.html"),bizagi.workportal=bizagi.workportal||{},bizagi.workportal.currentInboxView="inbox",bizagi.workportal.state=bizagi.workportal.state||{},bizagi.webparts=bizagi.webparts||{},bizagi.webparts.instances=bizagi.webparts.instances||[],$.Class.extend("bizagi.workportal.facade",{},{init:function(e){if(this.deviceFactory=new bizagi.workportal.device.factory(this),this.dataService=new bizagi.workportal.services.service(e),this.dataService.routing=new bizagi.workportal.services.routing({dataService:this.dataService}),!bizagi.util.isEmpty(window.location.search)){var t=bizagi.util.getQueryString();t.idCase&&(e.idCase=t.idCase,this.isConfiguredFromHash=!0),t.idWorkitem&&(e.idWorkitem=t.idWorkitem)}this.defaultParams=e||{}},createWebpart:function(e){return this.executeWebpart($.extend(e,{creating:!0}))},executeWebpart:function(e){var t=this.ownerDocument,r=($("body",t),e.canvas),i=!0;if(e.webpartConfiguration&&(i=this.testWebpartConfiguration(e)),i)return this.processWebpart(e).then((function(e){return e.name=e.webpart.Class.fullName,bizagi.webparts.instances.push(e),r.append(e.content),r.triggerHandler("ondomincluded"),e}))},ready:function(){return this.executionDeferred.promise()},processWebpart:function(e){var t,r=new $.Deferred,i=this.deviceFactory.getWorkportalFacade(this.dataService,!1);return $.extend(e,this.defaultParams),$.when(i).then((function(t){var r=new $.Deferred;return $.when(t.loadWebpart(e)).done((function(){r.resolve(t)})),r.promise()})).then((function(r){return(t=r.getWebpart(e.webpart,e)).render(e)})).then((function(e){r.resolve({webpart:t,content:e})})).fail((function(e){r.reject(e)})),r.promise()},getMainController:function(){return this.mainController},execute:function(){var e=this,t=arguments,r=this.deviceFactory.getWorkportalFacade(e.dataService);return e.processOfflineData(),bizagi.loading.start(),$.when(r).then((function(e){return e.executeWebparts(t)})).then((function(){if(!bizagi.util.isEmpty(e.defaultParams.idCase)&&e.isConfiguredFromHash){var t={action:"routing",idCase:e.defaultParams.idCase};e.defaultParams.idWorkitem&&(t.idWorkitem=e.defaultParams.idWorkitem);var r=$("#homePortal").data("kendoMobileSplitView");r&&r.element&&r.element.hide(),bizagi.webpart.publish("executeRoutingAction",t)}else(!bizagi.util.isNativePluginSupported()||bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSTabletDevice())&&bizagi.kendoMobileApplication.navigate("#homePortal");bizagi.loading.stop()}))},processOfflineData:function(){var e=this;!(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice())&&void 0!==e.dataService.fetchOfflineData&&!0===e.dataService.online&&(bizagi.util.isOfflineFormsV2Supported()?$.when(e.dataService.getOutboxCasesCount()).then((function(t){t>0&&(bizagi.util.isNativePluginSupported()&&bizagiapp.openSyncDialog(),e.dataService.pushOfflineData())})):e.dataService.pushOfflineData())}}),$.Class.extend("bizagi.workportal.tablet.facade",{render_module:"renderingflat",setup:function(){this.render_module=bizagi.override.enableMSF?"rendering":"renderingflat"},getWidgetImplementation:function(e){bizagi.log("getWidgetImplementation"+e)}},{init:function(e,t){this.templates={},this.dataService=e,this.getMobileFeaturesFromBizagiConfig(),this.setMobileMetaTags(),this.setMobileIcons(),this.modules={},this.device=t,this.homePortalFramework=new bizagi.workportal.homeportalFramework(this),this.security=new bizagi.workportal.command.security(e),bizagi.override.enableMSF?bizagi.hasOwnProperty("kendo")?this.templateService=new bizagi.kendo.templates.services.service(bizagi.localization):this.templateService=new bizagi.templates.services.service(bizagi.localization):this.templateService=new bizagi.kendo.templates.services.service(bizagi.localization)},getMobileFeaturesFromBizagiConfig:function(){this.dataService.getAndSaveMobileFeaturesFromBizagiConfig()},setMobileMetaTags:function(){$("<meta>",{name:"apple-mobile-web-app-capable",content:"yes"}).appendTo("head"),$("<meta>",{name:"viewport",content:"width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"}).appendTo("head"),$("<link>",{rel:"apple-touch-icon-precomposed",href:"jquery/common/base/css/tablet/images/BizAgi_logo.png"}).appendTo("head"),$("<link>",{rel:"apple-touch-startup-image",href:"jquery/common/base/css/tablet/images/splash.png"}).appendTo("head")},setMobileIcons:function(){$("head").append('<svg xmlns="http://www.w3.org/2000/svg" display="none" width="0" height="0" id="genome-mobile-icons"><defs> <path d="M14,11 C14.5522847,11 15,11.4477153 15,12 C15,12.5522847 14.5522847,13 14,13 C13.4477153,13 13,12.5522847 13,12 C13,11.4477153 13.4477153,11 14,11 Z M10.62,11.22 C10.8071865,11.4087188 10.9115368,11.664197 10.91,11.93 C10.9115368,12.195803 10.8071865,12.4512812 10.62,12.64 L8.53,14.71 C8.34373936,14.8947442 8.09233988,14.9988954 7.83,15 C7.5627541,14.9988906 7.30707144,14.8908556 7.12,14.7 C6.73227641,14.3099625 6.73227641,13.6800375 7.12,13.29 L7.42,13 L4.55,13 C3.61113249,13.0026559 2.7096639,12.6322374 2.04390894,11.9702332 C1.37815398,11.308229 1.00264842,10.4088675 1,9.47 L1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 L3,9.47 C3.01094569,10.3182207 3.70170869,11.0000706 4.55,11 L7.55,11 L7.12,10.58 C6.93068735,10.3922334 6.82420168,10.1366375 6.82420168,9.87 C6.82420168,9.60336246 6.93068735,9.3477666 7.12,9.16 C7.51003745,8.77227641 8.13996255,8.77227641 8.53,9.16 L10.62,11.22 Z M2,3 C2.55228475,3 3,3.44771525 3,4 C3,4.55228475 2.55228475,5 2,5 C1.44771525,5 1,4.55228475 1,4 C1,3.44771525 1.44771525,3 2,3 Z M11.45,3 C12.3888675,2.99734409 13.2903361,3.36776255 13.9560911,4.02976678 C14.621846,4.691771 14.9973516,5.59113247 15,6.53 L15,9 C15,9.55228475 14.5522847,10 14,10 C13.4477153,10 13,9.55228475 13,9 L13,6.53 C12.9890543,5.6817793 12.2982913,4.99992938 11.45,5 L8.45,5 L8.88,5.42 C9.06931265,5.6077666 9.17579832,5.86336246 9.17579832,6.13 C9.17579832,6.39663754 9.06931265,6.6522334 8.88,6.84 C8.69128117,7.02718651 8.43580298,7.13153676 8.17,7.13 C7.90766012,7.12889538 7.65626064,7.02474416 7.47,6.84 L5.38,4.78 C5.19281349,4.59128117 5.08846324,4.33580298 5.09,4.07 C5.08846324,3.80419702 5.19281349,3.54871883 5.38,3.36 L7.47,1.29 C7.86212218,0.900639269 8.49563924,0.902877853 8.88499998,1.29500002 C9.27436072,1.68712218 9.27212216,2.32063925 8.88,2.71 L8.58,3 L11.45,3 Z" id="icon-sync-path-1"/> <style>.a{fill:none;}</style><style>.a{fill:#fff;}.b{fill:#da3b3b;}</style></defs><symbol viewBox="0 0 16 16" id="bz-arrow-left--16"><path d="M11,15a1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.42L6.41,8l5.3-5.29a1,1,0,1,0-1.42-1.42l-6,6a1,1,0,0,0,0,1.42l6,6A1,1,0,0,0,11,15Z"/></symbol><symbol viewBox="0 0 16 16" id="bz-dots-v--16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></symbol><symbol viewBox="0 0 16 16" id="bz-summary--16">  <path d="M12,3a1,1,0,0,0,0,2v8H4V5A1,1,0,0,0,4,3H3A1,1,0,0,0,2,4v9a2,2,0,0,0,2,2h9a1,1,0,0,0,1-1V5A2,2,0,0,0,12,3Z"/> <rect x="6" y="1" width="4" height="3" rx="1"/> <path d="M6,8h4a1,1,0,0,0,0-2H6A1,1,0,0,0,6,8Z"/> <path d="M10,9H6a1,1,0,0,0,0,2h4a1,1,0,0,0,0-2Z"/> </symbol><symbol viewBox="0 0 16 16" id="dots-menu"><g id="dots-menu-dots-menu-16x"><circle cx="8" cy="4" r="1"/><circle cx="8" cy="8" r="1"/><circle cx="8" cy="12" r="1"/></g></symbol><symbol viewBox="0 0 16 16" id="icon-sync"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e    <g id="icon-sync-Mobile-Prototype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="icon-sync-Inbox-Offline-Edited" transform="translate(-311.000000, -157.000000)"> <g id="icon-sync-cases" transform="translate(0.000000, 141.000000)"> <g id="icon-sync-case"> <g id="icon-sync-edited" transform="translate(311.000000, 16.000000)"> <g id="icon-sync-2.0/16x/cloud"> <mask id="icon-sync-mask-2" fill="white"> <use xlink:href="#icon-sync-path-1"/> </mask> <use id="icon-sync-Mask" fill="#9E9E9E" xlink:href="#icon-sync-path-1"/> </g> </g> </g> </g> </g> </g> </symbol><symbol viewBox="0 0 32 32" id="icon-trash"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e   <g id="icon-trash-Mobile-Prototype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="icon-trash-Drafts-Offline" transform="translate(-335.000000, -149.000000)"> <g id="icon-trash-cases" transform="translate(0.000000, 141.000000)"> <g id="icon-trash-case"> <g id="icon-trash-icon" transform="translate(335.000000, 8.000000)"> <rect id="icon-trash-box" x="0" y="0" width="32" height="32"/> <path d="M21,13 C21.553,13 22,13.447 22,14 L22,21 C22,22.654 20.654,24 19,24 L13,24 C11.346,24 10,22.654 10,21 L10,14 C10,13.447 10.447,13 11,13 C11.553,13 12,13.447 12,14 L12,21 C12,21.552 12.448,22 13,22 L19,22 C19.552,22 20,21.552 20,21 L20,14 C20,13.447 20.447,13 21,13 Z M14,19.5 C14,19.776 13.776,20 13.5,20 C13.224,20 13,19.776 13,19.5 L13,14.5 C13,14.224 13.224,14 13.5,14 C13.776,14 14,14.224 14,14.5 L14,19.5 Z M16.5,19.5 C16.5,19.776 16.276,20 16,20 C15.724,20 15.5,19.776 15.5,19.5 L15.5,14.5 C15.5,14.224 15.724,14 16,14 C16.276,14 16.5,14.224 16.5,14.5 L16.5,19.5 Z M19,19.5 C19,19.776 18.776,20 18.5,20 C18.224,20 18,19.776 18,19.5 L18,14.5 C18,14.224 18.224,14 18.5,14 C18.776,14 19,14.224 19,14.5 L19,19.5 Z M23,10 C23.553,10 24,10.447 24,11 C24,11.553 23.553,12 23,12 L9,12 C8.447,12 8,11.553 8,11 C8,10.447 8.447,10 9,10 L13,10 L13,9 C13,8.447 13.447,8 14,8 L18,8 C18.553,8 19,8.447 19,9 L19,10 L23,10 Z" id="icon-trash-trash" fill="#9E9E9E"/> </g> </g> </g> </g> </g> </symbol><symbol viewBox="0 0 16 16" id="star"><g id="star-star-16x"><path d="M11.708,14.20605a.50183.50183,0,0,1-.294-.0957L8,11.62988,4.58594,14.11035a.5.5,0,0,1-.76953-.55859L5.12012,9.53809,1.70605,7.05762A.4999.4999,0,0,1,2,6.15332H6.22021l1.3042-4.01367a.52044.52044,0,0,1,.95118,0l1.3042,4.01367H14a.4999.4999,0,0,1,.294.9043L10.87988,9.53809l1.30371,4.01367a.50021.50021,0,0,1-.47558.65429ZM8,10.51172a.50193.50193,0,0,1,.294.0957l2.46337,1.79L9.81641,9.501a.49916.49916,0,0,1,.18164-.5586l2.46289-1.78906H9.4165a.5.5,0,0,1-.47558-.3457L8,3.91211,7.05908,6.80762a.5.5,0,0,1-.47558.3457H3.53906L6.002,8.94238a.49916.49916,0,0,1,.18164.5586l-.94091,2.89648,2.46337-1.79A.50193.50193,0,0,1,8,10.51172Z"/></g></symbol><symbol viewBox="0 0 24 24" id="bz-arrow-left--24"><path d="M17,23a1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.42L8.41,12l9.3-9.29a1,1,0,1,0-1.42-1.42l-10,10a1,1,0,0,0,0,1.42l10,10A1,1,0,0,0,17,23Z"/></symbol><symbol viewBox="0 0 24 24" id="bz-dots-v--24"><circle cx="12" cy="7" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="17" r="1.5"/></symbol><symbol viewBox="0 0 24 24" id="bz-summary--24"><path d="M18,5a1,1,0,0,0,0,2,1,1,0,0,1,1,1V21H6a1,1,0,0,1-1-1V7H6A1,1,0,0,0,6,5H4A1,1,0,0,0,3,6V20a3,3,0,0,0,3,3H20a1,1,0,0,0,1-1V8A3,3,0,0,0,18,5Z"/><path d="M9,7h6a1,1,0,0,0,1-1V4a1,1,0,0,0-1-1H14V2a1,1,0,0,0-1-1H11a1,1,0,0,0-1,1V3H9A1,1,0,0,0,8,4V6A1,1,0,0,0,9,7Zm3-3a1,1,0,0,0,1,1H11A1,1,0,0,0,12,4Z"/><path d="M8,11h8a1,1,0,0,0,0-2H8a1,1,0,0,0,0,2Z"/><path d="M16,13H8a1,1,0,0,0,0,2h8a1,1,0,0,0,0-2Z"/><path d="M16,17H8a1,1,0,0,0,0,2h8a1,1,0,0,0,0-2Z"/></symbol><symbol viewBox="0 0 24 24" id="bzg-arrow-left"><path d="M17,23a1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.42L8.41,12l9.3-9.29a1,1,0,1,0-1.42-1.42l-10,10a1,1,0,0,0,0,1.42l10,10A1,1,0,0,0,17,23Z"/></symbol><symbol viewBox="0 0 24 24" id="bzg-edit"><path d="M14.71,5.29a1,1,0,0,0-1.42,0l-12,12A1,1,0,0,0,1,18v4a1,1,0,0,0,1,1H6a1,1,0,0,0,.71-.29L17.29,12.12a3,3,0,0,0,0-4.24ZM3,21V18.41L5.59,21ZM15.88,10.71,7,19.59,4.41,17,14,7.41l1.88,1.88A1,1,0,0,1,15.88,10.71Z"/><path d="M21.71,2.29a3.84,3.84,0,0,0-5.42,0l-1,1a1,1,0,0,0,0,1.42l4,4a1,1,0,0,0,1.42,0l1-1A3.84,3.84,0,0,0,21.71,2.29Zm-1.42,4-.29.3L17.41,4l.3-.29a1.82,1.82,0,1,1,2.58,2.58Z"/></symbol><symbol viewBox="0 0 24 24" id="bzg-sync"><g id="bzg-sync-sync-24x"><path d="M12,1A11.03251,11.03251,0,0,0,4.333,4.12646V2a1,1,0,0,0-2,0V7a.9471.9471,0,0,0,.0318.15759.97252.97252,0,0,0,.02966.147,1.36527,1.36527,0,0,0,.18414.33252.97322.97322,0,0,0,.18116.16027.9342.9342,0,0,0,.07714.0683c.01526.00879.03254.00824.048.01612a.97526.97526,0,0,0,.20746.06958A.97927.97927,0,0,0,3.2738,7.988C3.29449,7.98932,3.312,8,3.333,8h5a1,1,0,0,0,0-2H5.31873A8.98139,8.98139,0,0,1,21,12a1,1,0,0,0,2,0A11.01245,11.01245,0,0,0,12,1Z"/><path d="M21.60565,16.69556a1.36192,1.36192,0,0,0-.18365-.332.97292.97292,0,0,0-.18445-.163.92322.92322,0,0,0-.07446-.06579c-.01484-.00861-.0315-.00806-.04657-.01581a1.59562,1.59562,0,0,0-.39454-.10785C20.70276,16.01,20.68652,16,20.667,16h-5a1,1,0,1,0,0,2h3.01428A8.98139,8.98139,0,0,1,3,12a1,1,0,0,0-2,0,10.98942,10.98942,0,0,0,18.667,7.87329V22a1,1,0,0,0,2,0V17a.94293.94293,0,0,0-.0318-.15784A.964.964,0,0,0,21.60565,16.69556Z"/></g></symbol><symbol viewBox="0 0 16 16" id="activity"><g id="activity-icon-name-16x"><path d="M8,10.5a.49989.49989,0,0,1-.44727-.27637L6.69092,8.5H6a.5.5,0,0,1,0-1H7a.5011.5011,0,0,1,.44727.27637L7.96533,8.8125l2.5752-6.00977A.47665.47665,0,0,1,11.00586,2.5a.50143.50143,0,0,1,.4585.31445L13.33838,7.5H14a.5.5,0,0,1,0,1H13a.49951.49951,0,0,1-.46436-.31445L10.98389,4.30664,8.45947,10.19727A.50017.50017,0,0,1,8.01465,10.5Z"/><path d="M3,8.5H2a.5.5,0,0,1,0-1H3a.5.5,0,0,1,0,1Z"/><path d="M13,14.5H3a.5.5,0,0,1,0-1H13a.5.5,0,0,1,0,1Z"/></g></symbol><symbol viewBox="0 0 16 16" id="arrow-down"><g id="arrow-down-arrow-down-16x"><path d="M8,11.5a.47.47,0,0,1-.35-.15l-6-6a.48.48,0,0,1,0-.7.5.5,0,0,1,.71,0L8,10.29l5.64-5.64a.5.5,0,0,1,.71,0A.49.49,0,0,1,14.5,5a.47.47,0,0,1-.15.35l-6,6A.47.47,0,0,1,8,11.5Z"/></g></symbol><symbol viewBox="0 0 16 16" id="arrow-sort-down"><g id="arrow-sort-down-arrow-sort-down-16x"><path d="M13.21,10.21l-4.5,4.5a1,1,0,0,1-.33.21.92.92,0,0,1-.76,0,1,1,0,0,1-.33-.21l-4.5-4.5A1,1,0,0,1,2.5,9.5a1,1,0,0,1,.29-.71,1,1,0,0,1,1.42,0L7,11.59V2A1,1,0,0,1,9,2v9.59l2.79-2.8a1,1,0,0,1,1.42,0A1,1,0,0,1,13.21,10.21Z"/></g></symbol><symbol viewBox="0 0 16 16" id="arrow-sort-up"><g id="arrow-sort-up-sort-up-16x"><path d="M13.21,5.79l-4.5-4.5a1,1,0,0,0-.33-.21,1,1,0,0,0-.76,0,1,1,0,0,0-.33.21l-4.5,4.5a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L7,4.41V14a1,1,0,0,0,2,0V4.41l2.79,2.8a1,1,0,0,0,1.42,0A1,1,0,0,0,13.21,5.79Z"/></g></symbol><symbol viewBox="0 0 16 16" id="arrow-up"><g id="arrow-up-arrow-up-16x"><path d="M14,11.5a.51.51,0,0,1-.36-.15L8,5.71,2.36,11.35a.5.5,0,0,1-.71,0A.49.49,0,0,1,1.5,11a.47.47,0,0,1,.15-.35l6-6a.48.48,0,0,1,.7,0l6,6a.5.5,0,0,1-.35.85Z"/></g></symbol><symbol viewBox="0 0 12 12" id="bzg-clear-circle"><path d="M6,0a6,6,0,1,0,6,6A6,6,0,0,0,6,0ZM8.42,7a1,1,0,0,1,0,1.41A1,1,0,0,1,7,8.42l-1-1-1,1a1,1,0,0,1-1.41,0A1,1,0,0,1,3.58,7l1-1-1-1A1,1,0,0,1,5,3.58l1,1,1-1A1,1,0,0,1,8.42,5l-1,1Z"/></symbol><symbol viewBox="0 0 16 16" id="bzg-edit"><path d="M10.71,3.29a1,1,0,0,0-1.42,0l-8,8A1,1,0,0,0,1,12v2a1,1,0,0,0,1,1H4a1,1,0,0,0,.71-.29L12,7.41a2,2,0,0,0,0-2.82ZM3.59,13H3v-.59l7-7,.59.59Z"/><path d="M14.71,1.29a2.43,2.43,0,0,0-3.42,0,1,1,0,0,0,0,1.42l2,2a1,1,0,0,0,1.42,0,2.44,2.44,0,0,0,0-3.42Z"/></symbol><symbol viewBox="0 0 16 16" id="bzg-sync"><g id="bzg-sync-sync-16x"><path d="M8,1A7.01076,7.01076,0,0,0,3.7998,2.40869V2a1,1,0,0,0-2,0V5a.94306.94306,0,0,0,.02875.14227.90487.90487,0,0,0,.389.649.93942.93942,0,0,0,.08423.07446c.01672.00971.03564.00916.05267.01782a.97641.97641,0,0,0,.19452.0658.973.973,0,0,0,.194.03919C2.76282,5.98969,2.7796,6,2.7998,6h3a1,1,0,1,0,0-2H5.00928A4.993,4.993,0,0,1,13,8a1,1,0,0,0,2,0A7.00818,7.00818,0,0,0,8,1Z"/><path d="M14.13745,10.68872a1.35284,1.35284,0,0,0-.18512-.32941.97349.97349,0,0,0-.17334-.15319.92492.92492,0,0,0-.08075-.07135c-.016-.00934-.03418-.00879-.05053-.01716a1.59015,1.59015,0,0,0-.392-.10644C13.23633,10.01007,13.21991,10,13.2002,10h-3a1,1,0,0,0,0,2h.79064A4.99313,4.99313,0,0,1,3,8,1,1,0,0,0,1,8a6.99166,6.99166,0,0,0,11.2002,5.59149V14a1,1,0,0,0,2,0V11a.94717.94717,0,0,0-.02887-.14313A.97211.97211,0,0,0,14.13745,10.68872Z"/></g></symbol><symbol viewBox="0 0 16 16" id="bzg-undo"><path d="M11,4H3.87l1-1.45a1,1,0,0,0-1.66-1.1l-2,3a.47.47,0,0,0,0,.1l-.05.1a1.05,1.05,0,0,0,0,.7l.05.1a.47.47,0,0,0,0,.1l2,3A1,1,0,0,0,4,9a.94.94,0,0,0,.55-.17,1,1,0,0,0,.28-1.38L3.87,6H11a2,2,0,0,1,2,2V9a2,2,0,0,1-2,2H2a1,1,0,0,0,0,2h9a4,4,0,0,0,4-4V8A4,4,0,0,0,11,4Z"/></symbol><symbol viewBox="0 0 16 16" id="chart-bars"><g id="chart-bars-chart-bars-16x"><path d="M14.5,14H14V7.5a.5.5,0,0,0-.5-.5h-2a.5.5,0,0,0-.5.5V14H10V5.5A.5.5,0,0,0,9.5,5h-2a.5.5,0,0,0-.5.5V14H6V9.5A.5.5,0,0,0,5.5,9h-2a.5.5,0,0,0-.5.5V14H2V3h.5a.5.5,0,0,0,0-1h-1a.5.5,0,0,0-.5.5v12a.5.5,0,0,0,.5.5h13a.5.5,0,0,0,0-1ZM4,14V10H5v4Zm4,0V6H9v8Zm4,0V8h1v6Z"/></g></symbol><symbol viewBox="0 0 16 16" id="dots-menu"><g id="dots-menu-dots-menu-16x"><circle cx="8" cy="4" r="1"/><circle cx="8" cy="8" r="1"/><circle cx="8" cy="12" r="1"/></g></symbol><symbol viewBox="0 0 16 16" id="filter"><g id="filter-filter-16x"><path d="M5.7,14.86V7.27L1,1H15L10.3,7.27v5ZM3,2,6.7,6.94v6.2l2.6-1.5V6.94L13,2Z"/></g></symbol><symbol viewBox="0 0 16 16" id="gear"><g id="gear-gear-16x"><path d="M8.72,15H7.34c-.54,0-.71-.33-1.33-1.89L5.82,13c-1.41.64-1.59.64-1.73.64H4l-.43-.22-1-1c-.39-.41-.25-.78.4-2.29L2.9,10C1.33,9.44,1,9.27,1,8.72V7.34c0-.57.37-.73,1.9-1.33L3,5.82C2.27,4.3,2.15,4,2.54,3.56l1-1A.76.76,0,0,1,4,2.37,5.74,5.74,0,0,1,5.8,3L6,2.9C6.56,1.36,6.73,1,7.28,1H8.66c.54,0,.71.33,1.33,1.89l.19.08c1.42-.65,1.58-.66,1.74-.64l.19,0,.33.18,1,1c.39.39.27.75-.39,2.29L13.1,6c1.56.57,1.9.73,1.9,1.29V8.66c0,.57-.37.73-1.9,1.33l-.07.19c.7,1.52.82,1.87.43,2.26l-1,1a.76.76,0,0,1-.52.21c-.13,0-.32,0-1.75-.61l-.2.08C9.43,14.67,9.27,15,8.72,15ZM7.48,14H8.57c.1-.21.29-.67.55-1.39l.08-.21.23-.14.78-.33.19.08c.91.4,1.31.54,1.48.6l.77-.77c-.07-.22-.27-.68-.59-1.38l-.1-.19L12,10l.32-.78.2-.08C12.88,9,13.7,8.68,14,8.52V7.43c-.2-.11-.67-.29-1.39-.56l-.27-.09-.41-1,.09-.2c.14-.33.49-1.14.59-1.47l-.77-.77c-.15,0-.52.2-1.38.6l-.2.09L10,4l-.79-.33-.07-.19C9,3.12,8.68,2.3,8.52,2H7.43c-.1.21-.29.67-.55,1.39l-.08.2-.22.15-.79.33L5.6,4A15.17,15.17,0,0,0,4.12,3.4l-.77.76c.07.22.27.68.59,1.38l.1.19L4,6l-.32.78-.2.08C3.12,7,2.3,7.32,2,7.48V8.57c.2.11.67.29,1.39.56l.21.07.15.23.32.78-.09.2c-.14.33-.49,1.14-.59,1.47l.77.77c.15-.06.52-.2,1.38-.6l.2-.09L6,12l.79.33.08.2C7,12.89,7.32,13.7,7.48,14Z"/><path d="M8,10.5A2.5,2.5,0,1,1,10.5,8,2.5,2.5,0,0,1,8,10.5Zm0-4A1.5,1.5,0,1,0,9.5,8,1.5,1.5,0,0,0,8,6.5Z"/></g></symbol><symbol viewBox="0 0 24 24" id="icon-check-mark"><g id="icon-check-mark-check-mark-24x"><path d="M8.11,19.36a1,1,0,0,1-.71-.29l-4.95-5a1,1,0,0,1,0-1.41,1,1,0,0,1,1.42,0L8.11,17l12-12a1,1,0,0,1,1.42,0,1,1,0,0,1,0,1.41L8.82,19.07A1,1,0,0,1,8.11,19.36Z"/></g></symbol><symbol viewBox="0 0 16 16" id="icon-close"><g id="icon-close-close-16x"><path d="M9.41,8l5.3-5.29a1,1,0,1,0-1.42-1.42L8,6.59,2.71,1.29A1,1,0,0,0,1.29,2.71L6.59,8l-5.3,5.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L8,9.41l5.29,5.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42Z"/></g></symbol><symbol viewBox="0 0 24 24" id="icon-download"><g id="icon-download-download-24x"><path d="M22,23H2a1,1,0,0,1-1-1V17a1,1,0,0,1,2,0v4H21V17a1,1,0,0,1,2,0v5A1,1,0,0,1,22,23Z"/><path d="M19,10a1,1,0,0,0-.29-.71,1,1,0,0,0-1.42,0L13,13.58V2a1,1,0,0,0-2,0V13.58L6.71,9.29a1,1,0,0,0-1.42,1.42l6,6a.91.91,0,0,0,.33.22.69.69,0,0,0,.24,0A.7.7,0,0,0,12,17a.7.7,0,0,0,.14,0,.69.69,0,0,0,.24,0,.91.91,0,0,0,.33-.22l6-6A1,1,0,0,0,19,10Z"/></g></symbol><symbol viewBox="0 0 24 24" id="icon-offline"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e   <g id="icon-offline-Mobile-Prototype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="icon-offline-Inbox-Offline" transform="translate(-32.000000, -97.000000)" fill="#9E9E9E"> <g id="icon-offline-controls/alert" transform="translate(16.000000, 84.000000)"> <g id="icon-offline-icon" transform="translate(16.000000, 13.000000)"> <path d="M7.86075713,14.278983 L8.17741033,13.9623298 C8.61266861,13.5270715 9.31870454,13.5270715 9.75396283,13.9623298 L12.0238702,16.2322372 L14.2937776,13.9623298 C14.7290359,13.5270715 15.4350718,13.5270715 15.8703301,13.9623298 L16.1869833,14.278983 C16.6222416,14.7146143 16.6222416,15.4202772 16.1869833,15.8555355 L13.9170759,18.1250699 L16.0777025,20.2856965 C16.5129608,20.7209548 16.5129608,21.4273637 16.0777025,21.862622 L15.7610493,22.1789022 C15.325791,22.6141605 14.6197551,22.6141605 14.1844968,22.1789022 L12.0238702,20.0182756 L9.86287064,22.1789022 C9.42761236,22.6141605 8.72157643,22.6141605 8.28631815,22.1789022 L7.96966495,21.862622 C7.53440666,21.4273637 7.53440666,20.7209548 7.96966495,20.2856965 L10.1302915,18.1250699 L7.86075713,15.8555355 C7.42549885,15.4202772 7.42549885,14.7142413 7.86075713,14.278983 M4.49878784,10.0558215 C6.56169578,8.40765836 9.17138062,7.41517996 12.0171567,7.41517996 C14.846522,7.41517996 17.4431529,8.39572325 19.5008392,10.0267297 C19.8999192,10.2557344 20.1714428,10.6812955 20.1714428,11.1743644 C20.1714428,11.9080002 19.5769255,12.5025176 18.8436626,12.5025176 C18.4408529,12.5025176 18.0842917,12.3193883 17.840741,12.0359296 L17.8317896,12.044881 C16.2276372,10.7887114 14.2128427,10.0334432 12.0175297,10.0334432 C9.81028159,10.0334432 7.78504382,10.7965438 6.17678871,12.0646485 L6.16746441,12.0553242 C5.92391372,12.3440045 5.56399577,12.5316094 5.15671039,12.5316094 C4.42307453,12.5316094 3.82855722,11.9370921 3.82855722,11.2034562 C3.82818425,10.7103873 4.09970784,10.2851992 4.49878784,10.0558215 M24,7.33573693 C24,8.06899981 23.4054827,8.6638901 22.6714739,8.6638901 C22.2716479,8.6638901 21.9173245,8.48337167 21.6737739,8.20326972 L21.632001,8.24504258 C19.0402188,6.00497296 15.6648225,4.64660906 11.9701622,4.64660906 C8.288183,4.64660906 4.92322994,5.99564866 2.3348045,8.22191832 C2.09125381,8.50798782 1.73282775,8.69298191 1.32815317,8.69298191 C0.594517312,8.69298191 0,8.0984646 0,7.36482874 C0,6.90495431 0.234226394,6.49990676 0.589668677,6.26157767 C3.65475228,3.60937403 7.64629825,2 12.0175297,2 C16.3730963,2 20.3515882,3.59818487 23.4118232,6.2332318 C23.7665195,6.47156089 24,6.87623547 24,7.33573693" id="icon-offline-icon-offline"/> </g> </g> </g> </g> </symbol><symbol viewBox="0 0 16 16" id="icon-refresh"><g id="icon-refresh-refresh-16x"><path d="M13.84,7.16a1,1,0,0,0-1,1,4.85,4.85,0,1,1-2.05-4h-1a1,1,0,0,0,0,2H13a1,1,0,0,0,1-1V2a1,1,0,0,0-2,0v.57a6.84,6.84,0,1,0,2.89,5.59A1,1,0,0,0,13.84,7.16Z"/></g></symbol><symbol viewBox="0 0 24 24" id="icon-retrieve-offline"><g id="icon-retrieve-offline-retrieving-24x"><path d="M5.24,13.45a2.86,2.86,0,0,1-.1-4.64l.78-.59-.26-.94a1.09,1.09,0,0,1,0-.26A1.34,1.34,0,0,1,7,5.71a1.65,1.65,0,0,1,.38,0l1.13.33.55-1a3.91,3.91,0,0,1,3.48-2,4,4,0,0,1,2.37.8l1.43-1.43A6,6,0,0,0,7.49,3.75,3.35,3.35,0,0,0,3.63,7a3,3,0,0,0,0,.42,4.83,4.83,0,0,0,.16,7.42Z"/><path d="M18.33,5.71a5.13,5.13,0,0,0-.26-.87l2.14-2.13a1,1,0,1,0-1.42-1.42l-15,15a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L6.92,16H11v3.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3a1,1,0,0,0-1.42-1.42L13,19.59V16h3.64A5.27,5.27,0,0,0,18.33,5.71ZM16.64,14H8.91l7.51-7.51.11.81.95.24A3.27,3.27,0,0,1,16.64,14Z"/></g></symbol><symbol viewBox="0 0 24 24" id="icon-warning"><g id="icon-warning-warning-24x"><path d="M21.33,23H2.62A2,2,0,0,1,.83,20.11L10.18,2.33A2,2,0,0,1,12,1.24h0a2,2,0,0,1,1.79,1.11l9.36,17.74A2,2,0,0,1,21.33,23ZM12,3.26,2.6,21l18.74,0Z"/><path d="M12,16a1,1,0,0,1-1-1V8a1,1,0,0,1,2,0v7A1,1,0,0,1,12,16Z"/><circle cx="12" cy="18" r="1"/></g></symbol><symbol viewBox="0 0 16 16" id="logout"><g id="logout-logout-16x"><path d="M4.5,15h-3a.5.5,0,0,1-.5-.5V1.5A.5.5,0,0,1,1.5,1h3a.5.5,0,0,1,0,1H2V14H4.5a.5.5,0,0,1,0,1Z"/><path d="M14.85,7.65l-4-4a.51.51,0,0,0-.71,0A.5.5,0,0,0,10,4a.49.49,0,0,0,.14.35L13.29,7.5H6a.5.5,0,0,0,0,1h7.29l-3.15,3.15a.51.51,0,0,0,0,.71.5.5,0,0,0,.36.14.49.49,0,0,0,.35-.14l4-4a.48.48,0,0,0,0-.7Z"/></g></symbol><symbol viewBox="0 0 16 16" id="menu"><g id="menu-menu-16x"><path d="M12.5,4h-9a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/><path d="M12.5,8h-9a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/><path d="M12.5,12h-9a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/></g></symbol><symbol viewBox="0 0 16 16" id="panel-detail"><g id="panel-detail-panel-detail-16x"><path d="M13.5,1.5H2.5a1.001,1.001,0,0,0-1,1v11a1.001,1.001,0,0,0,1,1h11a1.001,1.001,0,0,0,1-1V2.5A1.001,1.001,0,0,0,13.5,1.5Zm-11,1h3v11h-3ZM13.5,14v-.5h-7V2.5h7v11h.001Z"/><path d="M11,4.5H9a.5.5,0,0,0,0,1h2a.5.5,0,0,0,0-1Z"/><path d="M11,7.5H9a.5.5,0,0,0,0,1h2a.5.5,0,0,0,0-1Z"/><path d="M11,10.5H9a.5.5,0,0,0,0,1h2a.5.5,0,0,0,0-1Z"/></g></symbol><symbol viewBox="0 0 16 16" id="plus"><g id="plus-plus-16x"><path d="M14.5,7.5h-6v-6a.5.5,0,0,0-1,0v6h-6a.5.5,0,0,0,0,1h6v6a.5.5,0,0,0,1,0v-6h6a.5.5,0,0,0,0-1Z"/></g></symbol><symbol viewBox="0 0 16 16" id="search"><g id="search-search-16x"><path d="M14.85,14.15l-4-4A.53.53,0,0,0,10.7,10,5.44,5.44,0,0,0,12,6.5,5.5,5.5,0,1,0,6.5,12,5.44,5.44,0,0,0,10,10.7a.53.53,0,0,0,.11.15l4,4a.48.48,0,0,0,.7,0A.48.48,0,0,0,14.85,14.15ZM6.5,11A4.5,4.5,0,1,1,11,6.5,4.51,4.51,0,0,1,6.5,11Z"/></g></symbol><symbol viewBox="0 0 16 16" id="sort-down"><g id="sort-down-sort-down-16x"><path d="M14,3.5H2a.5.5,0,0,1,0-1H14a.5.5,0,0,1,0,1Z"/><path d="M11,6.833H2a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/><path d="M8,10.167H2a.5.5,0,0,1,0-1H8a.5.5,0,0,1,0,1Z"/><path d="M5,13.5H2a.5.5,0,0,1,0-1H5a.5.5,0,0,1,0,1Z"/></g></symbol><symbol viewBox="0 0 16 16" id="star"><g id="star-star-16x"><path d="M11.708,14.20605a.50183.50183,0,0,1-.294-.0957L8,11.62988,4.58594,14.11035a.5.5,0,0,1-.76953-.55859L5.12012,9.53809,1.70605,7.05762A.4999.4999,0,0,1,2,6.15332H6.22021l1.3042-4.01367a.52044.52044,0,0,1,.95118,0l1.3042,4.01367H14a.4999.4999,0,0,1,.294.9043L10.87988,9.53809l1.30371,4.01367a.50021.50021,0,0,1-.47558.65429ZM8,10.51172a.50193.50193,0,0,1,.294.0957l2.46337,1.79L9.81641,9.501a.49916.49916,0,0,1,.18164-.5586l2.46289-1.78906H9.4165a.5.5,0,0,1-.47558-.3457L8,3.91211,7.05908,6.80762a.5.5,0,0,1-.47558.3457H3.53906L6.002,8.94238a.49916.49916,0,0,1,.18164.5586l-.94091,2.89648,2.46337-1.79A.50193.50193,0,0,1,8,10.51172Z"/></g></symbol><symbol viewBox="0 0 12 12" id="status-at-risk"><path d="M10,11H2a1,1,0,0,1-.89-1.45l4-8a1,1,0,0,1,1.8,0l4,8A1,1,0,0,1,10,11ZM3.62,9H8.38L6,4.21Z"/></symbol><symbol viewBox="0 0 12 12" id="status-on-time"><path d="M6,11a5,5,0,1,1,5-5A5,5,0,0,1,6,11ZM6,3A3,3,0,1,0,9,6,3,3,0,0,0,6,3Z"/></symbol><symbol viewBox="0 0 12 12" id="status-overdue"><path d="M8,11H4A3,3,0,0,1,1,8V4A3,3,0,0,1,4,1H8a3,3,0,0,1,3,3V8A3,3,0,0,1,8,11ZM4,3A1,1,0,0,0,3,4V8A1,1,0,0,0,4,9H8A1,1,0,0,0,9,8V4A1,1,0,0,0,8,3Z"/></symbol><symbol viewBox="0 0 24 24" id="sync-cases"><path d="M18.6,18H6a4.1,4.1,0,0,1-.28-8.19A6.5,6.5,0,0,1,18.48,11a3.5,3.5,0,1,1,.12,7ZM6,10.8A3.1,3.1,0,0,0,6,17H18.6a2.5,2.5,0,0,0,0-5,2.94,2.94,0,0,0-.51.05l-.63.13,0-.64A5.49,5.49,0,0,0,6.61,10.41l-.08.41L6,10.8Z"/></symbol><symbol viewBox="0 0 24 24" id="sync-failed"><circle class="a" cx="18" cy="15" r="4"/><path class="a" d="M12.26,18H5.65a4.47,4.47,0,0,1-3.79-7.12A4.48,4.48,0,0,1,5.5,9a6.45,6.45,0,0,1,12.07.39.5.5,0,1,1-.94.32,5.46,5.46,0,0,0-10.32,0,.5.5,0,0,1-.52.33H5.64l-.16,0a3.48,3.48,0,0,0-2.81,1.43,3.55,3.55,0,0,0-.49,3.2A3.59,3.59,0,0,0,5.65,17h6.61a.5.5,0,0,1,0,1Z"/><path class="b" d="M18.77,15l1.07-1.07a.54.54,0,0,0-.77-.77L18,14.23l-1.07-1.07a.54.54,0,0,0-.77.77L17.23,15l-1.07,1.07a.55.55,0,0,0,.39.93.52.52,0,0,0,.38-.16L18,15.77l1.07,1.07a.52.52,0,0,0,.38.16.55.55,0,0,0,.39-.93Z"/></symbol><symbol viewBox="0 0 16 16" id="view-grid"><g id="view-grid-view-grid-16x"><path d="M7,7H1V1H7ZM2,6H6V2H2Z"/><path d="M7,15H1V9H7ZM2,14H6V10H2Z"/><path d="M15,7H9V1h6ZM10,6h4V2H10Z"/><path d="M15,15H9V9h6Zm-5-1h4V10H10Z"/></g></symbol></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g id="sync-failed-24x"><path d="M11.91309,17.5H5.82129a4.26506,4.26506,0,0,1-4.10938-2.82031A4.17882,4.17882,0,0,1,5.667,9.167h.00489A6.12717,6.12717,0,0,1,11.165,5.5h.02344a6.104,6.104,0,0,1,5.34277,3.27539.49962.49962,0,0,1-.89258.44922A5.1569,5.1569,0,0,0,11.1875,6.5H11.169a5.1372,5.1372,0,0,0-4.708,3.376.49011.49011,0,0,1-.5127.32129l-.13867-.01661A1.137,1.137,0,0,0,5.667,10.167a3.18006,3.18006,0,0,0-2.55664,1.29785A3.16088,3.16088,0,0,0,5.82129,16.5h6.0918a.5.5,0,0,1,0,1Z" fill="#FFFFFF"/><circle cx="18" cy="16" r="4" fill="#DA3B3B"/></g></svg>')},initAsyncStuff:function(){return $.when(this.loadTemplate("base",bizagi.getTemplate("base.workportal.tablet"))).then((function(e){var t=new $.Deferred;return $("body").append(e),bizagi.util.tablet.startkendo({started:function(){t.resolve()}}),t.promise()}))},loadTemplate:function(e,t){var r=this;return r.templateService.getTemplate(t,e).done((function(t){"string"==typeof t&&(r.templates[e]=$.trim(t.replace(/\n/g,"")))}))},loadTemplateWebpart:function(e,t){var r=this;return r.templateService.getTemplateWebpart(t,e).done((function(t){r.templates[e]=$.trim(t.replace(/\n/g,""))}))},getTemplate:function(e){return this.templates[e]},loadWebpart:function(e){var t=this,r=new $.Deferred,i=e.webpart,a=bizagi.getWebpart(i,e);return a||bizagi.log("webpart not found"),"release"===bizagi.loader.environment?r.resolve(a):$.when(bizagi.util.initWebpart(a,t.device)).done((function(){$.when.apply(this,$.map(a.tmpl,(function(e){return t.loadTemplateWebpart(e.originalAlias,bizagi.getTemplate(e.alias,!0))}))).done((function(){r.resolve(a)}))})),r.promise()},getWebpart:function getWebpart(webpartImplementation,params){var _hasConstructorName=function(e,t){return t.constructorName?t.constructorName:e};try{var dynamicFunction;webpartImplementation=_hasConstructorName(webpartImplementation,params),-1===webpartImplementation.indexOf("bizagi")&&(webpartImplementation="bizagi.workportal.webparts."+webpartImplementation);var stringBuilder=["var baDynamicFn = function(facade, dataService, params){ \r\n"];return stringBuilder.push("return new "+webpartImplementation+"(facade, dataService, params);\r\n"),stringBuilder.push("}\r\n"),stringBuilder.push("baDynamicFn"),dynamicFunction=eval(stringBuilder.join("\n")),dynamicFunction(this,this.dataService,params)}catch(e){bizagi.log(e)}},executeWebpart:function(e){var t=this,r=new $.Deferred;return $.when(t.loadWebpart(e)).done((function(i){var a=i.class,s=t.getWebpart(a,e);$.when(s.isAuthorized()).done((function(t){t?$.when(s.render($.extend(e,{creating:!1}))).done((function(){e.canvas.triggerHandler("ondomincluded"),r.resolve(s)})):r.fail()}))})).fail((function(e){console.log(e.message),r.fail(e)})),r.promise()},executeWebparts:function(e){var t=this,r=!0!==e;return t.loadModule(t.Class.render_module),$.when(t.dataService.getCurrentUser()).fail((function(e){$.when(t.dataService.logoutMobile()).always((function(e){t.defaultLogout()}))})).pipe((function(e){var i;e.userProperties={};var a=-1;for(t.startedOffline(!1===t.dataService.online);i=e.sUserProperties[++a];)e.userProperties[i.key]=i.value;bizagi.currentUser=e;var s=e.userProperties.userstartpage=e.userProperties.userstartpage||"";if(t.sortMenuItemsByStartPage(s,e),r)return $.when(t.loadReleaseTemplates(),t.security.getSecurity()).then((function(){return $.when(t.executeWebpart({webpart:"homePortal",constructorName:t.homePortalFramework.getHomePortalConstructorName(),loadMeSection:t.meSection(),canvas:$("body")}),t.executeWebpart({webpart:"newcase",canvas:$("body")}),t.executeWebpart({webpart:"render",canvas:$("body")})).then((function(){bizagi.debug("Finalizo ejecución de webparts workportal")}))}))}))},loadReleaseTemplates:function loadReleaseTemplates(){if("release"!==bizagi.loader.environment)return!0;var self=this,defer=new $.Deferred,prefix=bizagi.loader.useAbsolutePath?bizagi.loader.basePath+bizagi.loader.getLocationPrefix():""+bizagi.loader.getLocationPrefix(),url=prefix+"jquery/workportalflat/production/"+this.device.replace(/[^a-z0-9]+/gi,"")+"/webpart."+this.device.replace(/[^a-z0-9]+/gi,"")+".production.tmpl.html?build="+bizagi.loader.build;return steal.then({src:url,id:url,type:"text",waits:!1,onError:function(e){bizagi.log("Could not load file "+e.src,e,"error"),defer.reject(e)}}).then((function(){var waitingTime=1e3;setTimeout((function(){var data=steal.resources[url].options.text;self.templates=eval("("+data+")"),Object.keys(self.templates).map((function(e){self.templates[e]=self.templateService.localization.translate(self.templates[e])})),defer.resolve()}),waitingTime)})),defer.promise()},sortMenuItemsByStartPage:function(e,t){var r=this;_isStakeholder=void 0!==t.associatedStakeholders&&t.associatedStakeholders.length>0,_automaticOrMe="1"===e||"2"===e,_changingView=function(){var e=r.homePortalFramework.isChangingView();return r.homePortalFramework.isChangingView(!1),e},_isChangingView=_changingView(),_loadMe=r.meSection(_automaticOrMe&&_isStakeholder&&!_isChangingView),_loadMe?r.homePortalFramework.homePortalLayout=$.extend(r.homePortalFramework.homePortalLayoutDashboard,r.homePortalFramework.homePortalLayoutTaskFeed,r.homePortalFramework.homePortalLayoutComplement,r.homePortalFramework.homePortalLayoutSyncErrors):r.homePortalFramework.homePortalLayout=$.extend(r.homePortalFramework.homePortalLayoutTaskFeed,r.homePortalFramework.homePortalLayoutDashboard,r.homePortalFramework.homePortalLayoutComplement,r.homePortalFramework.homePortalLayoutSyncErrors)},meSection:function(e){return void 0!==e&&(this.loadMeSection=e),this.loadMeSection},hasStakeholders:function(){return bizagi.currentUser.associatedStakeholders&&bizagi.currentUser.associatedStakeholders.length>0},startedOffline:function(e){return void 0!==e&&(this._startedOffline=e),this._startedOffline},validateUserInformation:function(){var e,t=!0===this.startedOffline();return t&&this.dataService.online&&this.firstConnectionDone(),t?this.executeWebparts(!0):((e=new $.Deferred).resolve(),e)},executeOnFirstOnline:function(){var e=!this.startedOffline(),t=void 0===this._firstConnectionDone?e:this._firstConnectionDone,r=this.startedOffline()&&!1===t,i=void 0===this._firstConnectionDefer?new $.Deferred:this._firstConnectionDefer;return this._firstConnectionDefer=i,this._firstConnectionDone=t,r||i.reject(),i},firstConnectionDone:function(){this._firstConnectionDone=!0,void 0!==this._firstConnectionDefer&&this._firstConnectionDefer.resolve()},loadModule:function(e){var t=this;if("string"==typeof e)return void 0!==t.modules[e]?t.modules[e]:(t.modules[e]=new $.Deferred,bizagi.loader.start(e).then((function(){t.modules[e].resolve()})),t.modules[e].promise())},defaultLogout:function(){bizagi.util.isCordovaSupported()?window.location=bizagi.services.ajax.logoutPage:window.location.replace("")}}),bizagi.workportal.tablet.facade.extend("bizagi.workportal.tablet.facade",{BIZAGI_NATIVE_COMPONENT_HOMEPORTAL:"homeportal"},{executeWebparts:function(){var e=this;return e._super.apply(this,arguments).then((function(){bizagi.util.isNativePluginSupported()&&(bizagi.getNativeComponent()===e.Class.BIZAGI_NATIVE_COMPONENT_HOMEPORTAL?bizagiapp.homePortalReady():bizagiapp.workPortalReady())}))},sortMenuItemsByStartPage:function(e,t){bizagi.util.isAndroidDevice()?(void 0!==t.associatedStakeholders&&t.associatedStakeholders.length,this.homePortalFramework.homePortalLayout=$.extend(this.homePortalFramework.homePortalLayoutDashboard,this.homePortalFramework.homePortalLayoutComplement)):this._super(e,t)},loadModule:function(e){var t=this,r=bizagi.util.detectRealDevice();if("string"==typeof e)return t.modules[e]=new $.Deferred,bizagi.loader.start(e,r).then((function(){t.modules[e].resolve()})),t.modules[e].promise()}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},$.Class.extend("bizagi.workportal.webpart.helper",{},{init:function(e){this.dataService=e.dataService,this.resources=e.resources,this.workportalFacade=e.workportalFacade,this.templates={}},getFileImage:function(e){return e&&0!=e.length?e:this.getEmptyFile()},getFile:function(e){return e&&0!=e.length?this.dataService.getFile(e[0]):this.getEmptyFile()},loadTemplate:function(e,t){var r=this;return r.workportalFacade.templateService.getTemplate(t).done((function(t){r.templates[e]=t}))},isWebpartInIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},getFailServerErrorDeferred:function(e,t,r){}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webpart=void 0!==bizagi.webpart?bizagi.webpart:{},bizagi.webpart.subscribe=function(e,t){$(document).bind(e,t)},bizagi.webpart.publish=function(e,t){return $(document).triggerHandler(e,t)},bizagi.webpart.whenCreated=function(e,t){bizagi.webpart.subscribe("bizagi-webpart-created",(function(r){r.webpart.Class.fullname=="bizagi.workportal.webparts."+e&&t&&t(r)}))},bizagi.webpart.whenExecuted=function(e,t){bizagi.webpart.subscribe("bizagi-webpart-executed",(function(r){r.webpart.Class.fullname=="bizagi.workportal.webparts."+e&&t&&t(r)}))},bizagi.workportal.controllers.controller.extend("bizagi.workportal.webparts.webpart",{BIZAGI_WORKPORTAL_WEBPART_ROUTING:"routing",BIZAGI_WORKPORTAL_WEBPART_RENDER:"activityform",BIZAGI_WORKPORTAL_WEBPART_ASYNC:"async",BIZAGI_WORKPORTAL_WEBPART_OLDRENDERINTEGRATION:"oldrenderintegration",BIZAGI_TAP_EVENT:"ontouchstart"in window?"touchend":"click"},{init:function(e,t,r){var i=this;i.authorizationRole=r.authorizationRole,this._super(e,t,r),this.helper=new bizagi.workportal.webpart.helper(this),this.canvas=r.canvas,this.pane=r.pane,this.project=r.project,this.sharepointProxyPrefix=r.sharepointProxyPrefix,this.homePortalFramework=this.workportalFacade.homePortalFramework,i.security=new bizagi.workportal.command.security(t),this.namespace=r.namespace,this.isVisible=!0,this.isWebpartInIFrame=void 0!==r.isWebpartInIFrame?r.isWebpartInIFrame:i.helper.isWebpartInIFrame(),this.adjustButtonsToContent=r.adjustButtonsToContent,this.remoteServer=r.remoteServer,this.remoteServer&&(i.postmessageSocket=new bizagi.postmessage({remoteServer:this.remoteServer,destination:window.parent,origin:window}),i.postmessageSocket.receive=function(e){var t=e.data;if((!t.message||t.message.iframeidentifier!=BIZAGI_IFRAME_IDENTIFIER)&&t.event)switch(t.event){case"postmessage-bizagi-canCloseIFramePopUp":i.canHide&&i.Class.shortName==t.message.webPartDestine&&$.when(i.canHide()).done((function(){var e={event:"postmessage-bizagi-closeIFramePopUp",message:{}};e.message.iframeidentifier=BIZAGI_IFRAME_IDENTIFIER,i.postmessageSocket.send(e);var t={message:{},event:"ui-bizagi-reload-cases"};i.postmessageSocket.send(t)}));break;case"postmessage-bizagi-openParentPopUp":break;default:i.publish(t.event,t.message,!0)}},i.postmessageSocket.startReceiving(),i.sendDimensionsiFrame())},isAuthorized:function(){var e=this,t=new $.Deferred;return $.when(e.workportalFacade.security.checkSecurityPerm(e.authorizationRole)).done((function(r){r||void 0===e.authorizationRole?t.resolve(!0):t.resolve(!1)})),t.promise()},sendDimensionsiFrame:function(e){var t=this;this.remoteServer&&(t.adjustButtonsToContent||t.namespace&&!e||t.isWebpartInIFrame&&window.setTimeout((function(){var e={message:{}};e.message.iframeName=BIZAGI_IFRAME_IDENTIFIER,e.message.iframeHeight=$("body").height(),"newcaselist"==t.Class.shortName||(e.message.iframeWidth=void 0),t.postmessageSocket.send(e)}),50))},publish:function(e,t,r){if(e=this.namespace?this.namespace+"."+e:e,!r&&-1==e.indexOf("bizagi-webpart-created")&&-1==e.indexOf("bizagi-webpart-executed")&&this.postmessageSocket){var i={};i.event=e,t&&(t.canvas=null,t.workportal=null),i.message={},i.message=$.extend(t,{project:this.project,iframeidentifier:BIZAGI_IFRAME_IDENTIFIER}),this.postmessageSocket.send(i)}return this._super(e,$.extend(t,{project:this.project}))},subscribe:function(e,t){var r=this;e=this.namespace?this.namespace+"."+e:e,this._super(e,(function(e,i){if(void 0===i&&(i={}),r.project==i.project&&r.isVisible)return t(e,i)}))},unsubscribe:function(e,t){e=this.namespace?this.namespace+"."+e:e,this._super(e,t)},refresh:function(e){var t,r=this;return(t="view"==r.canvas.data("role")?r.canvas.data("kendoMobileView").contentElement():r.canvas).empty(),r.render(e).then((function(e){return t.append(e),r.canvas.triggerHandler("ondomincluded"),"included"}))},render:function(e){var t=this;return t.params=e,e.creating?(t.content=t.empty(),t.publish("bizagi-webpart-created",{webpart:t}),t.content):(t.publish("bizagi-webpart-created",{webpart:t}),$.when(t.renderContent(e)).pipe((function(r){return"string"==typeof r&&(r=$(r)),t.content=r,e.canvas.append(r),$.when(t.postRender(e)).then((function(){return t.publish("bizagi-webpart-executed",{webpart:t}),t.sendDimensionsiFrame(),t.getContent()}))})))},renderContent:function(e){},postRender:function(e){},getContent:function(){return this.content},empty:function(){return $("<div/>")},getTemplate:function(e){return this.workportalFacade.getTemplate(e)},createWebpart:function(e){return this.workportalFacade.workportal.createWebpart(e)},executeWebpart:function(e){return this.workportalFacade.workportal.executeWebpart(e)},manageError:function(e,t,r){var i=this,a="";if(-1==(a=e.responseText?e.responseText:e).indexOf("AUTHENTICATION_ERROR"))i.helper.getFailServerErrorDeferred({message:a,sharepointProxyPrefix:i.sharepointProxyPrefix},t),i.endWaiting(),r&&t.done((function(e){r.append(e),i.endWaiting()}));else{var s=i.content="<div class='ui-bizagi-webpart-error-message'>The current user does not exist as a registered user in the bizagi project</div>";r&&r.append(s),i.endWaiting(),t.resolve(s)}},hide:function(e){this.canvas.hide(),e&&this.canvas.parent().hide(),this.isVisible=!1},show:function(){this.canvas.show(),this.canvas.parent().show(),this.isVisible=!0},isVisible:function(){return this.isVisible},destroy:function(){},getHomeportalFrameworkIntance:function(){return this.workportalFacade.homePortalFramework||(this.workportalFacade.homePortalFramework=new bizagi.workportal.homeportalFramework(this.workportalFacade)),this.workportalFacade.homePortalFramework}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.rendermanager",{},{init:function(e,t,r){this._super(e,t,r),r&&void 0!==r.navigator||console.error("it is a render webpart and there is no navigator to this webpart"),this.navigator=r.navigator}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},$.Class.extend("bizagi.workportal.homeportalFramework",{},{init:function(e){this.workportalFacade=e,this.device=bizagi.detectDevice(),this.accumulatedContext=[],this.navigateFromRender=!1,this._homeportalShow(),this.configureHandler(),bizagi.util.mobility.homePortalNavigate=$.proxy(this.homePortalNavigate,this),bizagi.util.mobility.homePortalViewShow=$.proxy(this.homePortalViewShow,this),bizagi.util.mobility.homePortalViewInit=$.proxy(this.homePortalViewInit,this),bizagi.util.mobility.homePortalViewHide=$.proxy(this.homePortalViewHide,this),bizagi.util.mobility.drawerBeforeShow=$.proxy(this.drawerBeforeShow,this)},loadComponents:function(e,t){var r=this,i=[];return $.each(r.homePortalLayout,(function(a,s){if(Array.isArray(s.position))$.each(s.position,(function(o,n){if(n===e){var l=$("#"+s.canvas[o],t),c=r.workportalFacade.executeWebpart({webpart:a,canvas:l,pane:l.parent('div[data-role="pane"]')});i.push(c)}}));else if("drawer"!==s.type&&s.position===e){var o=$("#"+s.canvas,t),n=r.workportalFacade.executeWebpart({webpart:a,constructorName:s.constructorName,canvas:o,pane:o.parent('div[data-role="pane"]')});i.push(n)}else if("drawer"===s.type&&s.position===e){o=$("#"+s.canvas,"body"),n=r.workportalFacade.executeWebpart({webpart:a,canvas:o});i.push(n)}})),$.when(i)},loadComponentTemplate:function(e,t,r){var i=this,a=kendo.template(i.workportalFacade.getTemplate(e),{useWithBlock:!1}),s=[];for(var o in i.homePortalLayout){var n=i.homePortalLayout[o];Array.isArray(n.position)?$.each(n.position,(function(e,r){r===t&&s.push({canvas:i.homePortalLayout[o].canvas[e]})})):"drawer"!==n.type&&n.position===t&&s.push(n),"drawer"===n.type&&o===t&&$.extend(r,{canvas:n.canvas,direction:n.direction})}return a($.extend(r,{homePortalLayoutPositions:s}))},_homeportalShow:function(){var e=this;bizagi.webpart.subscribe("homeportalShow",(function(t,r){r.params=r.params||{};var i="",a=!1,s=!1;switch(r.what){case"reportsChart":i="reportsChart",a=!1;break;case"stuffTemplates":i="renderTemplates",r.params.data&&r.params.data.navigateFromRender&&(e.setContextFromRender(r),e.navigateFromRender=s=r.params.data.navigateFromRender);break;case"syncErrors":r.transition="overlay:left",i=r.what,a=!1;break;case"favorites":case"pendings":case"ontime":case"overdue":case"risk":i="caseTemplates";break;case"startForm":r.transition="overlay:up",i=r.what;break;case"newCase":case"menu":case"render":a=!0;break;case"activitiesOptions":r.what="caseTemplatesOptions",a=!0;break;default:i=r.what}if(a)e.showDrawer(r.what);else{e.closeDrawers();var o=e.homePortalLayout[i].canvas,n=$("#"+o);if("none"===n.css("display")||"#renderTemplates"===n.selector){var l=n.parent().data("kendoMobilePane");r.preventNavigate||(s?e.navigateToRenderTemplates():l.navigate(o,r.transition||"")),r.title&&$.each(l.view().header,(function(e,t){$(".km-navbar",t).data("kendoMobileNavBar").title(r.title)})),bizagi.util.isAndroidSmartphoneDevice()&&"stuffTemplates"==r.what&&$(".wp-homeportal-rht-pnl-container > div#tmpl-scroller",l.view().content).css("padding-bottom","64px")}}bizagi.webpart.publish("homeportalShow-"+r.what,r.params)}))},configureHandler:function(){var e=this;bizagi.webpart.subscribe("homeportalBack",(function(t,r){e._back()})),bizagi.webpart.subscribe("homeportalShowNotification",(function(e,t){$.notifier.add({text:t.message})}))},showDrawer:function(e){if("newCase"===e)bizagi.webpart.publish("newcase-refresh",{refreshCurrentStatus:!0}),$("#newCase-drawer").data("kendoMobileDrawer").show();else if("menu"===e)$("#menu-drawer").data("kendoMobileDrawer").scroller.reset(),$("#menu-drawer").data("kendoMobileDrawer").show();else if("caseTemplatesOptions"===e)$("#caseTemplatesOptions").data("kendoMobileDrawer").show();else if("syncErrors"===e){bizagi.webpart.publish("bz-update-list-sync-errors-cases",{refreshCurrentStatus:!0});var t=bizagi.localization.getResource("workportal-offline-sync-errors-view-tittle");bizagi.webpart.publish("homeportalShow",{what:"syncErrors",title:t,params:{},preventNavigate:!1}),bizagi.webpart.publish("bz-left-panel-hide")}else $("#bz-render-drawer").length>0&&$("#bz-render-drawer").data("kendoMobileDrawer").show()},_cleanContext:function(){void 0!==this.accumulatedContext&&(this.accumulatedContext=[]),this.navigateFromRender=!1},getActionsContext:function(){var e={},t=this.accumulatedContext;return t.length>0?e.context=$.map(t,(function(e){var t={entityGuid:e.entityGuid?e.entityGuid:e.guidEntityCurrent};return null!==e.surrogateKeyToMapping?t.surrogateKey="object"===_typeof(e.surrogateKeyToMapping)?e.surrogateKeyToMapping:[e.surrogateKeyToMapping]:t.surrogateKey="",t})).filter((function(e){return""!==e.surrogateKey})):e.context=[],e},addContext:function(e){return this.accumulatedContext.push(e),{context:this.accumulatedContext}},extendCurrentContext:function(e){$.extend(this.accumulatedContext[this.accumulatedContext.length-1],e)},popContext:function(){return this.accumulatedContext.pop(),{context:this.accumulatedContext}},setContextFromRender:function(e){e=e.params||{},this.addContext($.extend(e.data,{entityType:"actionLauncher"}))},homePortalViewInit:function(e){e.view.element.trigger("view-initialized",e.view)},homePortalViewHide:function(e){e.view.element.trigger("view-hidden",e.view)},homePortalViewShow:function(e){e.view.element.trigger("homeportal-view-show",e.view)}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},bizagi.workportal.homeportalFramework.extend("bizagi.workportal.homeportalFramework",{},{init:function(e){this._super(e),this.deviceType="tablet",this.homePortalLayout={},this.homePortalLayoutDashboard={menuHome:{position:"homePortal",direction:"left",type:"view",canvas:"menuHome",title:"",layout:"menu-default"},dashBoard:{position:"homePortal",direction:"right",type:"view",canvas:"dashBoard",title:"",layout:"main-default"}},this.homePortalLayoutComplement={reportsChart:{position:"homePortal",direction:"right",canvas:"reportsChart",title:"Reports",layout:"main-default-close"},loadForm:{position:"homePortal",direction:"right",type:"view",canvas:"loadForm",title:"Search Form",layout:"main-default-close-action"},renderTemplates:{position:"homePortal",direction:"right",type:"view",canvas:"renderTemplates",title:"Render Template",layout:"main-double-header"},caseTemplates:{position:"homePortal",direction:"right",type:"view",canvas:"caseTemplates",title:"",layout:"main-double-header-cases"},caseTemplatesOptions:{position:"homePortal",direction:"left",type:"view",canvas:"caseTemplatesOptions",title:"",layout:"side-default-back"},stakeHolder:{position:"homePortal",canvas:"menuHome"},shortCut:{position:"menuHome",canvas:"shortCut"},searchesList:{position:"menuHome",canvas:"searchesList"},stuff:{position:["dashBoard"],canvas:["stuff"]}};var t=this.viewRequirements(this._viewTaskFeedMode());this.homePortalWebpart=t.homePortalWebpart,this.menuWebpart=t.menuWebpart,this.homePortalLayoutTaskFeed=t.taskFeedLayout,this.homePortalLayoutSyncErrors={syncErrors:{position:"homePortal",direction:"right",type:"view",canvas:"syncErrors",title:"Sync errors",layout:"main-syncErrors-header"}},bizagi.util.mobility.leftPaneViewShown=$.proxy(this.leftPaneViewShown,this)},VIEW_TASKFEED_MODE:{CARDS:"cards",LIST:"list"},viewRequirements:function(e){var t={},r={homePortalWebpart:{constructorName:void 0},menuWebpart:{constructorName:void 0},taskFeedLayout:{taskFeed:{position:"homePortal",direction:"left",type:"view",canvas:"taskFeed",title:"",layout:"side-default"},summaryItem:{position:"homePortal",direction:"right",canvas:"summaryItem",type:"view",title:"",layout:"main-default"}}};switch(e){case this.VIEW_TASKFEED_MODE.LIST:t=r;break;case this.VIEW_TASKFEED_MODE.CARDS:t.homePortalWebpart={constructorName:"homePortalCards"},t.menuWebpart={constructorName:"menuCards"},t.taskFeedLayout={taskFeed:{constructorName:"taskFeedCards",position:"homePortal",direction:"right",type:"view",canvas:"taskFeed",title:"",layout:"main-default"},summaryItem:{constructorName:"summaryItemCards",position:"homePortal",canvas:"summaryItem"}};break;default:console.error("Error: view to show is not defined"),t=r}return t},getHomePortalConstructorName:function(){return this.homePortalWebpart.constructorName},getMenuConstructorName:function(){return this.menuWebpart.constructorName},getSummaryItemConstructorName:function(){return this.homePortalLayoutTaskFeed.summaryItem.constructorName},_back:function(e){"left"===e?$("#left-pane").data("kendoMobilePane").navigate("#:back"):$("#right-pane").data("kendoMobilePane").navigate("#:back")},_backRenderTemplates:function(e){if(this.accumulatedContext.length>1){var t=this.accumulatedContext[this.accumulatedContext.length-1],r=this.popContext().context;if(t.navigateFromRender)bizagi.kendoMobileApplication.navigate("renderSplitView"),this.navigateFromRender=!1;else{var i=r[r.length-1],a={data:i,calculateFilters:i.calculateFilters||!1,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:a.data.displayName,params:a,preventNavigate:!0})}}else this.navigateFromRender&&(bizagi.kendoMobileApplication.navigate("renderSplitView"),this.navigateFromRender=!1);this._back(e)},_collapseHomePortalPane:function(){$("#homePortal").data("kendoMobileSplitView").collapsePanes()},configureHandler:function(){this._super()},navigateToRenderTemplates:function(e){$("#homePortal #right-pane").data("kendoMobilePane").navigate("renderTemplates"),bizagi.kendoMobileApplication.navigate("homePortal")},homePortalNavigate:function(e){e.url,e.sender.element},homePortalViewInit:function(e){var t=this;switch(t._super(e),t.destination=e.view.id.replace(/#/i,""),t.content=e.view.element,t.container=e.view.container,t.destination){case"summaryItem":$(t.content).on("click",".bz-header-open-leftPane",(function(e){t._openLeftPane()})),$(t.content).on("click",".btn-back",(function(e){t._back()})),$(t.content).on("touchend","#bz-workarea-newcase",(function(e){e.preventDefault(),t.showNewCase()})),$(t.content).on("touchend","#bz-workarea-changeview",(function(e){e.preventDefault(),t.changeView()})),$(t.content).on("touchend","#bz-workarea-view-sync-panel",(function(e){e.preventDefault(),t.showSyncPanel()}));break;case"dashBoard":$(".km-view-title",t.content).children().text("DashBoard"),$(t.content).on("click",".bz-header-open-leftPane",(function(e){t._openLeftPane()})),$(t.content).on("click",".btn-back",(function(e){t._back()})),$(t.content).on("click","#bz-workarea-newcase",(function(e){t.showNewCase()}));break;case"discussionCase":$(t.content).on("click",".btn-back",(function(e){t._back()})),$(t.content).on("click","#bz-workarea-newcase",(function(e){t.showNewCase()}));break;case"menuHome":$(t.content).data("kendoMobileView").header.on("click",".btn-menu",(function(e){t.showMenu()}));break;case"taskFeed":$(t.content).on("touchend",".bz-header-left-btn.btn-open-drawer",(function(e){e.preventDefault(),t.showMenu()})),$(t.content).on("touchend","#bz-workarea-newcase",(function(e){e.preventDefault(),t.showNewCase()})),$(t.content).on("touchend","#bz-workarea-changeview",(function(e){e.preventDefault(),t.changeView()})),$(t.content).on("touchend","#bz-workarea-view-sync-panel",(function(e){e.preventDefault(),t.showSyncPanel()}));break;case"syncErrors":$(t.content).on("click",".btn-back",(function(e){t._viewTaskFeedMode()===t.VIEW_TASKFEED_MODE.LIST?(bizagi.webpart.publish("bz-left-panel-show"),t.destination="summaryItem"):t.destination="taskFeed",bizagi.webpart.publish("bz-update-list-cases",{updateDataList:!0}),t._back()}));break;case"caseTemplatesOptions":$(t.content).on("click",".bz-header-left-btn.btn-back",(function(e){t._back("right"),t._back("left")}));break;case"caseTemplates":$(t.content).on("click",".bz-header-open-leftPane",(function(e){t._openLeftPane()})),$(t.content).on("click","#bz-workarea-newcase",(function(e){t.showNewCase()}));break;case"renderTemplates":$(t.content).on("click",".btn-back",(function(e){t._backRenderTemplates()})),$(t.content).on("click","#bz-workarea-newdata",(function(e){bizagi.webpart.publish("newData")})),$(t.content).on("click",".bz-header-open-leftPane",(function(e){t._openLeftPane()}));break;case"reportsChart":$(t.content).on("click",".btn-close",(function(e){$("iframe",".bz-wp-reports-chart").remove(),$(".bz-wp-reports-chart",t.content).empty(),t.reportsChartEndLeftPanel()}))}},homePortalViewShow:function(e){var t,r=this;switch(r._super(e),r.destination=e.view.id.replace(/#/i,""),r.content=e.view.element,r.container=e.view.container,r.destination){case"renderTemplates":$(".km-view-title",r.content).children().text("DashBoard");break;case"caseTemplates":t=e.sender.history.length,e.sender.history[t-1]===e.sender.history[t-3]&&(e.sender.history.pop(),e.sender.history.pop()),$("#left-pane").getKendoMobilePane().navigate("caseTemplatesOptions");break;case"reportsChart":t=e.sender.history.length,e.sender.history[t-1]===e.sender.history[t-3]&&e.sender.history.pop(),$(".km-view-title",r.content).children().text(""),$(".btn-close",r.content).unbind("click").bind("click",(function(){$("iframe",".bz-wp-reports-chart").remove(),$(".bz-wp-reports-chart",r.content).empty(),$(".km-view-title",r.content).children().text(""),r._back()})),r.reportsChartEndLeftPanel=r.reportsChartStartLeftPanel()}r.getMenuWebpartInstance()},reportsChartStartLeftPanel:function(){var e=$("#left-pane",this.canvas),t="none"!==e.css("display")?e.toggle.bind(e):function(){};return t(),t},leftPaneViewShown:function(e){this.leftDestination=e.view.id.replace(/#/i,""),this.leftContent=e.view.element},_openLeftPane:function(){bizagi.kendoMobileApplication.view().expandPanes()},homePortalLayoutInit:function(e){},closeDrawers:function(){$("#newCase-drawer").data("kendoMobileDrawer").hide()},showNewCase:function(){this.showDrawer("newCase")},showSyncPanel:function(){this.showDrawer("syncErrors")},changeView:function(){var e=this.VIEW_TASKFEED_MODE,t=this._viewTaskFeedMode()===e.CARDS?e.LIST:e.CARDS;this._viewTaskFeedMode(t),this.isChangingView(!0),location.reload()},_getSetLocalStorage:function(e,t,r){var i=function(){return localStorage.getItem(e)},a=function(t){return localStorage.setItem(e,t)};return void 0!==t&&a(t),null===i()&&a(r),i()},_viewTaskFeedMode:function(e){var t=this.VIEW_TASKFEED_MODE.LIST;return bizagi.util.isMobileInboxCardViewSupported()?this._getSetLocalStorage("homePortalView",e,t):t},isChangingView:function(e){return"true"==this._getSetLocalStorage("homePortalChangingView",e,!1)},showMenu:function(){this.getMenuWebpartInstance().done((function(e){e.showModal()}))},getMenuWebpartInstance:function(){var e=this,t=void 0!==e.menuWebpartInstance,r=e.workportalFacade.executeWebpart.bind(e.workportalFacade,{webpart:"menu",canvas:$("body"),isCardsLayout:"homePortalCards"===e.homePortalWebpart.constructorName}),i=t?new $.Deferred:r();return t?i.resolve(e.menuWebpartInstance):i.then((function(t){e.menuWebpartInstance=t})),i}}),bizagi.reporting||(bizagi.reporting={}),bizagi.reporting={BAMProcess:{defaultReport:"bamprocessloadanalysis",info:{reportSet:1},reports:{bamprocessloadanalysis:{components:["filters-processversion","filters-dimension"],resource:"bz-rp-loadanalysis-tab"},bamprocessworkinprogress:{components:["filters-processversion","filters-dimension"],resource:"bz-rp-workinprogress-tab"}}},BAMTask:{defaultReport:"bamtasksworkinprogress",info:{reportSet:2},reports:{bamtasksworkinprogress:{components:["filters-processversion","filters-dimension"],resource:"bz-rp-workinprogress-tab"},bamtaskloadanalysis:{components:["filters-processversion","filters-dimension"],resource:"bz-rp-loadanalysis-tab"}}},AnalyticsProcess:{defaultReport:"analyticsprocesscycletime",info:{reportSet:3},reports:{analyticsprocesscycletime:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-cycletime-tab"},analyticsprocessdurationhistogram:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-durationhistogram-tab"},analyticsprocessactivity:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-processactivity-tab"},analyticsprocessactivationranking:{components:["filters-dimension","filters-time"],resource:"bz-rp-activationranking-tab"},analyticsprocessfrequentspaths:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-frequentspaths-tab"}}},AnalyticsTask:{defaultReport:"analyticstaskcycletime",info:{reportSet:4},reports:{analyticstaskcycletime:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-cycletime-tab"}}},ResourceBAM:{callBack:"myTeamCallBack",defaultReport:"bamresourcemonitorworkinprogress",info:{reportSet:6},reports:{bamresourcemonitorworkinprogress:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-workinprogress-tab"},bamresourcemonitorworkinprogressuser:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-workinprogressuser-tab"},bamresourcemonitorworkinprogressteam:{components:["filters-processversion","filters-dimension","filters-time"],resource:"bz-rp-workinprogressteam-tab"}}},AnalyticsSensor:{defaultReport:"sensors",reports:{sensors:{components:["filters-dimension","filters-time"]}},info:{reportSet:5}}},$.Class("bizagi.workportal.command.search",{SEARCH_PAGE_SIZE:30,SEARCH_DELAY:700},{init:function(e){this.isTabletDevice=bizagi.util.isTabletDevice(),this.enableOfflineForm=bizagi.util.hasOfflineFormsEnabled(),this.dataService=e},searchList:function(e){(e=e||{}).inputtray=bizagi.util.inputTray(this.dataService.online);var t={radNumber:$.trim(e.query),idWorkflow:"",taskState:"all",onlyFavorites:!1,order:"",numberOfFields:2,orderFieldName:"",orderType:"0",page:e.page||1,pageSize:this.Class.SEARCH_PAGE_SIZE,inputtray:e.inputtray?e.inputtray:"inbox"};return bizagi.util.isQuickSearchEnabled()?this.loadDataListBeta(t):this.loadDataList(t)},loadDataList:function(e){return this.dataService.getCasesByWorkflow(e).done((function(e){e.elements=[];var t=[];0===e.totalPages&&t.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")});for(var r=0,i=e.rows.length;i>r;r++){var a=e.rows[r].fields,s=e.rows[r].radnumber||e.rows[r].id,o={},n=a[a.length-1],l={};if(o.radNumber=s,"string"!=typeof n.Value)for(var c=0,d=n.Value.length;c<d;c++){var u=n.Value[c];if(""!==u&&"string"==typeof u){l.solutionDate=u;break}}else l.solutionDate=n.Value;l.solutionDate=bizagi.util.getTaskStatus(l.solutionDate);for(var p=0;p<a.length;p++)if("Process"===a[p].DisplayName){l.processName=a[p].Value;break}if(l.processName||(l.processName=a[0].Value),void 0!==e.rows[r].workitems)for(var f=e.rows[r].workitems,g=0;f.length>g;g++){o[0]=e.rows[r].id,o[1]=f[g].idWorkItem,o[2]=f[g].idTask,o.state=f[g].State.toLowerCase()||"gray",o[5]=f[g].TaskName||bizagi.localization.getResource("webpart-cases-summary-without-name"),o[6]=[],o[6][0]=[],o[6][0]=[0,e.rows[r].id],o[4]=l.processName,o[3]=l.solutionDate,e.rows[r].isOfflineForm&&(o[7]=e.rows[r].isOfflineForm,o[8]=e.rows[r].isOpen);var m=$.extend(!0,{},o);t.push(m)}else{if(o[0]=e.rows[r].id,o[1]=o[2]=0,o[5]=bizagi.localization.getResource("webpart-cases-summary-without-name"),o.state="gray",o[6]=[],o[6][0]=[],o[6][0]=[0,e.rows[r].id],o[4]=l.processName,o[3]=l.solutionDate,e.rows[r].isOfflineForm){var h=bizagi.getGroupedData(a[3]);o[7]=e.rows[r].isOfflineForm,o[8]=e.rows[r].isOpen,o.state=h.status}t.push(o)}}return e.elements=t,e.elements})).fail((function(e){var t={elements:[],page:1,totalPages:1};return t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t.elements}))},loadDataListBeta:function(e){return this.dataService.getCasesListBeta(e).done((function(e){return 0===e.elements.length&&e.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),e.elements})).fail((function(e){var t={elements:[],page:1,totalPages:1};return t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t.elements}))},getCaseData:function(e){var t=e.dataItem,r={};return t&&void 0===t.noResults&&(-1!==t[1]&&-1!==t[2]?(r.idCase=t[0],r.idWorkitem=bizagi.util.isNumeric(t[1])?t[1]:0,r.idTask=bizagi.util.isNumeric(t[2])?t[2]:0,r.displayName=t[5]||t[6],r.radNumber=t.radNumber,r.isOfflineForm=!0===t[7]||!1,r.formsRenderVersion=!0===t[7]?2:0):(r.idCase=t[0],r.displayName=t[4]||t[0])),r}}),$.Class.extend("bizagi.actionsEvents",{},{init:function(e,t,r){this.initialParams=r||{},this.parent=t||"Entities",this.dataService=e},getEvents:function(e){var t=this,r=$.map(e,(function(e){var r=e.idCase;if(void 0!==r&&r>0)return t.dataService.getEvents({caseId:r}).then((function(t){e.events=t.map((function(e){return e.isEvent=!0,e}))}))}));return $.when.apply($,r)},getActions:function(e){var t=this,r=$.map(e,(function(e){if("Entities"===t.parent||"Cases"===t.parent&&e.surrogateKey>=0){var r={surrogateKey:e.surrogateKey,guidEntity:e.guid};return void 0!==e.idCase&&(r.caseId=e.idCase),t.dataService.getActionsData(r).then((function(r){return e.actions=r,$.when.apply($,$.map(r,(function(e){if("Process"==e.type)return t.dataService.validateHasStartForm({processId:e.reference}).then((function(t){e.hasStartForm=t.startForm,e.entityId=t.entityId,e.entityName=t.entityName}))})))}))}}));return $.when.apply($,r)},getCommomActions:function(e){for(var t,r=e||[],i=[],a=-1;t=r[++a];)i[a]=t.actions||[];return i.shift().reduce((function(e,t){return i.every((function(e){return void 0!==e.find((function(e){return e.id==t.id}))}))&&void 0===e.find((function(e){return e.id==t.id}))&&function(e){if(void 0===e.mode||"Entity"===e.mode)return 2==e.multiplicity||"Form"!=e.type&&("Process"!=e.type||!e.hasStartForm);return!1}(t)&&e.push(t),e}),[])},executeActionSingleData:function(e,t){var r=this;if("WorkOnIt"===e.type){bizagi.loading.start();var i=void 0!==e.idCase?e.idCase:t.idCase;r.executeChangeCaseEvent(i,e.idTask,e.idWorkitem,t)}else if(void 0!==e.isEvent&&e.isEvent)r.processEvent(e);else{var a=e.type,s=2===e.multiplicity;if("Rule"===a){var o={actionType:a,entityId:t.guid,isMultiInstance:s,processId:e.reference,surrogateKey:t.surrogateKey,displayName:e.displayName};r.processAction(o).then((function(e){var t=printf(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-singular"),o.displayName,1);if("success"===e.result){var i=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success");t=t+" "+printf(i,""),$.notifier.add({title:o.displayName,text:t,sticky:!0})}else{t=t+" "+(i=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error")),$.notifier.add({title:o.displayName,text:t,sticky:!0,class_name:"error"})}r.refreshTemplate()}))}else if("Form"===a||"Process"===a){o={actionType:a,displayName:e.displayName,entityGuid:t.guid,entitySurrogateKey:t.surrogateKey,id:e.id,isMultiInstance:s,isBatch:e.isBatch||null,reference:e.reference,readonlyform:e.readonlyform,showConfirmation:e.showConfirmation};"Process"===a&&(o.entityId=e.entityId,o.entityName=e.entityName,o.hasStartForm=e.hasStartForm),void 0!==t.idCase&&(o.caseId=t.idCase),r.processAction(o)}}},executeChangeCaseEvent:function(e,t,r,i){var a=this;$.when(bizagi.webpart.publish("changeCase",{idCase:e,idTask:t,idWorkitem:r})).fail((function(e){a.showErrorMessage(i.idCase,e)})).always((function(){bizagi.loading.stop()}))},executeActionMultipleData:function(e,t,r){var i=this,a=2===e.multiplicity,s=r.map((function(e){return e.surrogateKey}));switch(e.type){case"Process":var o={actionType:e.type,displayName:e.displayName,entityGuid:t.guid,entityId:e.entityId,entityName:e.entityName,id:e.id,isMultiInstance:a,reference:e.reference,hasStartForm:e.hasStartForm};"Cases"===i.parent&&(o.caseId=r.map((function(e){return e.idCase}))),a?(o.isBatch=!1,o.entitySurrogateKey=s,i.processAction(o)):(o.isBatch=!0,i.processBatchCreationAction(o,r));break;case"Rule":o={actionType:e.type,entityId:t.guid,isMultiInstance:a,processId:e.reference,displayName:e.displayName};if(a)o.surrogatedKey=s,i.processAction(o).then((function(e){var t=printf(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-singular"),o.displayName,1),r="";"success"===e.result?(r=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success"),r=printf(r,1)):r=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error"),$.notifier.add({title:r,text:t,sticky:!0}),i.refreshTemplate()}));else{o.confirmation=!1;for(var n,l=-1,c=[];n=r[++l];)o.surrogateKey=n.surrogateKey,c.push(i.processAction(o));$.when.apply($,c).then((function(){var e=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-plural"),t=printf(e,o.displayName,r.length),a=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success");t+=printf(a,""),$.notifier.add({title:o.displayName,text:t,sticky:!0}),i.refreshTemplate()})).fail((function(){var e=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-plural"),t=printf(e,o.displayName,r.length),i=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error");t+=printf(i,""),$.notifier.add({title:o.displayName,text:t,sticky:!0,class_name:"error"})}))}}},processBatchCreationAction:function(e,t){var r,i=this,a=-1;void 0!==(r=t[++a])&&(e.itemSelected=r,function s(){$.when(i.processAction(e)).always((function(){void 0!==(r=t[++a])&&(e.itemSelected=r,s())}))}())},processAddAction:function(e){var t=this,r={actionType:e.type,addAction:!0,displayName:e.displayName,entityGuid:e.guidEntity,entitySurrogateKey:null,reference:e.reference};if("Process"===e.type)r.entityId=e.guidEntity,r.entityName=e.xpathContext,r.hasStartForm=e.startForm,t.processAction(r);else if("Form"===e.type){var i={xpathContext:"",guidEntity:e.guidEntity,accumulatedContext:JSON.stringify(t.initialParams.homePortalFramework.getActionsContext())};$.when(t.dataService.getMapping(i)).then((function(e){r.mapping=e,t.processAction(r)})).fail((function(r){t.showErrorMessage(e.displayName,r)}))}},processAction:function(e){var t=this,r="Entities"===t.parent?"stuffTemplates":"caseTemplates";e.confirmation=void 0===e.confirmation||e.confirmation;var i=new $.Deferred;switch(e.actionType){case"Process":var a={xpathContext:e.entityName,guidEntity:e.entityId},s=void 0!==e.itemSelected?e.itemSelected.surrogateKey:e.entitySurrogateKey;t.initialParams.homePortalFramework.extendCurrentContext({surrogateKeyToMapping:s});var o=t.initialParams.homePortalFramework.getActionsContext();a.accumulatedContext=JSON.stringify(o),$.when(t.dataService.getMapping(a)).done((function(t){var a={guidProcess:e.reference,hasStartForm:e.hasStartForm,isBatch:void 0!==e.isBatch?e.isBatch:null,isMultiInstance:e.isMultiInstance,mapping:t,notification:!0,displayName:e.displayName,type:e.actionType,origin:r};void 0!==e.caseId&&(a.idParentCase=e.caseId),$.when(bizagi.webpart.publish("createNewCase",a)).then((function(){i.resolve(a)})).fail((function(){i.reject()}))})).fail((function(r){t.showErrorMessage(e.displayName,r),i.reject()}));break;case"Form":bizagi.webpart.publish("render-start-form",{params:{displayName:e.displayName,entityGuid:e.entityGuid,entitySurrogateKey:e.entitySurrogateKey,formGuid:e.reference,mapping:void 0!==e.mapping?e.mapping:null,type:e.actionType,origin:r,readonlyform:e.readonlyform,showConfirmation:e.showConfirmation}}),i.resolve();break;case"Rule":e.confirmation?bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-confirmation"),"Bizagi",!0,[{label:"Ok",action:"resolve"},{label:"Cancel",action:"reject"}]).done((function(){t.executeRuleAction(e).then((function(e){i.resolve(e)})).fail((function(e){i.reject(e)}))})):t.executeRuleAction(e).then((function(e){i.resolve(e)})).fail((function(e){i.reject(e)}));break;default:i.resolve()}return i.promise()},showErrorMessage:function(e,t){var r=bizagi.localization.getResource("workportal-widget-sortbar-execute-error-message").replace("%s",e);$.notifier.add({title:"Error",text:r,class_name:"error",sticky:!1})},executeRuleAction:function(e){var t=e.isMultiInstance?this.dataService.executeAction:this.dataService.actionRule;return $.when(t.apply(this.dataService,[e]))},refreshTemplate:function(){var e=this.initialParams.homePortalFramework.accumulatedContext,t={calculateFilters:!0,data:e.length>0?e[e.length-1]:this.accumulatedContext,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:t&&t.data?t.data.displayName:"",params:t,preventNavigate:!0})},processEvent:function(e){bizagi.webpart.publish("executeRoutingAction",{idCase:e.idCase,idWorkItem:e.idWorkitem,idTask:e.idTask,idWorkflow:e.idWorkflow,isEvent:!0})}}),$.Class.extend("bizagi.caseUsers",{},{init:function(e,t,r){this.initialParams=r||{},this.parent=t||"Entities",this.dataService=e,this.userDataPromise={}},getUsers:function(e){var t=this,r=[],i=$.map(e,(function(e){return t.dataService.getUsers({caseId:e.idCase}).done((function(i){e.assignees=$.map(i.assignees,(function(e){return $.extend(e,{initials:t._getInitials(e.name)})})),e.createdBy=$.extend(i.createdBy,{initials:t._getInitials(i.createdBy.name)}),e.users=t._getUniqueUsers($.merge([e.createdBy],e.assignees)),e.workOnIt=t._canWorkOnIt(i.assignees);for(var a,s=-1;a=e.users[++s];){r.find((function(e){return a.idUser==e.idUser}))||r.push(a)}}))}));return $.when.apply($,i).then((function(e){return r}))},_getInitials:function(e){var t=e.split(" ");return(void 0!==t[0]?t[0].charAt(0):"")+(void 0!==t[1]?t[1].charAt(0):"")},_getUniqueUsers:function(e){for(var t,r=-1,i=[];t=e[++r];){i.find((function(e){return t.idUser==e.idUser}))||i.push({idUser:t.idUser,name:t.name,initials:t.initials})}return i.length>0&&(i[0].isAssignee=!0),i},_canWorkOnIt:function(e){for(var t,r=-1,i=!1;t=e[++r];)if(t.idUser===bizagi.currentUser.idUser){i=!0;break}return i}}),bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+"Rest/Handlers/Metadata","render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","render-query-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsersForQueryFormsById/{queryFormId}/","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersList-ForXpathIdBossUser":e.proxyPrefix+"Rest/Users/SearchUsersForBosses","admin-getUsersList-ForXpathIdDelegate":e.proxyPrefix+"Rest/Users/SearchUsersForDelegates","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+"Rest/Handlers/Metadata","render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId",BA_MULTIACTION_WITH_LIMIT_NUMBER:5,BA_MULTIACTION_WITH_LIMIT_QUEUE:"multiaction"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.multiactionServiceWithLimit=new bizagi.render.services.multiactionservice(this,this.Class.BA_MULTIACTION_WITH_LIMIT_NUMBER,this.Class.BA_MULTIACTION_WITH_LIMIT_QUEUE),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},multiactionWithLimit:function(){return this.multiactionServiceWithLimit},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){if(e&&e.data)return e.data;e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idProcess&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]=e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"])}if(e.prepare)return t;bizagi.chrono.initAndStart("data");var r={url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:e.action||"LOAD"};return e.downloadOfflineForm&&(r.avoidLoader=!0),$.ajax(r).pipe((function(r){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{r.form.properties.editable="False";r=function e(r){return null==r?r:(r.hasOwnProperty("type")&&"grid"==r.type?(r.id=t.id+"-print",r.allowAdd="False",r.allowDelete="False",r.allowEdit="False",r.allowGrouping="False",r.allowMore="False",r.allowSearch="False"):$.each(t,(function(t,i){"object"==_typeof(i)&&(r[t]=e(r[t]))})),r)}(r)}catch(e){}return r}))},getSearchFormData:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){data=this.resolveData(e.data||{},e.xpathContext),data=this.processDataValues(data),data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var t=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:t,beforeSend:function(e,t){e.renderingService=!0}})},resolveData:function(e,t){var r,i,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(r in e)-1!==r.search(/\[id=\d+\]/)&&t==r.substr(0,r.search(/\]/)+1)&&(i=r.substr(r.search(/\]/)+2),a=e[r],e[i]=a,delete e[r]);return e},getPropertyData:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},downloadFile:function(e){var t=this,r=t.getUploadFileUrl(e);return $.ajax({url:r,type:"GET",queue:e.queue,dataType:"binary",processData:!1}).then((function(e){if("application/json"==e.type)return t.readFileAsJSON(e);if("string"==typeof e){var r=arguments[2],i=r.getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(t.stringToByteArray(e),i)}return e}))},readFileAsJSON:function(e){var t=new $.Deferred,r=new FileReader;return r.onloadend=function(){t.reject({responseText:r.result})},r.readAsText(e),t.promise()},stringToByteArray:function(e){return bizagi.util.stringToByteArray(e)},getUploadFileEntityUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)},deleteImage:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=e.extra||{};return t.action="getECMMetadata",t.idFileUpload=e.idFileUpload,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,t.xPath=e.xPath,t.idAttrib=e.idAttrib,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},getFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},getAllDocuments:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),r={};return r.contextXpath=e.xpathContext,r.xpathAttribute=e.xpath,r.idCase=e.idCase,r.idWorkItem=e.idWorkItem,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},getUploadFileEntity:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=e.url||this.serviceLocator.getUrl("render-ecm-upload-url")+"File",r=e.extra||{};return r.action="viewECMFile",r.idFileUpload=e.idFileUpload,r.xPath=e.xPath,r.idAttrib=e.idAttrib,r.fileName=e.fileName,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r.xpathContext=e.xpathContext,e.sessionId&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(r.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",r),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var r=this.processDataValues(e.submitData||{});for(key in r)t[key]=r[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=this.processDataValues(r))t[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},rollbackGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,r=e.extra||{},i=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==i&&(i+=" "+e.order),r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=i,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=this.processDataCriteria(e.criteria),r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",r),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-advanced-url"),data:r,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,t.associatedUser=e.associatedUser,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.url||this.serviceLocator.getUrl("render-letter-notEditable-url");return this.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(t)},getLetterContent:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"html"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},getCanGenerateLetter:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.content||"",i=(e.url||this.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(t);return bizagi.debug("Save request for letter sent to: "+i,r),e.prepare?t:$.ajax({url:i,data:r,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrint:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=this.processDataValues(r))t[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){return e=e||{},this.userfieldRequests[e.userfield]?this.userfieldRequests[e.userfield]:(this.userfieldRequests[e.userfield]=$.read(this.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),this.userfieldRequests[e.userfield])},refreshControl:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json"})},executeRule:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeInterface:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeSAPConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executePipeline:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEPIPELINE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidpipeline"]=e.pipeline||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),r={};return r.h_pageCacheId=e.idPageCache,r.contextXpath=e.xpathContext,r.xpathAttribute=e.xpath,r.idCase=e.idCase,r.idWorkItem=e.idWorkItem,r.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},sendEmail:function(e){e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return t;var r=e.url||this.serviceLocator.getUrl("form-get-data");return $.create(r,t)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromQueryForm:function(e){return $.read(this.serviceLocator.getUrl("render-query-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForXpathIdBossUser:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdBossUser"),e)},getUsersListForXpathIdDelegate:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdDelegate"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t={};e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var r=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?r="tablet":bizagi.util.isSmartphoneDevice()&&(r="mobile"),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=r,e.prepare?t:$.create(this.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.pguidConstructor&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],r=function t(r){r=r||{};var i="";return $.each(e,(function(e,a){a[0]==r[6]&&(i+=t(a)+a[1]+" > ")})),i};return function t(i,a){var s,o=function(t){var r=[];return t=t||"",$.each(e,(function(e,i){i[6]==t&&r.push(i)})),r}(a);return $.each(o,(function(e,a){var o=t([],a[0]);(""!==(s={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:o,parents:r(a)}).guidConstructor||s.children.length>0)&&i.push(s)})),i}(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},r=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:r,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isMashupContext()?(t||"").replaceAll(e,""):t}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database,this.gridService=new bizagi.grid.services.service({renderDataService:this,database:e.database}),this.fileService=new bizagi.file.services.service({renderDataService:this,database:e.database}),this.syncService=new bizagi.sync.services.service({renderDataService:this,database:e.database}),this.formService=new bizagi.form.services.service({renderDataService:this,database:e.database})},getFileService:function(){return this.fileService},getSyncService:function(){return this.syncService},getGridService:function(){return this.gridService},getFormService:function(){return this.formService},getFormData:function(e){var t=this;if((e=e||{}).isOfflineForm){if("inactive"==e.workitemstate&&e.online&&!0!==e.alreadyMarkedAsActive&&t._super(e),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData)return t.getFormDataFromNative(e).then((function(r){return t.database.mergeForm(r[1],r[0].data,{online:e.online})}));if("task"===e.offlineType){if(e.isEdited||!e.isOpen){var r=new $.Deferred;return $.when(t.database.getTaskData(e)).then((function(i){var a=e.syncError||i.syncStatus,s=e.hasSyncError||!bizagi.util.isEmpty(a),o=t.database.getTaskForm(e);$.when(t.database.mergeDataDocument(i.data,o)).done((function(i){var a={data:i,isOpen:e.isOpen};t.database.mergeForm(a,o,{online:e.online,hasSyncError:s}).then((function(e){r.resolve(e)}))}))})),r.promise()}return t.database.getTaskForm(e)}return $.when(t.database.getCase(e.idCase)).then((function(r){var i=$.trim(r.idWfClass.toString());return t.database.mergeForm(r,t.database.getFormData(i),{online:e.online})}))}return t._super(e)},getOfflineImage:function(e,t){return"task"===e.offlineType?this.database.getActivityImage(e,t):this.database.getStartDataImage(e,t)},getOfflineActivityDataImage:function(e,t){return this.database.getActivityDataImage(e,t)},saveOfflineImage:function(e,t){return"synchronization"===e.operationType?this.database.saveActivityFormImage(e,t):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataImage(e,t):this.database.saveStartDataImage(e,t):null},saveOfflineFile:function(e,t,r){return"synchronization"===e.operationType?this.database.saveActivityFormFile(e,t,r):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataFile(e,t,r):this.database.saveStartDataFile(e,t,r):null},getOfflineFile:function(e,t,r){return"task"===e.offlineType?this.database.getActivityFile(e,t,r):this.database.getStartDataFile(e,t,r)},getOfflineActivityDataFile:function(e,t,r){return this.database.getActivityDataFile(e,t,r)},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,(function(r){bizagiapp.getCase(e.idCase,(function(e){var i=[JSON.parse(r),JSON.parse(e)];t.resolve(i)}),(function(e){t.reject(e)}))}),(function(e){t.reject(e)})),t.promise()},submitData:function(e){if((e=e||{}).isOfflineForm){var t=this.resolveData(e.data||{},e.xpathContext),r=(e.action||"").toLowerCase();return""==r||"save"!=r&&"next"!=r&&"nextwithoutvalidations"!=r&&"submitdata"!=r||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=r),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?this.saveNativeFormInfo(e,t):"task"===e.offlineType?(this.sanityDataForSaveInDB(t),this.database.saveTaskData(e,t)):this.database.saveStartData(e,t)}return this._super(e)},sanityDataForSaveInDB:function(e){delete e.deferreds},saveNativeFormInfo:function(e,t){var r=this,i=new $.Deferred;return r.getFormDataFromNative(e).then((function(a){return r.database.nativesaveStartData(t,a[1],a[0].data).done((function(t){bizagiapp.saveFormData(e,t),i.resolve(t)}))})),i.promise()},removeStartCaseSyncError:function(e){var t,r=this;return r.database.getCase(e.idCase).then((function(i){return i.isOpen=!0,delete i.syncDetails,delete i.syncStatus,t=i,r.database.saveStartCase(e.idCase,i)})).then((function(){return t}))},removeTaskCaseSyncError:function(e){var t,r=this,i=e.idCase+"-"+e.idWorkitem;return r.database.getTask(i).then((function(e){return e.isOpen=!0,e.isEdited=!0,delete e.syncDetails,delete e.syncStatus,t=e,r.database.saveTask(i,e)})).then((function(){return r.database.getTaskData(e)})).then((function(t){return t&&null!=t.data&&(t.data.h_action="",delete t.data.retry_h_actions,delete t.data.actions),r.database.saveTaskData(e,t.data)})).then((function(){return t}))},parseServiceError:function(e){var t,r={};if(null!=e){if(e.responseText)t=e.responseText;else if(1!=e.length||e[0].responseText)if(e.length>0&&e[0]&&e[0].responseText)t=e[0].responseText;else if(3==e.length){for(var i=e[2];null!=i&&i.error;)i=i.error;i.errorType?r=i:(r.type="error",r.errorType=e[1],r.message=e[2])}else try{t=JSON.stringify(e)}catch(e){}else r=e[0];if(null!=t)try{r=JSON.parse(t)}catch(e){r.type="error",r.errorType="parsingError",r.message="Error parsing the server response: "+t}return r}}}),bizagi.file=bizagi.file||{},bizagi.file.services=bizagi.file.services||{},bizagi.file.services.service||$.Class.extend("bizagi.file.services.service",{loaders:{},isLoading:function(e){return this.loaders[e]||!1},setLoading:function(e,t,r,i){var a=this.internalBuildOfflineFileLoadingKey(e,t,r,i);this.loaders[a]=!0},clearLoading:function(e,t,r,i){var a=this.internalBuildOfflineFileLoadingKey(e,t,r,i);this.loaders[a]=!1},internalBuildOfflineFileLoadingKey:function(e,t,r,i){var a="case:"+e;return bizagi.util.isEmpty(t)||(a+="-"+t),a+="::",a+="xpath:",bizagi.util.isEmpty(r)||(a+=r+"."),a+=i}},{EMPTY_IMAGE:"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},isLoading:function(e){return this.Class.isLoading(this.buildOfflineFileLoadingKey(e))},buildOfflineFileLoadingKey:function(e){var t=e.getFormContainer(),r=t.getParams().idCase,i=t.getParams().idWorkitem;return this.Class.internalBuildOfflineFileLoadingKey(r,i,e.properties.xpathContext,e.properties.xpath)},downloadFormImages:function(e,t){var r=this,i=r.database.filterXpathsByTypeMap(e,{image:!0,columnImage:!0,signature:!0}),a=[];return i.forEach((function(i){var s=r.buildOfflineImageId(i.value,i.xpathContext,i.xpath);t.localFiles[s]||a.push(r.downloadImage(t,e.form,i))})),a},downloadImage:function(e,t,r){var i=t.properties.compatibilityVersion>=2;if(i&&bizagi.util.isEmpty(r.value))return $.Deferred().resolve(null).promise();var a={xpath:r.xpath,idRender:r.renderId,xpathContext:r.xpathContext||"",idPageCache:t.pageCacheId,sessionId:t.sessionId,property:i?"fileBinaryContent":"fileFullContent"};return i?this.downloadImageVersion2(e,a,t,r):this.downloadImageVersion1(e,a,t,r)},downloadImageVersion2:function(e,t,r,i){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath),t.queue=e.bulkDownload?"offlineimages":void 0,a.renderDataService.downloadFile(t).then((function(t){return t.name=i.xpath,e.operationType="synchronization",e.id=a.buildOfflineImageId(i.value,i.xpathContext,i.xpath),a.database.saveActivityFormImage(e,t,t.type)})).then((function(){if(!e.bulkDownload)return a.ensureImageIsPersistedLocally(e)})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath)}))},ensureImageIsPersistedLocally:function(e,t){var r=this;if(0==(t=t||3))return console.log("downloadImageVersion2::image not found after 3 retries '"+e.id+"'",e),$.Deferred().resolve().promise();var i={idCase:e.idCase,idWorkitem:e.idWorkitem,id:e.id,offlineType:"task",loadImageFromForm:!1},a=!1;return r.renderDataService.getOfflineImage(i,bizagi.util.db.AttachmentType.Blob).then((function(e){if(null==e)return a=!0,bizagi.util.sleepFor(200)})).then((function(){if(a)return r.ensureImageIsPersistedLocally(e,t-1)}))},downloadImageVersion1:function(e,t,r,i){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath),a.renderDataService.multiaction().getPropertyData(t).then((function(t){if(null!=t){var r={id:i.xpathContext?i.xpathContext+"."+i.xpath:i.xpath,idCase:e.idCase,idWorkitem:e.idWorkitem,operationType:"synchronization"};return a.database.saveActivityFormImage(r,t)}})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath)}))},downloadFormFiles:function(e,t){var r=this,i={},a=[];return r.database.filterXpathsByTypeMap(e,{upload:!0,columnUpload:!0}).forEach((function(s){var o=r.downloadFilesInUploadControl(t,e,s);Array.prototype.push.apply(a,o),"columnUpload"!==s.type&&(i[s.xpath]=r.database.convertUploadOnlineValueInOfflineValue(s.value))})),{data:i,promises:a}},downloadFilesInUploadControl:function(e,t,r){var i=this,a=[];return r.value&&Array.isArray(r.value)&&r.value.forEach((function(s){var o=s[0],n=s[1],l=(r.xpathContext?r.xpathContext+".":"")+r.xpath+"."+o;e.localFiles[l]||a.push(i.downloadSingleFile(e,t,r,o,n,l))})),a},downloadSingleFile:function(e,t,r,i,a,s){var o=this;return o.downloadBinaryFile(e,t,r,i,a).then((function(t){t&&(e.operationType="synchronization",e.id=s,o.renderDataService.saveOfflineFile(e,t,t.type))}))},downloadBinaryFile:function(e,t,r,i,a){var s={xpath:r.xpath,idRender:r.renderId,xpathContext:r.xpathContext||"",idPageCache:t.form.pageCacheId,fileId:i,sessionId:t.form.sessionId,queue:e.bulkDownload?"offlinefiles":void 0};return this.renderDataService.downloadFile(s).then((function(e){return e.name=a,e}))},uploadFormImages:function(e,t){var r=this,i=[];return t.forEach((function(t){var a=t.value;a&&($.extend(e,t),i.push(r.uploadImage(e,a)))})),i},uploadFormGridImages:function(e,t,r){for(var i=Object.keys(t),a=[],s=0;s<i.length;s++)for(var o=t[i[s]],n=Object.keys(o),l=0;l<n.length;l++)if("isNew"!=n[l]){var c=o[n[l]];if(o.isNew){var d=r[i[s]];if(void 0===d)continue;c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(d)}else c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(i[s]);if(!c)continue;c.columnXpath&&(e.xpath=c.xpathContext+"."+c.columnXpath),uploadParams=$.extend({},e,c),a.push(this.uploadImage(uploadParams,c))}return a},uploadImage:function(e,t){var r=this,i=r.buildAddParamsForUpload(e,"savefile"),a=bizagi.util.isEmpty(t.name)?"offlineImage_"+bizagi.util.randomNumber()+".png":t.name,s=e.xpath,o=r.renderDataService.getUploadAddFileUrl(!1),n=new FormData;return $.each(i,(function(e,t){n.append(e,t)})),r.renderDataService.getOfflineImage({idCase:e.idCase,idWorkitem:e.idWorkitem,id:t.offlineId,offlineType:e.offlineType,loadImageFromForm:!1},bizagi.util.db.AttachmentType.Blob).then((function(i){return t.isSignature&&null==i&&(i=bizagi.util.b64toBlob(r.EMPTY_IMAGE,"image/png")),i?(n.append(s,i,a),$.ajax({url:o,type:"POST",contentType:!1,processData:!1,data:n})):(bizagi.util.console.error("UploadImage:: Missing local file",e,t.offlineId),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+t.offlineId}).promise())})).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadImage:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("Image uploaded",t,s,a),t)})).fail((function(e){bizagi.util.console.error("UploadImage:: fail",e)}))},uploadAndDeleteFormFiles:function(e,t,r){var i=this,a=[];return t.forEach((function(t){Array.prototype.push.apply(a,i.uploadAndDeleteFiles(e,t,r))})),a},uploadFormGridFiles:function(e,t,r,i){for(var a=[],s=Object.keys(t),o=0;o<s.length;o++)for(var n=t[s[o]],l=Object.keys(n),c=0;c<l.length;c++)if("isNew"!=l[c]){var d=n[l[c]];if(n.isNew){var u=r[s[o]];if(void 0===u)continue;d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(u)}else d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(s[o]);Array.prototype.push.apply(a,this.uploadAndDeleteFiles(e,d,i))}return a},uploadAndDeleteFiles:function(e,t,r){var i=[],a=this,s=t.value;if(s&&0!=s.length)return s.forEach((function(s){var o=s.status;if("new"===o){var n={fileId:s.id,fileName:s.fileName,fileMimeType:s.mimeType};$.extend(n,e),i.push(a.uploadFile(n,t))}else if("deleted"===o){var l={renderId:t.renderId,xpath:t.xpath,fileId:s.id,idPageCache:e.pageCacheId};t.columnXpath&&(l.xpath=t.columnXpath,l.xpathContext=t.xpathContext);var c=a.deleteFile(l);r.push(c)}})),i},uploadFile:function(e,t){var r=this,i=t.xpath;if(t.columnXpath){i=t.columnXpath;var a=(t.xpathContext?t.xpathContext+".":"")+i+"."+e.fileId;t.isNew&&t.fullXpath&&(a=t.fullXpath+"."+e.fileId)}else a=i+"."+e.fileId;return r.getOfflineFile(e,a).then((function(s){if(s){var o={xpath:i,renderId:t.renderId,pageCacheId:e.pageCacheId,sessionId:e.sessionId,fileName:e.fileName,xpathContext:t.xpathContext};return r.uploadBinaryFile(o,s)}return bizagi.util.console.error("UploadFile:: Missing local file",e,a),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+a}).promise()}))},uploadBinaryFile:function(e,t){var r=this.buildAddParamsForUpload(e,"addfile"),i=new FormData;return $.each(r,(function(e,t){i.append(e,t)})),i.append(e.xpath,t,e.fileName),this.renderDataService.processUploadFile({url:this.renderDataService.getUploadAddUrl(),formData:i}).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadBinaryFile:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("File uploaded",t,e.xpath,e.fileName),t)}))},getOfflineFile:function(e,t){var r=e.offlineType,i={id:t,idCase:e.idCase};return r&&"start"===r?(i.offlineType=e.offlineType,this.renderDataService.getOfflineFile(i,bizagi.util.db.AttachmentType.Blob,e.fileMimeType)):(i.idWorkitem=e.idWorkitem,this.renderDataService.getOfflineActivityDataFile(i,bizagi.util.db.AttachmentType.Blob,e.fileMimeType))},deleteFile:function(e){var t=e.fileId,r={xpath:e.xpath+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']"),idRender:e.renderId,xpathContext:e.xpathContext||"",idPageCache:e.idPageCache,prepare:!0};return this.renderDataService.deleteUploadFile(r)},buildOfflineImageId:function(e,t,r,i,a){i=i||void 0===i,bizagi.util.isEmptyValue(e)&&(e=null),e=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:e;var s=(t?t+".":"")+r;return!i||bizagi.util.isEmpty(e)||a||(s+="."+e),s},getOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)&&(e=null);var r=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:null;return t&&(r="offlineImage_"+bizagi.util.randomNumber()+".png"),r},changeOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)||bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])&&(e[0][1]=t)},resolveBlobFromPath:function(e,t){var r=new $.Deferred;if(bizagi.util.isCordovaSupported()){e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var i=function(e){bizagi.util.console.error("Error converting path to blob",e),r.reject(e)};window.resolveLocalFileSystemURL(e,(function(e){e.file((function(e){var i=new FileReader;i.onloadend=function(){var i=new Blob([this.result],{type:e.type});i.name=t,r.resolve(i)},i.readAsArrayBuffer(e)}),i)}),i)}else r.resolve(e);return r},buildAddParamsForUpload:function(e,t){var r={};r.h_xpath=e.xpath,r.h_idRender=e.renderId,r.h_xpathContext=e.xpathContext||"",r.h_pageCacheId=e.pageCacheId,r.p_sessionId=e.sessionId,r.h_action=t;try{null!=BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=e.sessionId:r.JSESSIONID=e.sessionId}catch(t){r.JSESSIONID=e.sessionId}return r.queueID="q_"+bizagi.util.encodeXpath(e.xpath),r}}),bizagi.sync=bizagi.sync||{},bizagi.sync.services=bizagi.sync.services||{},bizagi.sync.services.service=bizagi.sync.services.service||{},$.Class.extend("bizagi.sync.services.service",{logKey:"OFFLINE SYNC TRACES::",syncTraces:{},getCurrentSyncStep:function(e){return this.syncTraces[e]?this.syncTraces[e].currentStep:null},setCurrentSyncStep:function(e,t,r){var i=this.syncTraces[e]||{},a=!bizagi.util.isEmpty(i);i.currentStep=t,i.steps=i.steps||[],i.steps.push({step:t,stepParameters:r}),a||(this.syncTraces[e]=i)},addSyncStepResponse:function(e,t,r){var i=this.syncTraces[e];if(bizagi.util.isEmpty(i))console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e);else{null==i.steps&&(i.steps=[]);var a=i.steps.find((function(e){return e.step==t}));bizagi.util.isEmpty(a)&&(console.warn("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: step "+t+" does not exist",t),a={step:"not-found-"+bizagi.util.randomNumber()+"-"+t},i.steps.push(a)),a.stepResponse=r}},addCurrentSyncStepResponse:function(e,t){var r=this.syncTraces[e];bizagi.util.isEmpty(r)?console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e):this.addSyncStepResponse(e,r.currentStep,t)},clearTrace:function(e){this.syncTraces[e]&&delete this.syncTraces[e].steps},printTrace:function(e){var t=this.syncTraces[e],r=this.logKey+"TRACE::"+e+"::";bizagi.util.isEmpty(t)||(bizagi.util.console.log(r+" ** TRACE START **",""),bizagi.util.console.log(r+"LAST STEP:: "+t.currentStep,""),(t.steps||[]).forEach((function(e,t){bizagi.util.console.log(r+(t+1)+"::"+e.step+":: params",e.stepParameters),bizagi.util.console.log(r+(t+1)+"::"+e.step+":: response",e.stepResponse)})),bizagi.util.console.log(r+" ** TRACE END **",""))},printAndClearTrace:function(e){var t=this;setTimeout((function(){t.printTrace(e),t.clearTrace(e)}),1e3)}},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService(),this.gridService=this.renderDataService.getGridService()},syncOfflineStartCase:function(e){var t,r=this,i=e.id||e.idCase,a={action:"LOADSTARTFORM",idProcess:e.idProcess,downloadOfflineForm:!0};return bizagi.util.console.log("SYNCHRONIZING Start Case",e),r.Class.setCurrentSyncStep(i,"getFormData",e),r.renderDataService.getFormData(a).then((function(a){return t=a,r.Class.addCurrentSyncStepResponse(i,a),a.errorType?$.Deferred().reject(a).promise():a.form?(r.Class.setCurrentSyncStep(i,"separateComplexControls",{data:e.data}),r.database.separateComplexControls({offlineType:"start"},e.data)):$.Deferred().reject("Form not found in server response").promise()})).then((function(a){return r.Class.addCurrentSyncStepResponse(i,a),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.formId=t.form.properties.id,e.offlineType="start",r.performSyncOfflineCase(e,a)})).then((function(e){return r.Class.clearTrace(i),e})).fail((function(e){return r.Class.addCurrentSyncStepResponse(i,e),r.Class.printAndClearTrace(i),bizagi.util.console.error("START case sync failed",e),r.updateSyncStatusError(e,"start",i)}))},syncOfflineTaskCase:function(e){var t,r=this,i=e.data;delete e.data;var a=e.idCase+"-"+e.idWorkitem;return e.downloadOfflineForm=!0,bizagi.util.console.log("SYNCHRONIZING Task Case",e),r.Class.setCurrentSyncStep(a,"getFormData",e),r.renderDataService.getFormData(e).then((function(s){return t=s,r.Class.addCurrentSyncStepResponse(a,s),s.errorType?$.Deferred().reject(s).promise():s.form?(r.Class.setCurrentSyncStep(a,"separateComplexControls",{params:e,data:i}),r.database.separateComplexControls(e,i)):$.Deferred().reject("Form not found in server response").promise()})).then((function(i){return r.Class.addCurrentSyncStepResponse(a,i),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.offlineType="task",e.formId=t.form.properties.id,e.id=a,r.performSyncOfflineCase(e,i)})).then((function(e){return r.Class.clearTrace(a),e})).fail((function(e){return r.Class.addCurrentSyncStepResponse(a,e),r.Class.printAndClearTrace(a),r.updateSyncStatusError(e,"task",a)}))},performSyncOfflineCase:function(e,t){var r,i=this,a=[],s=[];return e.gridPromises=null,i.Class.setCurrentSyncStep(e.id,"checkpoint",e),i.createCheckpoint(e).then((function(r){return i.Class.addCurrentSyncStepResponse(e.id,r),i.processGridRecords(e,t,a,s)})).then((function(o){return r=i.parseGridAdditionsResponse(a,o),i.Class.addCurrentSyncStepResponse(e.id,{gridActionsResponse:o,entityMap:r}),i.processUploads(e,t,r,s)})).then((function(a){return i.Class.addSyncStepResponse(e.id,"uploadPromises",a),i.processMultiAction(e,t.data,r,s)})).then((function(t){return i.Class.addSyncStepResponse(e.id,"multiaction",t),t})).fail((function(t){i.Class.addCurrentSyncStepResponse(e.id,t);var r=i.Class.getCurrentSyncStep(e.id);return i.manageError(e,t,r,arguments)}))},processGridRecords:function(e,t,r,i){var a=t.grids;return a&&(e.gridPromises=gridPromises=this.gridService.uploadGridData(a,e.pageCacheId),gridPromises.bizAdditions&&gridPromises.bizAdditions.length>0&&Array.prototype.push.apply(r,gridPromises.bizAdditions),gridPromises.bizDeletions&&gridPromises.bizDeletions.length>0&&Array.prototype.push.apply(i,gridPromises.bizDeletions)),this.Class.setCurrentSyncStep(e.id,"multiaction grid",{gridVallues:a,gridActions:r}),this.renderDataService.multiaction().execute({actions:r})},parseGridAdditionsResponse:function(e,t){var r={};if(void 0!==e&&e.length>0)for(var i=0;i<e.length;i++)t[i]&&"success"===t[i].result.type&&(r[e[i]["offline-entityId"]]=t[i].result.IdEntity);return r},processUploads:function(e,t,r,i){var a=[],s=t.images,o=t.uploads;this.Class.setCurrentSyncStep(e.id,"uploadPromises",{imageValues:s,uploadValues:o});try{o&&o.length>0&&Array.prototype.push.apply(a,this.fileService.uploadAndDeleteFormFiles(e,o,i)),s&&s.length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormImages(e,s));var n=e.gridPromises;n&&(Object.keys(n.bizImages).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridImages(e,n.bizImages,r,i)),Object.keys(n.bizFiles).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridFiles(e,n.bizFiles,r,i)))}catch(e){return $.Deferred().reject(e).promise()}return $.when.apply($,a)},processMultiAction:function(e,t,r,i){var a,s,o,n,l=this,c=e.offlineType,d=l.getSyncAction(c,t),u=null!=d&&d.length>0&&d.toLowerCase().includes("next"),p=(i=l.prepareMultiActionData(e,t,r,d,i),"multiaction");return l.Class.setCurrentSyncStep(e.id,p,i),l.renderDataService.multiaction().execute({actions:i}).then((function(t){return l.Class.addSyncStepResponse(e.id,"multiaction",t),s=t,n=l.wasMultiActionPerformed(t),a=t[t.length-1].result,n?(p="commit-multiaction",l.Class.setCurrentSyncStep(e.id,"commit-multiaction"),l.performCommit(e,u)):$.Deferred().reject(t).promise()})).then((function(t){return o=t,l.Class.addSyncStepResponse(e.id,"commit-multiaction",t),l.deleteOfflineCase(e,n,u)})).then((function(){return n?(null!=o&&null!=o.DataChangesetVersion&&(a.DataChangesetVersion=o.DataChangesetVersion),a.containsNext=$.grep(i,(function(e){return e.h_action.toLowerCase().includes("next")})).length>0,a):$.Deferred().reject(s).promise()})).fail((function(t){l.Class.addCurrentSyncStepResponse(e.id,t);var r="multiaction"==p&&!e.isRetry;return l.performRollback(e,t,r)}))},prepareMultiActionData:function(e,t,r,i,a){var s=this.convertStartFormDataToStandardFormat(t),o=!1;this.replaceGridChangesWithAddedRows(s,r);var n=this.addButtonActions(e,s);null!==n&&n.length>0&&(Array.prototype.push.apply(a,n),o=!0);var l=this.addTrySaveOrTryNextAction(e,i,s,o);return bizagi.util.isEmpty(l)||a.push(l),a},replaceGridChangesWithAddedRows:function(e,t){bizagi.util.isEmpty(e)||Object.keys(e).forEach((function(r){var i=r.match(/\[id=(\d+)\]/);if(i){var a=i[1],s=t[a];if(void 0!==t[a]){var o=r,n=r.replace(a,s);e[n]=e[o],delete e[o]}}}))},addButtonActions:function(e,t){var r=[];if(bizagi.util.isEmpty(t))return[];var i=e.isRetry&&t.retry_h_actions?t.retry_h_actions:t.h_actions;if(delete t.h_actions,delete t.retry_h_actions,!Array.isArray(i)||i.length<1)return[];var a=this.renderDataService.submitData({action:"SUBMITDATA",data:t,idPageCache:e.pageCacheId,prepare:!0});return a.tag="submitData",r.push(a),i.forEach((function(t){t&&(t.h_pageCacheId=e.pageCacheId,r.push(t))})),r},addTrySaveOrTryNextAction:function(e,t,r,i){if(!bizagi.util.isEmpty(t)){actionParams={action:t,idPageCache:e.pageCacheId,prepare:!0,transitions:""},i||(actionParams.data=r);var a=this.renderDataService.submitData(actionParams);return a.tag="performAction",a}return null},deleteOfflineCase:function(e,t,r){var i=this,a=e.offlineType;return"start"===a?(i.Class.setCurrentSyncStep(e.id,"deleteStartCase",{params:e}),i.database.deleteCase(e).then((function(t){return i.Class.addSyncStepResponse(e.id,"deleteStartCase",t),t}))):(i.Class.setCurrentSyncStep(e.id,"removeSyncStatus",{params:!1}),i.database.updateCaseSyncStatus({type:a,id:e.id,syncStatus:void 0,syncDetails:void 0}).then((function(t){return i.Class.addSyncStepResponse(e.id,"removeSyncStatus",t),i.Class.setCurrentSyncStep(e.id,"updateTaskIsEdited",{params:!1}),i.database.updateTaskIsEdited(e.id,!1)})).then((function(t){i.Class.addSyncStepResponse(e.id,"updateTaskIsEdited",t);var a=r?$.extend({deleteAttachments:!0},e):e;return i.Class.setCurrentSyncStep(e.id,"deleteTaskData",{deleteTaskDataParams:a}),i.database.deleteTaskData(a)})).then((function(s){if(i.Class.addSyncStepResponse(e.id,"deleteTaskData",s),"task"===a&&t&&r)return i.Class.setCurrentSyncStep(e.id,"deleteTaskForm",{params:e}),i.database.deleteTaskForm(e);i.Class.setCurrentSyncStep(e.id,"deleteTaskForm","--skipped--")})).then((function(s){return i.Class.addSyncStepResponse(e.id,"deleteTaskForm",s),"task"===a&&t&&r?(i.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext",{params:e}),i.database.deleteTask(e)):(i.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext","--skipped--"),s)})).then((function(t){return i.Class.addSyncStepResponse(e.id,"deleteTaskIfNext",t),t})).fail((function(t){var r={type:"error",errorType:"offlineSyncError",message:"Local case could not be deleted",details:t};return i.Class.addCurrentSyncStepResponse(e.id,r),$.Deferred().reject(r).promise()})))},convertStartFormDataToStandardFormat:function(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r],void 0!==e[r].value&&(t[r]=e[r].value)})),t},getSyncAction:function(e,t){return"start"===e?"createnewcase":"save"===t.h_action?"trysave":"next"===t.h_action?"trynext":t.h_action},wasMultiActionPerformed:function(e){return e.length>0&&e[e.length-1].result&&"success"===e[e.length-1].result.type},createCheckpoint:function(e){return this.renderDataService.sendCheckpoint({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},performCommit:function(e,t){return t?$.Deferred().resolve(null).promise():this.renderDataService.commitGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},manageError:function(e,t,r,i){var a=this;return"checkpoint"!=r?(t=Array.isArray(t)?t.map((function(e){return a.renderDataService.parseServiceError(e)})):a.renderDataService.parseServiceError(i),a.performRollback(e,t)):a.updateSyncStatusError(i,e.offlineType,e.id)},performRollback:function(e,t,r){var i=this;return i.Class.setCurrentSyncStep(e.id,"rollback",{params:e,error:t,cleanTaskDataActions:r}),i.renderDataService.rollbackGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId}).always((function(t){if(i.Class.addCurrentSyncStepResponse(e.id,t),r)return i.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions",{id:e.id}),i.database.cleanTaskDataActions(e.id);i.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions","--skipped--")})).then((function(t){if(i.Class.addSyncStepResponse(e.id,"cleanTaskDataActions",t),"start"!=e.offlineType)return i.Class.setCurrentSyncStep(e.id,"openOfflineTask",{id:e.id}),i.database.openOfflineTask(e.id);i.Class.setCurrentSyncStep(e.id,"openOfflineTask","--skipped--")})).then((function(r){return i.Class.addSyncStepResponse(e.id,"openOfflineTask",r),$.Deferred().reject(t).promise()}))},updateSyncStatusError:function(e,t,r){var i=this.renderDataService.parseServiceError(e)||{},a=this.buildSyncErrorObject(i);return this.database.updateCaseSyncStatus({type:t,id:r,syncStatus:"failed",syncDetails:a}).then((function(){return $.Deferred().reject(i).promise()}))},buildSyncErrorObject:function(e){var t="technical",r=[],i=e;if(Array.isArray(e))e.forEach((function(e){null!=e.result&&((e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&r.push(e.result.message),Array.isArray(e.result.messages)&&(r=r.concat(e.result.messages))))}));else if(null!=e&&null!=e.result){(e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&r.push(e.result.message),Array.isArray(e.result.messages)&&(r=r.concat(e.result.messages)))}else e.message&&r.push(e.message);return{type:t,message:1==r.length?r[0]:r,actionResponse:i,timestamp:Date.now()}}}),bizagi.grid=bizagi.grid||{},bizagi.grid.services=bizagi.grid.services||{},bizagi.grid.services.service=bizagi.grid.services.service||{},$.Class.extend("bizagi.grid.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},uploadGridData:function(e,t){var r=this,i={bizAdditions:[],bizDeletions:[],bizImages:{},bizFiles:{}};return e.forEach((function(e){Array.prototype.push.apply(i.bizAdditions,r.processNewRecords(e,t)),Array.prototype.push.apply(i.bizDeletions,r.processDeletedRecords(e,t)),$.extend(i.bizImages,r.processImages(e)),$.extend(i.bizFiles,r.processFiles(e))})),i},processNewRecords:function(e,t){var r=[],i=e.value["new-records"];if(i)for(var a=Object.keys(i),s=0;s<a.length;s++){var o=i[a[s]];o.idPageCache=t;var n=this.renderDataService.addGridRecordData(o);n["offline-entityId"]=a[s],r.push({actionParams:n,creationTimestamp:o.creationTimestamp})}return r.sort((function(e,t){return e.creationTimestamp-t.creationTimestamp})).map((function(e){return e.actionParams}))},processImages:function(e){var t={};if(e.value["edited-images"])for(var r=Object.keys(e.value["edited-images"]),i=0;i<r.length;i++){var a=e.value["edited-images"][r[i]];t[r[i]]=a}return t},processFiles:function(e){var t={},r=e.value["offline-files"];if(r)for(var i=Object.keys(r),a=0;a<i.length;a++){var s=r[i[a]];t[i[a]]=s}return t},processDeletedRecords:function(e,t){var r=[],i=e.value["deleted-records"];if(i)for(var a=Object.keys(i),s=0;s<a.length;s++){var o=i[a[s]];o.idPageCache=t,r.push(this.renderDataService.deleteGridRecord(o))}return r}}),bizagi.form=bizagi.form||{},bizagi.form.services=bizagi.form.services||{},bizagi.form.services.service=bizagi.form.services.service||{},$.Class.extend("bizagi.form.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService()},getServerTaskForm:function(e){var t,r,i,a=this;return e.downloadOfflineForm=!0,(e.bulkDownload?a.renderDataService.multiactionWithLimit():a.renderDataService).getFormData(e).then((function(t){return a.executeOfflineEntryPipelineAndReloadForm(t,e)})).then((function(s){return t=s.form,r=!0===s.hasEntryPipeline,i=!0===s.wasPipelineExecuted,a.getFileAttachmentsFromLocalTaskForm(e)})).then((function(r){if(t.errorType)return $.Deferred().reject(t).promise();e.deleteNextButton&&(t=a.database.deleteNextButton(t)),t.dataChangeset=e.dataChangeset,e.localFiles=r;var i=a.fileService.downloadFormFiles(t,e),s=i.promises,o=a.fileService.downloadFormImages(t,e),n=Array.prototype.push.apply(s,o);return e.bulkDownload&&n.length>0?$.when.apply($,n).then((function(){return a.mergeForm(t,i.data)})):a.mergeForm(t,i.data)})).then((function(e){return{form:e,hasEntryPipeline:r,wasPipelineExecuted:i}})).fail((function(){bizagi.util.console.error("Error downloading task form",e)}))},executeOfflineEntryPipeline:function(e){var t=e.form?e.form.properties:{};return this.hasFormEntryPipeline(e)?$.when(this.renderDataService.executePipeline({pipeline:t.loadExecution,idPageCache:e.form.pageCacheId})).then((function(){return{hasEntryPipeline:!0,wasPipelineExecuted:!0}}),(function(){return $.Deferred().resolve({hasEntryPipeline:!0,wasPipelineExecuted:!1}).promise()})):$.Deferred().resolve({hasEntryPipeline:!1,wasPipelineExecuted:!1}).promise()},executeOfflineEntryPipelineAndReloadForm:function(e,t){var r=this;return t.executeOfflineEntryPipeline?r.executeOfflineEntryPipeline(e).then((function(i){return hasEntryPipeline=i.hasEntryPipeline,wasPipelineExecuted=i.wasPipelineExecuted,hasEntryPipeline&&wasPipelineExecuted?r.renderDataService.getFormData(t).then((function(e){return{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,wasPipelineExecuted:!1}},getFileAttachmentsFromLocalTaskForm:function(e){return this.database.getFileAttachmentsFromLocalTaskForm(e).then((function(e){return e}),(function(){return{}}))},mergeForm:function(e,t){var r=this;return r.database.mergeDataDocument(t,e).then((function(i){var a={data:t};return a.data=i,a.isOpen=!0,r.database.mergeForm(a,e,{online:!0})}))},downloadOfflineStartForm:function(e){var t=this;return e.action="LOADSTARTFORM",e.downloadOfflineForm=!0,t.renderDataService.multiactionWithLimit().getFormData(e).then((function(r){return r.errorType?$.Deferred().reject(r).promise():r.form?(r.form.properties.isTaskForm=!1,(void 0===r.form.buttons||Array.isArray(r.form.buttons)&&r.form.buttons.length<2)&&(r.form.buttons=t.addFormDefaultButtons()),r.lastSynchronization=Date.now(),t.database.saveStartForm(e,r)):$.Deferred().reject(r).promise()}))},downloadOfflineTaskForm:function(e){var t,r,i=this;return e.deleteNextButton=!1,i.getServerTaskForm({idCase:e.idCase,idWorkitem:e.idWorkitem,executeOfflineEntryPipeline:!0===e.executeOfflineEntryPipeline,bulkDownload:e.bulkDownload}).then((function(a){var s=a.form;return t=a.hasEntryPipeline,r=a.wasPipelineExecuted,s.form.properties.isTaskForm=!0,(void 0===s.form.buttons||Array.isArray(s.form.buttons)&&0==s.form.buttons.length)&&(s.form.buttons=i.addFormDefaultButtons()),i.database.saveTaskForm(e,s)})).then((function(){if(!e.isSingleSync){var i=$.extend({},e);i.type="download-form-success",$(document).trigger("offline-notify-form-sync-event",i)}return{wasFormDownloaded:!0,hasEntryPipeline:t,wasPipelineExecuted:r}}))},addFormDefaultButtons:function(){return[{button:{properties:{actions:["submitData","refresh"],caption:"render-form-button-save",id:"ec0a5a02-0f81-44a7-8d64-ac090a01d61b"}}},{button:{properties:{actions:["validate","submitData","next","routing"],caption:"render-form-button-next",id:"ba81c7af-0d83-4139-879d-b040f0f81bd7"}}}]},verifyFormEntryPipeline:function(e){var t=this;return t.renderDataService.getFormData(e).then((function(e){return t.hasFormEntryPipeline(e)})).fail((function(e){return bizagi.util.console.error("verifyFormEntryPipeline => getFormData error",e),!1}))},hasFormEntryPipeline:function(e){var t=e.form?e.form.properties:{};return!0===bizagi.util.parseBoolean(t.hasEntryPipeline)&&!bizagi.util.isEmpty(t.loadExecution)}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e,t,r){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.maxNumberOfActions=t||0,this.queue=r||null,this.deferredBatchExecuting=$.Deferred(),this.deferredBatchExecuting.resolve(),this.disabledRequests=!1,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function replicateServiceMethods(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,t){var r=this.service;if(!t||1!=t.length)return e.apply(r,t);if("object"!=_typeof(t[0]))return e.apply(r,t);var i=t[0];if(1==i.prepare)return e.apply(r,t);var a=i.prepare;i.prepare=!0;var s=e.apply(r,t);return void 0===a||null==a?delete i.prepare:i.prepare=a,this.add(s)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,r=new $.Deferred,i=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA","GETFILE"].indexOf(i)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(i,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),s={action:e,deferred:r};t.batch[a]=s;var o=function(){var e=t.circularDependencies.resolve();if(e.error){for(var r in t.batch){var i=e.error.multiactionError;t.batch[r].deferred.reject(i)}t.batch={}}else t.disabledRequests||(t.deferredBatchExecuting=t.fire())};return t.batchTimeout=setTimeout(o,t.batchTimer),0!=t.maxNumberOfActions&&Object.keys(t.batch).length>=t.maxNumberOfActions&&(clearTimeout(t.batchTimeout),o()),r.promise()},fire:function(){var e={},t=[];return $.each(this.batch,(function(r,i){t.push(i.action),e[r]=i})),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done((function(t){$.each(t,(function(t,r){var i=r.tag;r.error?e[i].deferred.reject(r.error,r,r.error.message):e[i].deferred.resolve(r.result),delete e[i]})),$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")}))})).fail((function(t,r,i){var a=void 0!==i?i.message:i||"Operation didn't executed";$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")}))}))},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,r){r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=r.tag||e,delete r.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,queue:this.queue,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){e.renderingService=!0,bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(t.error,"servererror",t)}s.resolve(e)})).fail((function(e){var t=e.responseText||e,r={};try{r=JSON.parse(t)}catch(e){}s.reject(e,"servererror",r)})),s.promise()},disableRequests:function(){this.disabledRequests=!0},validateIfBatchIsExecuting:function(){return this.deferredBatchExecuting}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,i[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=i[t.Class.BA_PAGE_CACHE]),delete i[t.Class.BA_PAGE_CACHE],delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(this,"servererror",t)}s.resolve(e)})).fail((function(e){var t,r=e.responseText||e;try{t=JSON.parse(r)}catch(e){}s.reject(e,"servererror",t)})),s.promise()}}),$.Class("bizagi.workportal.services.db",{},{init:function init(){var self=this,queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.disabledb||self.createDatabases()},_destroy:function(e){this.deleteDatabases(e)},createDatabases:function(){var e=this.globalId.hashCode();this.dbRecentProcesses=new PouchDB("RecentProcesses"+e,{auto_compaction:!0}),this.dbProcessesHierarchy=new PouchDB("ProcessesHierarchy"+e,{auto_compaction:!0}),this.dbStartForms=new PouchDB("StartForms"+e,{auto_compaction:!0}),this.dbStartData=new PouchDB("StartData"+e,{auto_compaction:!0}),this.dbActivities=new PouchDB("Activities"+e,{auto_compaction:!0}),this.dbActivityForms=new PouchDB("ActivityForms"+e,{auto_compaction:!0}),this.dbActivityData=new PouchDB("ActivityData"+e,{auto_compaction:!0}),this.dbProcessColumns=new PouchDB("ProcessColumns"+e,{auto_compaction:!0})},deleteDatabases:function(e){var t=new $.Deferred,r=[this.dbRecentProcesses,this.dbProcessesHierarchy,this.dbStartForms,this.dbStartData,this.dbActivities,this.dbActivityForms,this.dbActivityData,this.dbProcessColumns],i=0;return void 0===e&&(e=function(e,a){e?t.reject(e):++i==r.length&&t.resolve("All db deleted successfully")}),r.forEach((function(t){t.destroy(e)})),t.promise()},restartDatabases:function(){var e=this,t=new $.Deferred;return $.when(e.deleteDatabases()).done((function(){e.createDatabases(),t.resolve()})).fail((function(){e.createDatabases(),t.resolve()})),t.promise()},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()}});var STOREOBJECTNAME="offlineTasks";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{createNewCase:function(e){var t=e.idWfClass,r=(new Date).toISOString(),i={_id:r,idWfClass:t.toString(),idWorkFlow:t.toString(),idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.displayName||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.displayName||"Offline"}]};return this.saveStartCase(r,i).then((function(){return i}))},deleteCase:function(e){var t=this,r=new $.Deferred;return t.dbStartData.get(e.idCase,(function(e,i){e?(bizagi.log("Error, the case do not exist"),r.reject(e)):t.dbStartData.remove(i,(function(t,i){t?(bizagi.log("Error erasing case"),r.reject(e)):r.resolve(i)}))})),r.promise()},deleteTask:function(e){var t=e.idCase+"-"+e.idWorkitem,r=this.dbActivities;return bizagi.util.db.deleteDocument(r,t)},getWorkitems:function(e){var t=new $.Deferred;if(e.fromWorkItemId){var r={workItems:[e.fromWorkItemId]};t.resolve(r)}else this.dbStartData.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve(r)}));return t.promise()},getCategories:function(e){var t=this,r=new $.Deferred;if(e.enableOfflineForm){var i=t.dbProcessesHierarchy;$.when(bizagi.util.db.getDocument(i,t.globalId)).then((function(i){if(t.categories=i.doc,e.idApp||e.idCategory){var s=a(t.categories,e);r.resolve({category:s,totalApps:e.idApp?s.length:0})}else{for(var o=t.categories;1==o.length&&(o[0].categories||o[0].subCategories);)o=a(o,o[0].appId?{idApp:o[0].appId}:{idCategory:o[0].idCategory});r.resolve({category:o,totalApps:o[0]&&o[0].appId?o.length:0})}})).fail((function(){r.resolve({category:[],totalApps:0})}))}else r.resolve({});return r.promise();function a(e,t){for(var r=0,i=e.length;r<i;r++){if(e[r].appId&&e[r].appId==t.idApp)return e[r].categories;if(e[r].idCategory&&e[r].idCategory==t.idCategory)return e[r].subCategories;var s;if(e[r].categories&&(s=a(e[r].categories,t)))return s;if(e[r].subCategories&&(s=a(e[r].subCategories,t)))return s}}},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()},getCase:function(e){var t=this.dbStartData;return bizagi.util.db.getDocument(t,e)},getCustomizedColumnsData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray;return(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),this.dbStartData.allDocs({include_docs:!0},(function(a,s){if(a)bizagi.log("Error loading cases from local data base"),t.reject("Error loading cases from local database");else{for(var o=0,n=s.total_rows;o<n;o++)if(i===s.rows[o].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===s.rows[o].value.radNumber)){var l={id:s.rows[o].id,idWFClass:s.rows[o].idWFClass,idWorkFlow:s.rows[o].id,taskState:"",isFavorite:s.rows[o].value.isFavorite,guidFavorite:"",isOpen:s.rows[o].value.isOpen,isOfflineForm:!0,syncStatus:s.rows[o].syncStatus,fields:[{Value:s.rows[o].value.process,DisplayName:s.rows[o].value.process,DataType:"VarChar",isRadNumber:!1},{Value:s.rows[o].value.creationDate,DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]};r.cases.rows.push(l),r.cases.lstIdCases.push(s.rows[o].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getAllProcesses:function(e){var t=new $.Deferred,r={workflows:{taskstate:"",workflow:[]}},i={map:function(e){e.idWfClass&&e.isOpen&&emit({idWfClass:e.idWfClass,process:e.process,category:e.categoryName},1)},reduce:"_count"},a=bizagi.util.db.executeQuery(this.dbActivities,i,{include_docs:!1,group:!0});return $.when(a).then((function(e){var i=e.rows;null!=i&&i.length>0&&i.forEach((function(e){var t=e.value;r.workflows.workflow.push({idworkflow:e.key.idWfClass,name:e.key.process,count:t,isFavorite:!1,category:e.key.category})})),t.resolve(JSON.stringify(r))})).fail((function(e){t.reject(e)})),t.promise()},getOutboxCases:function(){return this.dbStartData.allDocs({include_docs:!0,attachments:!0}).toJqueryPromise().then((function(e){return e.rows=$.grep(e.rows,(function(e){return!e.doc.isOpen})),e.rows=$.map(e.rows,(function(e){return{id:e.id,key:e.doc.isOpen,value:e.doc}})),e})).fail((function(e){return bizagi.log("Error loading data before syncronization"),e}))},getOutboxTaskCases:function(){var e=new $.Deferred;return this.dbActivityData.allDocs({include_docs:!0},(function(t,r){t?e.reject(t):e.resolve(r)})),e.promise()},getOutboxTaskCasesFilteredBySyncStatus:function(e,t){var r=new $.Deferred,i={map:function(t,r){if(null!=t.data&&!bizagi.util.isEmpty(t.data.h_action)){var i=t.syncStatus;("any"===e&&null!=i||"none"===e&&null==i)&&(i=e),r(i)}}},a={key:e=e||"none",include_docs:1==t};return this.dbActivityData.query(i,a,(function(e,t){e?r.reject(e):r.resolve(t.rows)})),r.promise()},existantCase:function(e,t){e.idWfClass;var r=e.idCase+"-"+e.idWorkitem;return offlineCase={_id:r,idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.process||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.process||"Offline"}]}},getCasesList:function(e){var t=new $.Deferred,r={page:1,totalPages:1,elements:[]},i="drafts"===e.inputtray,a={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(a,{reduce:!1,key:i},(function(i,a){if(i)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,o=a.rows.length;s<o;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||-1!=a.rows[s].value.radNumber.toString().indexOf(e.radNumber.toString())){var n=[a.rows[s].value.idCase,a.rows[s].value.workItems[0].idWorkItem[0]||"",a.rows[s].value.workItems[0].idTask[0]||"",a.rows[s].value.creationDate,a.rows[s].value.categoryName,a.rows[s].value.displayName,[["Case No",a.rows[s].value.idCase],["Process",a.rows[s].value.process],["Process creation date",bizagi.util.formatDateTime(a.rows[s].value.creationDate)]],a.rows[s].value.isOfflineForm,a.rows[s].value.isOpen];n.offlineType="start",n.syncStatus=a.rows[s].value.syncStatus,n.taskstate=a.rows[s].value.workItems[0].State.toLowerCase()||"",bizagi.util.isEmpty(n.syncStatus)||(n.hasSyncError=!0,n.syncError=a.rows[s].value.syncDetails),r.elements.push(n)}t.resolve(r)}})),t.promise()},getCustomizedColumnsNewData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray,a={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(a,{reduce:!1,key:i},(function(i,a){if(i)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,o=a.rows.length;s<o;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===a.rows[s].value.radNumber){var n={id:a.rows[s].value.idCase,idWFClass:a.rows[s].value.idWfClass,idWorkFlow:a.rows[s].value.idWorkFlow,taskState:"",isFavorite:a.rows[s].value.isFavorite,guidFavorite:"",isOpen:a.rows[s].value.isOpen,isAborted:!1,isOfflineForm:!0,fields:[a.rows[s].value.idCase,a.rows[s].value.process,{workitems:a.rows[s].value.workItems},bizagi.util.formatDateTime(a.rows[s].value.creationDate),"",bizagi.util.formatDateTime(a.rows[s].value.creationDate)]};r.cases.rows.push(n),r.cases.lstIdCases.push(a.rows[s].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getRecentProcesses:function(e){var t=new $.Deferred,r=this.dbRecentProcesses;return $.when(bizagi.util.db.getDocument(r,this.globalId)).then((function(e){t.resolve(e)})).fail((function(e){t.resolve({processes:[]})})),t.promise()},saveOfflineTasks:function(e){var t=new bizagiQueue;for(i in e){var r=e[i],a=r[10],s=r[0]+"-"+r[1],o={_id:s,endDate:r.endDate,group:r.group,icon:r.icon,state:r.state,taskState:r.taskState,shortEndDate:r.shortEndDate,atRiskTime:r[11],type:r.type,idWfClass:a.toString(),idWorkFlow:a.toString(),idCase:r[0],isFavorite:r[9],isEdited:!1,createdBy:{Name:void 0!==r.creatorFullName?r.creatorFullName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:void 0!==r.creatorFullName?r.creatorFullName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:r[12],process:r[4],categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r.systemColumns&&r.systemColumns.radnumber?r.systemColumns.radnumber:r[0],wfClassDisplayName:"",isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:r[1],idTask:r[2],idCase:r[0],colorState:r.taskstate,State:r.taskstate,TaskName:r[5]}],systemColumns:r.systemColumns};t.add(this.saveOrUpdateTask(s,o))}return t.execute()},saveStartCase:function(e,t){return bizagi.util.db.saveDocument(this.dbStartData,t)},saveTask:function(e,t){return bizagi.util.db.saveDocument(this.dbActivities,t)},saveOrUpdateTask:function(e,t){var r=new $.Deferred,i=this;return $.when(bizagi.util.db.getDocument(i.dbActivities,e)).then((function(e){return $.extend(!0,e,t),bizagi.util.db.saveDocument(i.dbActivities,e)})).then((function(){r.resolve()})).fail((function(e){$.when(bizagi.util.db.saveDocument(i.dbActivities,t)).then((function(){r.resolve()})).fail((function(e){r.reject(e)}))})),r.promise()},cleanTaskDataActions:function(e){var t=new $.Deferred,r=this;return $.when(bizagi.util.db.getDocument(r.dbActivityData,e)).then((function(e){return null!=e&&null!=e.data&&null!=e.data.h_actions&&(e.data.retry_h_actions=e.data.h_actions,e.data.h_actions=[]),bizagi.util.db.saveDocument(r.dbActivityData,e)})).always((function(){t.resolve()})),t.promise()},getTask:function(e){return bizagi.util.db.getDocument(this.dbActivities,e)},saveProcessCustomColumnsHeaders:function(e,t){var r=this.dbProcessColumns,i={_id:e,headers:t};return bizagi.util.db.saveDocument(r,i)},saveSmartInboxCustomColumnsHeaders:function(e,t){var r=this.dbProcessColumns,i={_id:e,headers:t};return bizagi.util.db.saveDocument(r,i)},getProcessCustomColumnsHeaders:function(e){var t=this.dbProcessColumns,r=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,e.toString())).then((function(t){r.resolve({headers:t.headers,type:-1!=e?"process":"system"})})).fail((function(e){$.when(bizagi.util.db.getDocument(t,"-1")).then((function(e){r.resolve({headers:e.headers,type:"system"})})).fail((function(e){r.reject(e)}))})),r.promise()},getSmartInboxCustomColumnsHeaders:function(e){var t=this.dbProcessColumns,r=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,e.toString())).then((function(e){r.resolve({headers:e.headers,type:"smartinbox"})})).fail((function(){$.when(bizagi.util.db.getDocument(t,"-1")).then((function(e){r.resolve({headers:e.headers,type:"system"})})).fail((function(e){r.reject(e)}))})),r.promise()},generateSortedCasesQuery:function(e){var t=e.idWfClass||-1,r=e.smartInboxId,i=e.isOpen,a=e.queryAcrossCustomColums||!1,s=e.customColumnsType||"system",o="doc != undefined",n="doc._id",l={include_docs:!0};t>0?o=f(o,"(doc.idWfClass != undefined && doc.idWfClass == "+t+")","&&"):bizagi.util.isEmpty(r)||(o=f(o,"(doc.smartInboxColumns != undefined && doc.smartInboxColumns['"+r+"'] !== undefined)","&&")),null!=i&&(o=f(o,"doc.isOpen == "+i,"&&"));var c=e.idCase,d=e.radNumber,u="";null!=c&&(u=f(u,"doc.idCase != undefined && doc.idCase == "+c,"&&")),null!=d&&(u=f(u,'doc.radNumber != undefined && doc.radNumber.toString().trim() == "'+(""+d).trim()+'"',"||")),u.trim().length>0&&(o=f(o,"("+u+")","&&"));var p=e.sortData;p&&p.sortFieldName&&(n=null!=r?"doc."+(a?"smartInboxColumns['"+r+"'].":"")+p.sortFieldName:"doc."+(a?s+"Columns.":"")+p.sortFieldName,0==("asc"==p.sortDirection?0:1)&&(l.descending=!0));return{query:new Function("doc","emit","if("+o+"){   emit("+n+");}"),args:l};function f(e,t,r){return 0!=e.trim().length&&(e+=" "+r+" "),e+=" "+t+" "}},getCustomColumnsData:function getCustomColumnsData(params){var db=this.dbActivities,offlineType="task";"drafts"!=params.inputtray&&"outbox-new"!=params.inputtray||(db=this.dbStartData,offlineType="start");var deferred=new $.Deferred;params.idWfClass=params.idWfClass||-1,params.sortData&&(params.queryAcrossCustomColums=!0,params.customColumnsType=params.customColumnsType||"system");var generatedQuery=this.generateSortedCasesQuery(params),queryExecutionPromise=bizagi.util.db.executeQuery(db,generatedQuery.query,generatedQuery.args);return $.when(queryExecutionPromise).then((function(queryResponse){var queryRows=queryResponse.rows;deferred.resolve(queryRows.map((function(row){var item=row.doc,headers=params.headers||[],responseItem={};headers.forEach((function(headerObject){if(headerObject&&headerObject.eval)try{headerObject.eval=headerObject.eval.replaceAll(headerObject.varSymbol,"item"),responseItem[headerObject.fieldName]=eval(headerObject.eval)}catch(e){bizagi.util.console.error("ERROR in getProcessCustomColumnsData",headerObject.eval+" could not be evaluated in ",item)}else if(headerObject&&headerObject.fieldName){var fieldName=headerObject.fieldName.toLowerCase(),objetKeyForFieldName=Object.keys(item).find((function(e){return e.toLowerCase()==fieldName}));objetKeyForFieldName&&(responseItem[headerObject.fieldName]=item[objetKeyForFieldName])}}));var customColumns={};switch(params.customColumnsType){case"system":customColumns=item.systemColumns||{};break;case"process":customColumns=item.processColumns||{};break;case"smartinbox":customColumns=item.smartInboxColumns[params.smartInboxId]||{};break;case"app":customColumns=item.applicationColumns||{};break;default:customColumns={}}return $.extend(responseItem,customColumns),responseItem.isOfflineForm=!0,responseItem.offlineType=offlineType,responseItem.isDraft="start"==offlineType&&responseItem.isOpen,responseItem})))})).fail((function(e){deferred.reject(e)})),deferred.promise()},updateTaskWorkItemCustomColumnsByType:function(e,t,r,i){var a,s=new $.Deferred,o=this;switch(t){case"process":a="processColumns";break;case"smartinbox":a="smartInboxColumns";break;case"application":a="applicationColumns";break;default:return s.reject(t+"is not a valid type for customColumnsType"),s.promise()}return $.when(bizagi.util.db.getDocument(o.dbActivities,e)).then((function(e){return"smartinbox"!=t?e[a]=r:(bizagi.util.isEmpty(e[a])&&(e[a]={}),e[a][i]=r),bizagi.util.db.saveDocument(o.dbActivities,e)})).then((function(){s.resolve(!0)})).fail((function(e){s.resolve(!1)})),s.promise()},cleanOfflineTasks:function(){var e=this,t=new $.Deferred;return e.dbActivities.get(STOREOBJECTNAME,(function(r,i){r?(bizagi.log("Error, no offline tasks"),t.reject(r)):e.dbStartData.remove(i,(function(e,i){e?(bizagi.log("Error erasing tasks"),t.reject(r)):t.resolve(i)}))})),t.promise()},getOfflineCases:function(e){var t=new $.Deferred;e.sortData&&(e.queryAcrossCustomColums=!0,e.customColumnsType="system");var r=this.generateSortedCasesQuery(e),i=bizagi.util.db.executeQuery(this.dbActivities,r.query,r.args);return $.when(i).then((function(e){var r={page:1,totalPages:1,elements:[]},i=e.rows;(null!=i?i.length:0)>0&&i.forEach((function(e){var t=[e.doc.idCase,e.doc.workItems[0].idWorkItem||"",e.doc.workItems[0].idTask||"",e.doc.creationDate,e.doc.process,e.doc.workItems[0].TaskName,[["Case No",e.doc.idCase],["Process",e.doc.process],["Process creation date",bizagi.util.formatDateTime(e.doc.creationDate)]],e.doc.isOfflineForm,e.doc.isOpen,e.doc.isFavorite,e.doc.idWfClass,e.doc.atRiskTime,e.doc.creationDate];t.isEdited=e.doc.isEdited,t.offlineType="task",t.endDate=e.doc.endDate,t.group=e.doc.group,t.icon=e.doc.icon,t.shortEndDate=e.doc.shortEndDate,t.state=e.doc.state,t.taskState=e.doc.taskState,t.type=e.doc.type,t.wfClassDisplayName=e.doc.wfClassDisplayName,t.syncStatus=e.doc.syncStatus,t.radNumber=e.doc.radNumber,e.doc.systemColumns&&(t.systemColumns=e.doc.systemColumns),e.doc.processColumns&&(t.processColumns=e.doc.processColumns),bizagi.util.isEmpty(e.doc.syncStatus)||(t.hasSyncError=!0,t.syncError=e.doc.syncDetails),r.elements.push(t)})),t.resolve(r)})).fail((function(e){t.reject(e)})),t.promise()},getLocalActivities:function(){var e=new $.Deferred;return this.dbActivities.allDocs({include_docs:!0},(function(t,r){if(t)e.reject();else{for(var i=r.total_rows,a={},s=0;s<i;s++){var o=r.rows[s].doc;a[o._id]=o}e.resolve(a)}})),e.promise()},updateCaseSyncStatus:function(e){var t=this,r=e.id;return"start"===e.type?i(t.dbStartData,r):i(t.dbActivityData,r).then((function(){return i(t.dbActivities,r)}));function i(t,r){return $.when(bizagi.util.db.getDocument(t,r)).then((function(r){return r.syncStatus=e.syncStatus,r.syncDetails=e.syncDetails,$.when(bizagi.util.db.saveDocument(t,r))})).then((function(e){return e}))}},validateLocalDataForTaskExists:function(e){var t=new $.Deferred;return $.when(bizagi.util.db.getDocument(this.dbActivityData,e)).then((function(e){t.resolve(null!=e.data)})).fail((function(e){t.resolve(!1)})),t.promise()},openOfflineTask:function(e){return this.saveOrUpdateTask(e,{isOpen:!0,isEdited:!0})},closeOfflineTask:function(e){var t=e.idCase+"-"+e.idWorkitem;return this.saveOrUpdateTask(t,{isOpen:!1,isEdited:!0})},updateTaskDatachangeset:function(e,t){var r={dataChangeset:t};return this.saveOrUpdateTask(e,r)},updateTaskIsEdited:function(e,t){var r={isEdited:t};return this.saveOrUpdateTask(e,r)},saveAvailableSmartInboxes:function(e){var t={_id:this.globalId+"-smartinboxes",doc:e};return bizagi.util.db.saveDocument(this.dbProcessesHierarchy,t).fail((function(e){return $.Deferred.fail("Could not save available smartinboxes:"+e).promise()}))},saveAvailableOfflineSmartInboxes:function(e){var t={_id:this.globalId+"-smartinboxes-offline",doc:e};return bizagi.util.db.saveDocument(this.dbProcessesHierarchy,t).fail((function(e){return $.Deferred.fail("Could not save available offline smartinboxes:"+e).promise()}))},markSmartInboxAsAvailableOffline:function(e){var t=this;t.getAvailableOfflineSmartInboxes().then((function(r){-1==r.indexOf(e)&&(r.push(e),t.saveAvailableOfflineSmartInboxes(r))}))},getAvailableSmartInboxes:function(){var e=this.globalId+"-smartinboxes";return bizagi.util.db.getDocument(this.dbProcessesHierarchy,e).then((function(e){return e.doc}),(function(){return $.Deferred().resolve([]).promise()}))},getAvailableOfflineSmartInboxes:function(){var e=this.globalId+"-smartinboxes-offline";return bizagi.util.db.getDocument(this.dbProcessesHierarchy,e).then((function(e){return e.doc}),(function(){return $.Deferred().resolve([]).promise()}))}}),bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{getTaskSyncError:function(e){var t=e.idCase+"-"+e.idWorkitem;return this.getTask(t).then((function(e){return bizagi.util.isEmpty(e)||bizagi.util.isEmpty(e.syncDetails)?$.Deferred().resolve(void 0).promise():$.Deferred().resolve(e.syncDetails).promise()}),(function(){return $.Deferred().resolve(void 0).promise()})).then((function(t){return e.deferred&&e.deferred.resolve(t),t}))},getInboxSyncErrors:function(){return this.dbActivities.allDocs({include_docs:!0}).toJqueryPromise().then((function(e){var t={};return $.grep(e.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)})).forEach((function(e){var r=e.doc;t[e.id]=r.syncDetails})),t})).fail((function(e){return bizagi.util.console.error("Error getting inbox sync errors",e),e}))},getSyncErrorsList:function(){var e=[],t=this;return t.dbStartData.allDocs({include_docs:!0,attachments:!1}).toJqueryPromise().then((function(r){var i=$.grep(r.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)}));return e=e.concat(i.map((function(e){return(e=e.doc).offlineType="start",t.serializeError(e)}))),t.dbActivities.allDocs({include_docs:!0,attachments:!1}).toJqueryPromise()})).then((function(r){var i=$.grep(r.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)}));return e=e.concat(i.map((function(e){return(e=e.doc).offlineType="task",t.serializeError(e)})))})).fail((function(e){return bizagi.log("Error loading data before syncronization"),e}))},serializeError:function(e){return{radnumber:e.radNumber,idcase:e.idCase,idworkitem:e.workItems[0].idWorkItem,errortype:e.syncDetails.type,synctimestamp:e.syncDetails.timestamp,activity:"task"===e.offlineType?e.workItems[0].TaskName:void 0,activityduedate:"task"===e.offlineType?e.endDate:void 0,process:e.process,offlinetype:"task"===e.offlineType?"task":"start",isdraft:!("task"===e.offlineType),syncerror:e.syncDetails,state:"task"===e.offlineType?e.state:void 0}}}),bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{getFormData:function(e){var t=this,r=new $.Deferred;return setTimeout((function(){t.dbStartForms.get(e,(function(e,t){if(e)r.reject(e);else if(void 0!==t.form)r.resolve({form:t.form,type:"form"});else{var i={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};r.reject(JSON.stringify(i))}}))}),300),r.promise()},mergeForm:function(e,t,r){var i=this,a=new $.Deferred;return $.when(t).done((function(t){if(e.data){var s=function t(a,s){if(Array.isArray(a))for(var o=0,n=a.length;o<n;o++)t(a[o],s);else a.container?t(a.container.elements,s):(e.isOpen||(a.render.properties.editable=!1),a.render.properties.xpath==s.key&&("grid"===a.render.properties.type&&i.setRenderGridValues(a.render),i.setRenderValues(a.render.properties,s.value,r)))};for(prop in e.isOpen||(t.form.buttons=[],0===Object.keys(e.data).length&&s(t.form.elements,{key:"«read-only-form»",value:""})),r.formProperties=t.form.properties,e.data)s(t.form.elements,{key:prop,value:e.data[prop]});a.resolve(t)}else a.resolve(t)})).fail((function(e){if(!e.responseText)var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};e.responseText=JSON.stringify(t),a.reject(e)})),a.promise()},setRenderGridValues:function(e){e.properties.data.columns=[];for(var t=0,r=e.elements.length;t<r;t++)e.properties.data.columns.push(e.elements[t].render.properties.xpath)},setDataType:function(e,t){},setRenderValues:function(e,t,r){var i=e.type;i||(i="label");if(-1===["text","label","number","money","date","boolean","geolocation","hidden","upload"].indexOf(i))if(-1===["combo","cascadingCombo","radio","list"].indexOf(i)){if("search"!==i){if(["image","signature"].includes(i))return e.value=[[0,t.value.name]],void(e.binaryValue=t.value);if("grid"===i){e["offline-files"]=t.value["offline-files"]?t.value["offline-files"]:{},e["deleted-records"]=t.value["deleted-records"]?t.value["deleted-records"]:{},e["edited-images"]=t.value["edited-images"]?t.value["edited-images"]:{};var a=r.formProperties?r.formProperties.isTaskForm:void 0,s=!0===r.hasSyncError;if(!0===a&&!0===r.online&&!s)return;var o=t.value.rows||[];e.data.records=o.length,e.data.total=1,e.data.page=1;var n=e.data.columns.length,l=[],c=o.length;e.data.rows=[];for(var d=0;d<c;d++){var u=o[d][o[d].length-1]&&o[d][o[d].length-1].idRow?o[d][o[d].length-1]:void 0,p=u?u.idRow:bizagi.util.randomNumber(),f=[],g=[];f[0]=p;for(var m=0;m<n;m++){o[d][m]&&(o[d][m].xpath?g[e.data.columns.indexOf(o[d][m].xpath)]=o[d][m]:o[d][m].changes||(g[m]=o[d][m])),g[m]=null!=g[m]?g[m]:null,f[f.length]="true"}var h=$.merge([p],g);e.data.rows.push(h),l[l.length]=f}return e.data.editable=l,void(e.data.visible=l)}try{e.value=t.value}catch(e){}return bizagi.log(i+" not supported in render factory",t,"error"),null}for(var y=0,v=e.data.length;y<v;y++)e.data[y].id==t.value.id&&(e.value=t.value)}else for(var b=0,C=e.data.length;b<C;b++)e.data[b].id==t.value&&(e.value=[{id:t.value,value:e.data[b].value}]);else e.value=t.value},getSummary:function(e){var t=new $.Deferred;if(e.offlineType&&"task"===e.offlineType){var r=e.idCase+"-"+e.idWorkitem;this.dbActivities.get(r,(function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))}))}else this.dbStartData.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))}));return t.promise()},saveActivityFormImage:function(e,t){var r=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,i,r,"image/png",t,!0)},saveActivityDataImage:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem,s=r||"image/png";return bizagi.util.db.saveAttachment(this.dbActivityData,a,i,s,t,!0)},getActivityDataImage:function(e,t){var r=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,i,r,t,"image/png")},getActivityImage:function(e,t){var r=this,i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(r.dbActivityData,a,i,t,"image/png").then((function(e){return void 0!==e&&null!=e?e:bizagi.util.db.getAttachment(r.dbActivityForms,a,i,t,"image/png")}))},saveStartDataImage:function(e,t){var r=e.id,i=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,i,r,"image/png",t,!0)},getStartDataImage:function(e,t){var r=e.id,i=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,i,r,t,"image/png")},saveActivityFormFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,a,i,r,t,!0)},saveActivityDataFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityData,a,i,r,t,!0)},getActivityDataFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,a,i,t,r)},getActivityFile:function(e,t,r){var i=this,a=e.id,s=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(i.dbActivityData,s,a,t,r).then((function(e){return void 0!==e&&null!=e?e:bizagi.util.db.getAttachment(i.dbActivityForms,s,a,t,r)}))},saveStartDataFile:function(e,t,r){var i=e.id,a=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,a,i,r,t,!0)},getStartDataFile:function(e,t,r){var i=e.id,a=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,a,i,t,r)},convertUploadOnlineValueInOfflineValue:function(e){var t=[];return e&&Array.isArray(e)&&e.forEach((function(e){var r=e[1],i=bizagi.util.media.getFileExtension(r).toLowerCase();t.push({id:e[0],fileName:r,mimeType:bizagi.util.media.getMIMETypeByExtension(i),status:"existent"})})),t},saveTaskForm:function(e,t){var r=this.dbActivityForms,i=e.idCase+"-"+e.idWorkitem,a=t&&t.form&&null!=t.form.DataChangesetVersion?t.form.DataChangesetVersion:e.dataChangeset;t._id=i;var s=new $.Deferred,o=void 0;return null!=a&&(e.dataChangeset=a,t.dataChangeset=a,o=this.updateTaskDatachangeset(i,a)),$.when(o).always((function(){$.when(bizagi.util.db.saveDocument(r,t)).then((function(e){s.resolve(e)})).fail((function(e){s.reject(e)}))})),s.promise()},getTaskForm:function(e){var t=this.dbActivityForms,r=e.idCase+"-"+e.idWorkitem,i=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,r)).then((function(e){if(e&&e.form)i.resolve(e);else{var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};i.reject({responseText:JSON.stringify(t)})}})).fail((function(e){var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};i.reject({responseText:JSON.stringify(t)})})),i.promise()},deleteTaskForm:function(e){var t=e.idCase+"-"+e.idWorkitem,r=this.dbActivityForms;return bizagi.util.db.deleteDocument(r,t)},updateTaskForm:function(e,t){this.saveTaskForm(e,t)},getFileAttachmentsFromLocalTaskForm:function(e){var t=new $.Deferred;return this.getTaskForm(e).then((function(e){t.resolve(e._attachments||{})}),(function(){t.resolve({})})),t.promise()},getStartForm:function(e){var t=this.dbStartForms,r=e.idProcess.toString();return bizagi.util.db.getDocument(t,r)},saveStartForm:function(e,t){var r=this.dbStartForms;return t._id=e.idProcess,bizagi.util.db.saveDocument(r,t)},mergeTaskAction:function(e,t){var r=this.mergeObject(e,t,{depth:3});return r=this.reduceLocalGridDeletions(r)},mergeObject:function(e,t,r){var i=this;return"object"!==_typeof(t)||bizagi.util.isArray(t)?e=t:null==t?e:(Object.keys(t).forEach((function(a){"object"!=_typeof(t[a])||bizagi.util.isArray(t[a])?e[a]=t[a]:(e[a]=e[a]||{},void 0===r.depth||r.depth<=0?bizagi.util.extend(e[a],t[a]):i.mergeObject(e[a],t[a],{depth:r.depth-1}))})),e)},reduceLocalGridDeletions:function(e){return Object.keys(e).forEach((function(t){var r=e[t]&&e[t].value?e[t].value:e[t];void 0!==r&&r["deleted-records"]&&r["new-records"]&&Object.keys(r["new-records"]).forEach((function(e){r["deleted-records"][e]&&(delete r["new-records"][e],delete r["deleted-records"][e])}))})),e},saveTaskData:function(e,t){var r=this,i=new $.Deferred,a=e.idCase+"-"+e.idWorkitem,s=r.dbActivityData;return $.when(bizagi.util.db.getDocument(s,a)).then((function(o){if(o.data){var n=o.data.h_actions||[];e.actions&&Object.keys(e.actions).forEach((function(t){var i=e.actions[t];null!=i&&r.canAddActionInList(i,n)&&n.push(i)})),o.data.h_actions=n}else t.h_actions=e.actions;var l=o.data?r.mergeTaskAction(o.data,t):t;r.performSaveTaskData(i,l,a,e,s)})).fail((function(){t.h_actions=e.actions,r.performSaveTaskData(i,t,a,e,s)})),i.promise()},performSaveTaskData:function(e,t,r,i,a){var s=this,o={_id:r,data:t,idForm:i.idForm};$.when(bizagi.util.db.saveDocument(a,o)).then((function(t){var r;r="next"===i.action||"nextWithoutValidations"===i.action?s.closeOfflineTask(i):s.markTaskEdited(i),$.when(r).then((function(t){e.resolve(t)})).fail((function(t){e.reject(t)}))})).fail((function(t){e.reject(t)}))},canAddActionInList:function(e,t){var r=!0;return t.forEach((function(t){t.h_action&&e.h_action&&(t.h_idRender&&e.h_idRender?t.h_action==e.h_action&&t.h_idRender==e.h_idRender&&(r=!1):t.h_action==e.h_action&&(r=!1))})),r},separateComplexControls:function(e,t){var r,i=new $.Deferred;return e.offlineType&&"task"!==e.offlineType?(r=new $.Deferred).resolve(t):r=this.mergeDataDocument(t,this.getTaskForm(e)),$.when(r).done((function(e){var r=[],a=[],s=[];Object.keys(e).forEach((function(i){var o=e[i];o&&o.renderId&&o.type&&["image","signature"].includes(o.type)?(o.xpath=i,r.push(o),delete t[i]):o&&o.renderId&&o.type&&"upload"===o.type?(o.xpath=i,a.push(o),delete t[i]):o&&o.renderId&&o.type&&"grid"===o.type&&(o.xpath=i,s.push(o),delete t[i])})),i.resolve({data:t,images:r,uploads:a,grids:s})})).fail((function(e){i.reject(e)})),i.promise()},markTaskEdited:function(e){var t=new $.Deferred,r=this.dbActivities,i=e.idCase+"-"+e.idWorkitem;return $.when(bizagi.util.db.getDocument(r,i)).then((function(e){e.isEdited=!0,$.when(bizagi.util.db.saveDocument(r,e)).then((function(e){t.resolve(e)})).fail((function(e){t.reject(e)}))})).fail((function(e){t.reject(e)})),t.promise()},getTaskData:function(e){var t=new $.Deferred,r=e.idCase+"-"+e.idWorkitem;return this.dbActivityData.get(r,(function(e,r){e?t.reject(e):t.resolve(r)})),t.promise()},deleteTaskData:function(e){var t=this,r=new $.Deferred,i=e.idCase+"-"+e.idWorkitem,a=!0===e.deleteAttachments;return $.when(bizagi.util.db.getDocument(t.dbActivityData,i)).then((function(e){var s;if(a)s=bizagi.util.db.deleteDocument(t.dbActivityData,i);else{var o={_id:i};s=bizagi.util.db.saveDocument(t.dbActivityData,o)}$.when(s).then((function(e){r.resolve()})).fail((function(e){r.reject(e)}))})).fail((function(e){r.resolve()})),r.promise()},saveStartData:function(e,t){var r=this;return $.when(bizagi.util.db.getDocument(r.dbStartData,e.idCase)).then((function(i){return r.mergeDataDocument(t,bizagi.util.db.getDocument(r.dbStartForms,i.idWfClass.toString())).then((function(a){return i=r.mergeData(t,i,a),e.idForm&&(i.idForm=e.idForm),bizagi.util.db.saveDocument(r.dbStartData,i)}))}))},filterXpathsByType:function(e,t){var r=[];function i(e,r){e.xpath&&e.type===t&&r.push({xpath:e.xpath,renderId:e.id,value:e.value})}return function e(t,r){if(t)for(var a=0;a<t.length;a++){t[a].container?e(t[a].container.elements,r):i(t[a].render.properties,r)}}(e.form.elements,r),r},filterXpathsByTypeMap:function(e,t){var r=this,i=[];function a(e,r){e.xpath&&t[e.type]&&r.push({xpath:e.xpath,renderId:e.id,value:e.value,type:e.type})}return function e(i,s){if(i)for(var o=0;o<i.length;o++){if(i[o].container)e(i[o].container.elements,s);else{var n=i[o].render.properties;if("grid"===n.type){if(n.data&&n.data.records>0){for(var l=[],c=0;c<i[o].render.elements.length;c++){var d=i[o].render.elements[c];d.position=c+1,t[d.render.properties.type]&&l.push(d)}if(l.length>0)for(var u=n.data.rows,p=0;p<u.length;p++){var f=u[p];l.forEach((function(e){s.push({xpath:e.render.properties.xpath,renderId:e.render.properties.id,value:f[e.position],xpathContext:n.xpath+r.buildCellXpathFilter(f[0]),gridXpath:n.xpath,columnXpath:e.render.properties.xpath,idRow:f[0],type:e.render.properties.type})}))}}}else a(n,s)}}}(e.form.elements,i),i},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},mergeDataDocument:function(e,t){var r=new $.Deferred,i={};return $.when(t).done((function(t){for(prop in e)"h_action"!=prop&&"h_actions"!=prop&&(i[prop]={},i[prop].value=e[prop],a(t.form.elements,{key:prop,value:e[prop]}));function a(e,t){if(Array.isArray(e))for(var r=0,s=e.length;r<s;r++)a(e[r],t);else e.container?a(e.container.elements,t):e.render.properties.xpath==t.key&&(i[t.key].DataType=e.render.properties.dataType||"",i[t.key].type=e.render.properties.type||"",i[t.key].renderId=e.render.properties.id)}r.resolve(i)})),r.promise()},mergeData:function(e,t,r){"next"!=e.h_action&&"nextWithoutValidations"!=e.h_action||(t.isOpen=!1),t.data=t.data||{};var i=this.mergeTaskAction(t.data,r);return t.data=i,t},nativeSaveFormInfo:function(e,t,r){var i=this,a=new $.Deferred;return i.mergeDataDocument(e,r).done((function(r){t=i.mergeData(e,t,r),a.resolve(t)})),a.promise()},deleteNextButton:function(e){return e.form&&e.form.buttons&&(e.form.buttons=e.form.buttons.filter((function(e){var t=e.button.properties;return!t||!(t.caption&&"render-form-button-next"===t.caption)}))),e}}),$.Class.extend("bizagi.workportal.services.pullWorker",{},{init:function init(params){var self=this,queryString=bizagi.readQueryString();self.services=params,self.database=params.database;var querydisable=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb);self.disabledb=querydisable,self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain"},pull:function(){var e=this;if(e.disabledb)return!1;var t=e.services.callServiceWithNetworkRetries(e.services,e.services.getOfflineTasks,[],5,2e3);return $.when(t).then((function(){return e.syncOfflineCases()}),(function(e){return bizagi.util.console.log("Error in getOfflineTasks before to push cases",e),$.Deferred().resolve(!0).promise()}))},syncOfflineCases:function(e){var t=this;if(void 0!==t.database&&(t.synchronizing=t.synchronizing||!1,!t.synchronizing)){t.synchronizing=!0,t.pushInProgressPromise=new $.Deferred;var r=new bizagiQueue,i=t.syncOfflineStartCases(r),a=t.syncOfflineTaskCases(r);$.when(i,a).then((function(e,t){if(t&&t.count>0){var i={type:"push-tasks-started",tasks:t.tasks||{}};$(document).trigger("offline-notify-form-sync-event",i)}return r.execute()})).then((function(){setTimeout((function(){t.synchronizing=!1,t.pushInProgressPromise.resolve(!0)}),1e3)})).fail((function(e){setTimeout((function(){console.log("Error pushing cases to server with errors",e),t.synchronizing=!1,$(document).trigger("offline-notify-form-sync-event",{type:"push-tasks-error",message:t.parseSyncError(e)}),t.pushInProgressPromise.reject(e)}),1e3)}))}return t.pushInProgressPromise.promise()},parseSyncError:function(e){return e.message?e.message:e.length&&e.length>0&&e[e.length-1].result&&e[e.length-1].result.messages.length&&e[e.length-1].result.messages.length>0?e[e.length-1].result.messages[0]:"Unknown error"},syncSingleOfflineTaskCase:function(e){var t=this,r=new $.Deferred;return e.isSingleSync=!0,$.when(t.database.getTaskData(e)).then((function(r){var i={idCase:e.idCase,idWorkitem:e.idWorkitem,data:r.data||{},type:"task",id:e.idCase+"-"+e.idWorkitem,syncStatus:"started",isSingleSync:e.isSingleSync,isRetry:!0===e.isRetry};return t.generateSyncCasePromise(i)})).then((function(r){var i=new $.Deferred,a=!1;return r&&!r.containsNext?r&&null!=r.DataChangesetVersion?$.when(t.database.getTaskForm(e)).then((function(e){null!=(e=e.form).DataChangesetVersion&&r.DataChangesetVersion>e.DataChangesetVersion&&(a=!0,r.shouldRefresh=!0)})).fail((function(e){a=!0})).always((function(){i.resolve(a,r)})):(a=!0,i.resolve(a,r)):i.resolve(a,r),i.promise()})).then((function(r,i){return r?$.when(t.services.downloadOfflineTaskForm(e)).then((function(e){return i})):i})).then((function(e){r.resolve(e)})).fail((function(i){if(!0!==e.isRetry)r.reject(i);else{i=t.services.renderDataService.parseServiceError(arguments);var a=t.services.syncService.buildSyncErrorObject(i),s={_internalSyncError:a,message:null!=a&&a.message?a.message:void 0};$.extend(s,i),r.reject(s)}})),r.promise()},syncSingleOfflineStartCase:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getCase(e.idCase)).then((function(r){var i={idCase:r.idCase,data:r.data||{},idProcess:r.idWorkFlow,type:"start",id:r.idCase,syncStatus:"started",isRetry:!0===e.isRetry};return t.generateSyncCasePromise(i)})).then((function(e){r.resolve(e)})).fail((function(e){e=t.services.renderDataService.parseServiceError(arguments);var i=t.services.syncService.buildSyncErrorObject(e),a={_internalSyncError:i,message:null!=i&&i.message?i.message:void 0};$.extend(a,e),r.reject(a)})),r.promise()},syncOfflineStartCases:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getOutboxCases()).done((function(i){for(var a=0;a<i.rows.length;a++){var s=i.rows[a].value;if(!s.syncStatus){var o={idCase:s.idCase,data:s.data||{},idProcess:s.idWorkFlow,type:"start",id:s.idCase,syncStatus:"started"};e.add(t.generateSyncCasePromise(o))}}r.resolve({count:i.rows.length})})).fail((function(e){r.reject(e)})),r.promise()},syncOfflineTaskCases:function(e){var t=new $.Deferred,r=this;return r.database.getOutboxTaskCasesFilteredBySyncStatus("none",!0).done((function(i){for(var a={},s=0;s<i.length;s++){var o=i[s].doc,n=i[s].id,l=n.split("-"),c={idCase:l[0],idWorkitem:l[1],data:o.data||{},type:"task",id:n,syncStatus:"started"};a[n]=!0,e.add(r.generateSyncCasePromise(c))}t.resolve({tasks:a,count:i.length})})).fail((function(e){t.reject(e)})),t.promise()},generateSyncCasePromise:function(e){var t=this;return"start"===e.type||e.data&&(e.data.h_action||e.data.h_actions||e.data.retry_h_actions)?t.database.updateCaseSyncStatus(e).then((function(){return"start"==e.type?t.services.syncOfflineStartCase(e):t.services.syncOfflineTaskCase(e)})):(bizagi.util.console.log("This case will not be synchronized. No actions found",e),$.Deferred().resolve("This case will not be synchronized. No actions found").promise())}}),$.Class.extend("bizagi.workportal.services.fetchWorker",{},{init:function init(params){var self=this;self.services=params,self.db=params.database,self.maxOfflineCases=100,self.secondsBeforeAllowFetchAgain=2,self.tasksSyncDelta=8,self.startSyncDelta=8;var queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.fetchInProgress=!1},triggerOfflineSyncEvent:function(e){bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()?bizagiapp.synchronizeDownloadOfflineState(e):bizagi.webpart.publish("offline.sync",e)},fetch:function(e){var t=this,r=1e3*t.secondsBeforeAllowFetchAgain;function i(){t.triggerOfflineSyncEvent({type:"download-started"}),t.fetchInProgress=!0,t.fetchInProgressPromise=new $.Deferred;var e,r,i=t.services.callServiceWithNetworkRetries(t.services,t.services.getOfflineTasks,[],5,2e3),a=t.services.callServiceWithNetworkRetries(t.services,t.services.getOfflineProcessesHierarchy,[],5,2e3),s=new $.Deferred,o=0;$.when(a,i).then((function(i,a){var n=t.getProcessesListFromHierarchy(i),l=t.serializeActivities(a);o=n.length+Object.keys(l).length,$.when(t.getTasksToDownload(l),t.getStartFormsToDownload(n)).then((function(a,o){r=t.processTasksToFetchForms(l,a.items),e=t.fetchStartForms(i,o),s.resolve(o.length+a.count)})).fail((function(e,t){s.reject({tasks:e,start:t})}))})).fail((function(e,t){console.log("Forms download fails",e,t),s.reject()})),$.when(s).then((function(i){return i>0?t.triggerOfflineSyncEvent({type:"update-total-downloads",argument:i}):o>0&&t.triggerOfflineSyncEvent({type:"up-to-date",argument:o}),$.when.apply($,[e,r])})).then((function(){t.lastFetch=Date.now(),t.fetchInProgressPromise.resolve(!0),t.fetchInProgress=!1,t.triggerOfflineSyncEvent({type:"download-finished"}),$(document).trigger("offline-notify-form-sync-event",{type:"download-finished"})})).fail((function(){$.when(e).always((function(e){$.when(r).always((function(e){t.fetchInProgressPromise.reject("Error executing fetch v2"),t.fetchInProgress=!1,t.triggerOfflineSyncEvent({type:"download-error"}),$(document).trigger("offline-notify-form-sync-event",{type:"download-error"})}))}))})),$.when(t.services.getRecentOfflineProcesses()).then((function(e){t.saveRecentProcesses(e)}))}return t.lastFetch?t.lastFetch+r<Date.now()&&!t.fetchInProgress&&i():t.fetchInProgress||i(),t.fetchInProgressPromise.promise()},fetchStartForms:function(e,t){var r=new $.Deferred,i=this;return $.when(i.saveProcessesHierarchy(e)).then((function(){return i.downloadStartForms(t)})).then((function(){r.resolve()})).fail((function(e){console.log("Sv2: Problem downloading any offline start form",e),r.reject()})),r.promise()},getProcessesListFromHierarchy:function(e){for(var t=[],r=0;r<e.length;r++)for(var i=e[r].categories,a=0;a<i.length;a++)s(i[a]);function s(e){if("true"===e.isProcess&&e.hasOfflineForm)t.push(e.idCategory);else if(e.subCategories)for(var r=0;r<e.subCategories.length;r++){s(e.subCategories[r])}}return t},getStartFormsToDownload:function(e){var t=this,r=new $.Deferred,i=new bizagiQueue,a=[];return e.forEach((function(e){var r=t.checkIfStartFormNeedsSync(e);$.when(r).then((function(t){t&&a.push(e)})),i.add(r)})),$.when(i.execute()).always((function(){r.resolve(a)})),r.promise()},checkIfStartFormNeedsSync:function(e){var t=new $.Deferred,r=this;return $.when(r.services.database.getStartForm({idProcess:e})).then((function(e){var i=!1,a=!1,s=e.lastSynchronization;if(null!=s){var o=Date.now();i=s+60*r.startSyncDelta*60*1e3<o}else i=!0;(new Date).getDate()!=(bizagi.util.getSyncTimeStamp()||new Date).getDate()&&(a=!0),t.resolve(a||i)})).fail((function(){t.resolve(!0)})),t.promise()},downloadStartForms:function(e){for(var t=this,r=new $.Deferred,i=new bizagiQueue,a=0,s=0,o=0;o<e.length;o++){var n=t.services.downloadOfflineStartForm({idProcess:e[o]});$.when(n).then((function(){t.triggerOfflineSyncEvent({type:"form-finished",argument:"success"}),a++,l()})).fail((function(){t.triggerOfflineSyncEvent({type:"form-finished",argument:"error"}),s++,l()})),i.add(n)}function l(){s+a==e.length&&(s>0?r.reject():r.resolve())}return $.when(i.execute()).always((function(){l()})),r.promise()},serializeActivities:function(e){for(var t,r={},i=-1,a=new Date,s=e.advanceSearch?this.services.defineActivityStateByTaskState:this.services.defineActivityStateByDate;t=e.rows[++i];){for(var o,n={},l=["","","","","","",[],"","","","","",""],c={},d=-1;o=e.headers[++d];)n[o.fieldName.toLowerCase()]={displayName:o.displayName.trim(),value:t[d]},this.services.isInboxHeaderASystemColumn(o.fieldName)&&(c[o.fieldName]=t[d]),this.services.serializeActivity(l,o.fieldName.toLowerCase(),n[o.fieldName.toLowerCase()]);var u=l,p={};if(p=s(u[3],u.taskstate),u.length>=10&&parseInt(u[11],10)>0){var f=new Date(u[3]);a.getTime()>f.getTime()?p.state="red":a.getTime()>f.getTime()-6e4*parseInt(u[11],10)?p.state="yellow":p.state="green"}u[7]=!!bizagi.util.isEmpty(n.isoffline)||n.isoffline.value;var g=(u=$.extend({},u,p,{endDate:u[3],idworkitem:u[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?u[10]:u[7],systemColumns:c}))[0]+"-"+u[1];!0===u[7]&&(r[g]=u)}return r},getTasksToDownload:function(e){var t=this,r=new $.Deferred;return $.when(t.services.database.getLocalActivities()).then((function(i){var a={},s=0;if(Object.keys(e).forEach((function(r){var o=e[r],n=i[r];t.taskFormNeedsRefresh(o,n)&&(a[r]={idCase:o[0],idWorkitem:o[1],syncDelda:t.tasksSyncDelta,dataChangeset:o.dataChangeset},s++)})),r.resolve({items:a,count:s}),s>0){var o={type:"fetch-tasks-started",tasks:a};$(document).trigger("offline-notify-form-sync-event",o)}})).fail((function(){r.reject()})),r.promise()},taskFormNeedsRefresh:function(e,t){var r=36e5*this.tasksSyncDelta,i=!1,a=!1,s=!1;return null==t||null==t.dataChangeset||e.dataChangeset!==t.dataChangeset?i=!0:(null==t.lastFullSync||t.lastFullSync+r<Date.now())&&(a=!0),(new Date).getDate()!=(bizagi.util.getSyncTimeStamp()||new Date).getDate()&&(s=!0),i||a||s},processTasksToFetchForms:function(e,t){var r=this,i=new $.Deferred,a=new $.Deferred,s=new bizagiQueue,o=0,n=0,l=0;function c(){n+o==l&&(n>0?(console.log("Download of tasks forms finished with ERRORS"),i.reject()):i.resolve())}return($.when(r.db.getOutboxTaskCasesFilteredBySyncStatus("any",!1)).then((function(r){for(var i=0;i<r.length;i++)delete t[r[i].id],delete e[r[i].id];return!0})).then((function(){var e=new $.Deferred;return r.db.dbActivities.allDocs({include_docs:!1},(function(t,r){t?e.reject():e.resolve(r.rows)})),e.promise()})).then((function(t){for(var i=0;i<t.length;i++){localActivityInternalId=t[i].id,!!e[localActivityInternalId]||s.add(r.deleteLocalDataIfActivityWasNotWorked(localActivityInternalId))}a.resolve()})).fail((function(e){console.log("Diff algorithm error",e),a.resolve()})),$.when(a).then((function(){return r.services.database.saveOfflineTasks(e)})).then((function(e){return r.services.downloadOfflineCustomizedColumns(),Object.keys(t).forEach((function(e){var i=e,a=t[i];l++,$.extend(a,{bulkDownload:!0});var d=r.services.downloadOfflineTaskForm(a);$.when(d).then((function(){return r.updateActivityDatachangesetAndSyncTimestamp(i,a.dataChangeset)})).then((function(){r.triggerOfflineSyncEvent({type:"form-finished",argument:"success"}),o++,c()})).fail((function(){r.triggerOfflineSyncEvent({type:"form-finished",argument:"error"}),n++,c()})),s.add(d)})),s.execute()})).then((function(){c()})).fail((function(e){0==l?(i.reject(e),console.log("Error in tasks download's differential algorithm:",e)):c()})),i.promise())},deleteLocalDataIfActivityWasNotWorked:function(e){var t=this,r=new $.Deferred;return $.when(t.db.validateLocalDataForTaskExists(e)).then((function(i){if(i)r.resolve();else{var a={idCase:e.split("-")[0],idWorkitem:e.split("-")[1],deleteAttachments:!0},s=t.db.deleteTaskData(a),o=t.db.deleteTask(a),n=t.db.deleteTaskForm(a);$.when(o,n,s).then((function(){r.resolve()})).fail((function(e,t,i){if(e&&404==e.status&&(e=void 0),t&&404==t.status&&(e=void 0),i&&404==i.status&&(e=void 0),bizagi.util.isEmpty(e)&&bizagi.util.isEmpty(t)&&bizagi.util.isEmpty(i))r.resolve();else{var a={type:"error",errorType:"offlineDiffAlgorithmError",message:"Problem removing local case and data",technicalNote:"Problem in deleteLocalDataIfActivityWasNotWorked",deleteActivityError:e,deleteFormError:t,deleteFullActivityDataError:i};r.reject(a)}}))}})).fail((function(e){r.reject(e)})),r.promise()},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},saveProcessesHierarchy:function(e){var t=this.db.dbProcessesHierarchy,r={_id:this.globalId,doc:e,lastSynchronization:Date.now()};return bizagi.util.db.saveDocument(t,r)},saveRecentProcesses:function(e){var t=this.db.dbRecentProcesses;return e._id=this.globalId,bizagi.util.db.saveDocument(t,e)},updateActivityDatachangesetAndSyncTimestamp:function(e,t){var r=new $.Deferred,i=this.db.dbActivities;return $.when(bizagi.util.db.getDocument(i,e)).then((function(e){return(null==e.dataChangeset||t>e.dataChangeset)&&(e.dataChangeset=t),e.lastFullSync=Date.now(),bizagi.util.db.saveDocument(i,e)})).then((function(e){r.resolve()})).fail((function(e){r.reject(e)})),r.promise()}}),$.Class("bizagi.workportal.services.db.old",{},{init:function init(){var self=this,queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.disabledb||(self.dbProcessRecent=new PouchDB("DataProcessesRecent"),self.dbProcessHierarchy=new PouchDB("DataProcessesHierarchy"),self.dbForms=new PouchDB("DataRenderForms"),self.dbCases=new PouchDB("DataRenderCases")),self.globalId="undefined"!=typeof BIZAGI_USER?BIZAGI_USER.toLowerCase()+"-"+BIZAGI_PROXY_PREFIX.toLowerCase()+"-"+BIZAGI_DOMAIN.toLowerCase():"admon-http://localhost/bizagiR100x-domain"},_destroy:function(e){void 0===e&&(e=function(e,t){}),PouchDB.destroy("DataRenderForms",e),PouchDB.destroy("DataRenderCases",e),PouchDB.destroy("DataProcessesHierarchy",e),PouchDB.destroy("DataProcessesRecent",e)},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},getAllOpenCases:function(){var e=new $.Deferred;return this.dbCases.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()}}),bizagi.workportal.services.db.old.extend("bizagi.workportal.services.db.old",{},{createNewCase:function(e){var t=e.idWfClass,r=(new Date).toISOString(),i=new $.Deferred,a={_id:r,idWfClass:t.toString(),idWorkFlow:t.toString(),idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.process||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,syncronized:!1,isOpen:!0,workItems:[{idWorkItem:Math.guid(),idTask:Math.guid(),idCase:r,colorState:"Green",State:"Green",TaskName:e.process||"Offline"}]};return this.dbCases.put(a,(function(e,t){e?i.reject(e):i.resolve(a)})),i.promise()},deleteCase:function(e){var t=this,r=new $.Deferred;return t.dbCases.get(e.idCase,(function(e,i){e?(bizagi.log("Error, the case do not exist"),r.reject(e)):t.dbCases.remove(i,(function(t,i){t?(bizagi.log("Error erasing case"),r.reject(e)):r.resolve(i)}))})),r.promise()},getWorkitems:function(e){var t=new $.Deferred;return this.dbCases.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve(r)})),t.promise()},getCategories:function(e){var t=this,r=new $.Deferred;return e.enableOfflineForm||r.resolve({}),t.dbProcessHierarchy.get(t.globalId,(function(a,s){if(a)r.reject("could not extract this document");else if(t.categories=s.doc,e.idApp||e.idCategory){var o=i(t.categories,e);r.resolve({category:o,totalApps:e.idApp?o.length:0})}else{for(var n=t.categories;1==n.length&&(n[0].categories||n[0].subCategories);)n=i(n,n[0].appId?{idApp:n[0].appId}:{idCategory:n[0].idCategory});r.resolve({category:n,totalApps:n[0]&&n[0].appId?n.length:0})}})),r.promise();function i(e,t){for(var r=0,a=e.length;r<a;r++){if(e[r].appId&&e[r].appId==t.idApp)return e[r].categories;if(e[r].idCategory&&e[r].idCategory==t.idCategory)return e[r].subCategories;var s;if(e[r].categories&&(s=i(e[r].categories,t)))return s;if(e[r].subCategories&&(s=i(e[r].subCategories,t)))return s}}},getAllOpenCases:function(){var e=new $.Deferred;return this.dbCases.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()},getCase:function(e){var t=new $.Deferred;return this.dbCases.get(e,(function(e,r){e?t.reject(e):t.resolve(r)})),t.promise()},getCustomizedColumnsData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray;(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase);var a={map:function(e){emit(e.globalId,e)}};return this.dbCases.query(a,{reduce:!1,key:this.globalId},(function(a,s){if(a)bizagi.log("Error loading cases from local data base"),t.reject("Error loading cases from local database");else{for(var o=0,n=s.total_rows;o<n;o++)if(i===s.rows[o].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===s.rows[o].value.radNumber)){var l={id:s.rows[o].id,idWFClass:s.rows[o].idWFClass,idWorkFlow:s.rows[o].id,taskState:"",isFavorite:s.rows[o].value.isFavorite,guidFavorite:"",isOpen:s.rows[o].value.isOpen,isOfflineForm:!0,fields:[{Value:s.rows[o].value.process,DisplayName:s.rows[o].value.process,DataType:"VarChar",isRadNumber:!1},{Value:s.rows[o].value.creationDate,DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]};r.cases.rows.push(l),r.cases.lstIdCases.push(s.rows[o].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getAllProcesses:function(e){var t=this,r=new $.Deferred;void 0===e.inputtray&&(e.inputtray=!0);var i={workflows:{taskstate:"",workflow:[]}},a={map:function(e){e.idWfClass&&e.globalId&&emit({idWf:e.idWfClass,gId:e.globalId,isOpen:e.isOpen.toString()},1)},reduce:"_count"};return t.dbProcessHierarchy.get(t.globalId,(function(s,o){s?r.reject("error"):t.dbCases.query(a,{reduce:!0},(function(a,s){if(a)r.reject("error");else{for(var n=0,l=s.total_rows;n<l;n++)if(s.rows[n].key.gId==t.globalId&&s.rows[n].key.isOpen==e.inputtray.toString()){var c=t.getHierarchyObjects(o,"idCategory",s.rows[n].key.idWf);i.isOpen=e.inputtray,i.workflows.workflow.push({category:"Offline Procesess",name:c[0]?c[0].categoryName:"",idworkflow:s.rows[n].key.idWf,count:s.rows[n].value,isFavorite:!1})}r.resolve(JSON.stringify(i))}}))})),r.promise()},getOutboxCases:function(){var e=new $.Deferred,t={map:function(e){e.isOpen||emit(e.globalId,e)}};return this.dbCases.query(t,{reduce:!1,key:this.globalId},(function(t,r){t?(bizagi.log("Error loading data before syncronization"),e.reject(t)):e.resolve(r)})),e.promise()},getCasesList:function(e){var t=new $.Deferred,r={page:1,totalPages:1,elements:[]},i="true"===e.inputtray,a={map:function(e){emit(e.globalId,e)}};return this.dbCases.query(a,{reduce:!1,key:this.globalId},(function(a,s){if(a)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var o=0,n=s.total_rows;o<n;o++)if(i===s.rows[o].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||-1!=s.rows[o].value.radNumber.toString().indexOf(e.radNumber.toString()))){var l=[s.rows[o].value.idCase,s.rows[o].value.workItems[0].idWorkItem[0]||"",s.rows[o].value.workItems[0].idTask[0]||"",s.rows[o].value.creationDate,s.rows[o].value.categoryName,s.rows[o].value.displayName,[["Case No",s.rows[o].value.idCase],["Process",s.rows[o].value.process],["Process creation date",bizagi.util.formatDateTime(s.rows[o].value.creationDate)]],s.rows[o].value.isOfflineForm,s.rows[o].value.isOpen];r.elements.push(l)}t.resolve(JSON.stringify(r))}})),t.promise()},getCustomizedColumnsNewData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray,a={map:function(e){emit(e.globalId,e)}};return this.dbCases.query(a,{reduce:!1,key:this.globalId},(function(a,s){if(a)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var o=0,n=s.total_rows;o<n;o++)if(i===s.rows[o].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===s.rows[o].value.radNumber)){var l={id:s.rows[o].value.idCase,idWFClass:s.rows[o].value.idWfClass,idWorkFlow:s.rows[o].value.idWorkFlow,taskState:"",isFavorite:s.rows[o].value.isFavorite,guidFavorite:"",isOpen:s.rows[o].value.isOpen,isAborted:!1,isOfflineForm:!0,fields:[s.rows[o].value.idCase,s.rows[o].value.process,{workitems:s.rows[o].value.workItems},bizagi.util.formatDateTime(s.rows[o].value.creationDate),"",bizagi.util.formatDateTime(s.rows[o].value.creationDate)]};r.cases.rows.push(l),r.cases.lstIdCases.push(s.rows[o].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getRecentProcesses:function(e){var t=this,r=new $.Deferred;return t.recentProcesses?r.resolve(t.recentProcesses):t.dbProcessRecent.get(t.globalId,(function(e,i){e?(bizagi.log("Could not extract this document"),r.reject(e)):(t.recentProcesses=i.doc,r.resolve(t.recentProcesses))})),r.promise()}}),bizagi.workportal.services.db.old.extend("bizagi.workportal.services.db.old",{},{getFormData:function(e){var t=new $.Deferred;return this.dbForms.get(e+"-"+e+"-"+this.globalId,(function(e,r){if(e)t.reject(e);else if(void 0!==r.form)setTimeout((function(){t.resolve({form:r.form,type:"form"})}),300);else{var i={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};t.reject(JSON.stringify(i))}})),t.promise()},mergeForm:function(e,t){var r=this,i=new $.Deferred;return $.when(t).done((function(t){if(e.data){var a=function t(i,a){if(i.length&&i.length>0)for(var s=0,o=i.length;s<o;s++)t(i[s],a);else i.container?t(i.container.elements,a):(e.isOpen||(i.render.properties.editable=!1),i.render.properties.xpath==a.key&&("grid"===i.render.properties.type&&r.setRenderGridValues(i.render),r.setRenderValues(i.render.properties,a.value)))};for(prop in e.isOpen||(t.form.buttons=[],0===Object.keys(e.data).length&&a(t.form.elements,{key:"«read-only-form»",value:""})),e.data)a(t.form.elements,{key:prop,value:e.data[prop]});i.resolve(t)}else i.resolve(t)})).fail((function(e){if(!e.responseText)var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};e.responseText=JSON.stringify(t),i.reject(e)})),i.promise()},setRenderGridValues:function(e){e.properties.data.columns=[];for(var t=0,r=e.elements.length;t<r;t++)e.properties.data.columns.push(e.elements[t].render.properties.xpath)},setDataType:function(e,t){},setRenderValues:function(e,t){var r=e.type;r||(r="label");if(-1===["text","label","number","money","date","boolean","geolocation","hidden","upload"].indexOf(r))if(-1===["combo","cascadingCombo","radio","list"].indexOf(r))if("search"!==r){if("image"!==r){if("grid"===r){e.data.records=t.value.length,e.data.total=1,e.data.page=1;for(var i=e.data.columns.length,a=[],s=t.value.length,o=0;o<s;o++){var n=bizagi.util.randomNumber(),l=[],c=[];l[l.length]=n;for(var d=0;d<i;d++){var u=void 0!==t.value[o][d]?e.data.columns.indexOf(t.value[o][d].xpath):-1;-1!=u&&(c[u]=t.value[o][d]),c[d]=void 0===c[d]?{}:c[d],l[l.length]="true"}e.data.rows.push($.merge([n],c)),a[a.length]=l}return e.data.editable=a,void(e.data.visible=a)}try{e.value=t.value}catch(e){}return bizagi.log(r+" not supported in render factory",t,"error"),null}e.value=t}else for(var p=0,f=e.data.length;p<f;p++)e.data[p].id==t.value.id&&(e.value=t.value);else for(var g=0,m=e.data.length;g<m;g++)e.data[g].id==t.value&&(e.value=[{id:t.value,value:e.data[g].value}]);else e.value=t.value},getSummary:function(e){var t=new $.Deferred;return this.dbCases.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))})),t.promise()},saveFormInfo:function(e,t){var r=this,i=new $.Deferred;return r.dbCases.get(e.idCase,(function(e,a){e?i.reject(e):r.mergeDataDocument(t,a,r.getFormData(a.idWfClass.toString())).done((function(e){a=r.mergeData(t,a,e),r.dbCases.put(a,(function(e,t){e?i.reject(e):i.resolve(t)}))}))})),i.promise()},mergeDataDocument:function(e,t,r){var i=new $.Deferred,a={};return $.when(r).done((function(t){for(prop in e)"h_action"!=prop&&(a[prop]={},a[prop].value=e[prop],r(t.form.elements,{key:prop,value:e[prop]}));function r(e,t){if(e.length&&e.length>0)for(var i=0,s=e.length;i<s;i++)r(e[i],t);else if(e.container)r(e.container.elements,t);else if(e.render.properties.xpath==t.key&&(a[t.key].DataType=e.render.properties.dataType||"",a[t.key].type=e.render.properties.type||"",!bizagi.util.isEmpty(a[t.key])))for(var o=a[t.key].value.length,n=0;n<o;n++)if(!bizagi.util.isEmpty(a[t.key].value[n]))if("image"===a[t.key].type){var l=a[t.key].value[n]||"";a[t.key].value=l.replace(/^data:.*;base64,/,"")}else{for(var c=[],d=a[t.key].value[n].length,u=0;u<d;u++)bizagi.util.isEmpty(a[t.key].value[n][u])||c.push(a[t.key].value[n][u]);a[t.key].value[n]=c}}i.resolve(a)})),i.promise()},mergeData:function(e,t,r){for(var i in"next"==e.h_action&&(t.isOpen=!1),t.data=t.data||{},r){var a=!1;for(var s in t.data)i==s&&(bizagi.util.isEmpty(r[i])||bizagi.util.isEmpty(r[i].value)?(delete t.data[s],a=!0):(t.data[s]=r[i],a=!0));a||(t.data[i]=r[i])}return t},nativeSaveFormInfo:function(e,t,r){var i=this,a=new $.Deferred;return i.mergeDataDocument(e,t,r).done((function(r){t=i.mergeData(e,t,r),a.resolve(t)})),a.promise()}}),$.Class.extend("bizagi.workportal.services.pullWorker.old",{},{init:function init(params){var self=this,queryString=bizagi.readQueryString();self.services=params,self.database=params.database;var querydisable=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb);self.disabledb=querydisable,self.disabledb||(self.dbForms=new PouchDB("DataRenderForms"),self.dbCases=new PouchDB("DataRenderCases"),self.dbProcessHierarchy=new PouchDB("DataProcessesHierarchy"),self.dbProcessRecent=new PouchDB("DataProcessesRecent")),self.globalId="undefined"!=typeof BIZAGI_USER?BIZAGI_USER.toLowerCase()+"-"+BIZAGI_PROXY_PREFIX.toLowerCase()+"-"+BIZAGI_DOMAIN.toLowerCase():"admon-http://localhost/bizagiR100x-domain"},pull:function(){return!this.disabledb&&$.when(this.syncOfflineCases()).done((function(){return!0}))},syncOfflineCases:function(e){var t=this;if(void 0!==t.database&&(t.synchronizing=t.synchronizing||!1,!t.synchronizing))return t.synchronizing=!0,t.database.getOutboxCases().done((function(e){for(var r=[],i=0;i<e.total_rows;i++){var a=e.rows[i].value,s=[];for(var o in a.data)"h_action"!=o&&s.push({domain:"undefined"!=typeof BIZAGI_DOMAIN?BIZAGI_DOMAIN:"domain",user:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",xpath:o,value:t.processDataValues(a.data[o].value,a.data[o].type),DataType:a.data[o].DataType,type:a.data[o].type});a=$.extend(a,{objToSend:s}),r.push(t.services.syncOfflineCases(a).pipe((function(e){for(var r=decodeURIComponent(this.data).split("&"),i=r.length-1;i>=0;i--){var a=r[i].split("=");if("idCase"==a[0])return t.database.deleteCase({idCase:a[1]})}}),(function(e){bizagi.log(e)})))}return $.when.apply($,r).pipe((function(){return t.synchronizing=!1,!0}))}))},processDataValues:function(e,t){if("array"==$.type(e)&&"upload"==t){for(var r=0;r<e.length;r++)e[r]=e[r].filter((function(e){return"mimeType"!=e.xpath}));return e}if("object"==$.type(e)&&e.hasOwnProperty("id")&&(e=e.id),"grid"==t)for(var i=0;i<e.length;i++)for(var a=e[i],s=0;s<a.length;s++){var o=a[s];o.value=this.processDataValues(o.value)}return e}}),$.Class.extend("bizagi.workportal.services.fetchWorker.old",{},{init:function init(params){var self=this;self.services=params;var queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.disabledb||(self.dbForms=new PouchDB("DataRenderForms"),self.dbCases=new PouchDB("DataRenderCases"),self.dbProcessHierarchy=new PouchDB("DataProcessesHierarchy"),self.dbProcessRecent=new PouchDB("DataProcessesRecent")),self.globalId="undefined"!=typeof BIZAGI_USER?BIZAGI_USER.toLowerCase()+"-"+BIZAGI_PROXY_PREFIX.toLowerCase()+"-"+BIZAGI_DOMAIN.toLowerCase():"admon-http://localhost/bizagiR100x-domain"},fetch:function(e){var t=this,r=new $.Deferred;return t.disabledb?(r.reject("Disable Sync"),r.promise()):($.when(t.services.processesHierarchy()).done((function(e,i){$.when(t.saveProcessesHierarchy(e),t.processesHierarchyTofetchForms(),t.services.getRecentOfflineProcesses()).done((function(e,i,a){t.saveRecentProcesses(a),r.resolve("All data fetched")})).fail((function(e,t,i){"nothing"===e?r.reject(0):r.reject("Error fetching data")}))})),r.promise())},processesHierarchyTofetchForms:function(){var e=new $.Deferred,t=bizagi.util.getItemLocalStorage("formChangeset"+this.globalId);return null==t&&(t=0),this.callSyncForms({changeSet:t}).done((function(t){console.log(t,"Sync forms"),e.resolve(t)})).fail((function(t){"nothing"===t?console.log("Nothing to sync"):console.log(t,"Error sync forms"),e.reject(t)})),e.promise()},callSyncForms:function(e){var t=this,r=new $.Deferred,i=e.changeSet;return t.services.processesHierarchyTofetchForms(e).done((function(e){if(e.changeSet>i){var a=null;1===e.changeSetType&&(a=t.saveProcessesHierarchyTofetchForms(e.result)),4===e.changeSetType&&(a=t.saveProcessInHierarchy(e.result)),$.when(a).done((function(){t.callSyncForms({changeSet:e.changeSet}).done((function(e){r.resolve(e)})).fail((function(e){r.reject(e)}))})).fail((function(e){r.reject(e)}))}else bizagi.util.setItemLocalStorage("formChangeset"+t.globalId,e.changeSet),i=parseInt(i),0===e.changeSet&&0===i?r.reject("nothing"):r.resolve("succesfully")})).fail((function(e){r.reject(e)})),r.promise()},saveProcessInHierarchy:function(e){var t=new $.Deferred;return t.resolve(""),t.promise()},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},saveProcessesHierarchyTofetchForms:function(e){var t=this,r=new $.Deferred,i={_id:e.wfClass.toString()+"-"+e.wfClass.toString()+"-"+t.globalId,globalid:t.globalId,idWfClass:e.wfClass,idWorkFlow:e.workFlow,form:e.data.form};return t.dbForms.get(i._id,(function(e,a){e?t.dbForms.put(i,(function(e,t){e?r.reject("Could not add the document"):r.resolve(t)})):t.dbForms.put({_rev:a._rev,_id:a._id,form:i.form},(function(e,t){e?r.reject("Could not update the document"):r.resolve(t)}))})),r.promise()},saveProcessesHierarchy:function(e){var t=this,r=new $.Deferred,i={_id:t.globalId,doc:e};return t.dbProcessHierarchy.get(i._id,(function(a,s){a?t.dbProcessHierarchy.put(i,(function(e,t){e?r.reject("Could not add the document"):r.resolve(t)})):t.dbProcessHierarchy.put({_id:s._id,_rev:s._rev,doc:e},(function(e,t){e?r.reject("Could not update the document"):r.resolve(t)}))})),r.promise()},saveRecentProcesses:function(e){var t=this,r=new $.Deferred,i={_id:t.globalId,doc:e};return t.dbProcessRecent.get(i._id,(function(a,s){a?t.dbProcessRecent.put(i,(function(e,t){e?r.reject("Could not add the document"):r.resolve(t)})):t.dbProcessRecent.put({_rev:s._rev,_id:s._id,doc:e},(function(e,t){e?r.reject("Could not update the document"):r.resolve(t)}))})),r.promise()}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{},{init:function(e){this.shouldSynchronize=!(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&"offlineServices"!==e.module),this.isOfflineFormsV2Supported=bizagi.util.isOfflineFormsV2Supported(),this._super(e),e.oldOfflineServicesAlreadyEnabled||(this.database=void 0===bizagi.workportal.services.db||bizagi.util.isMashupContext()?null:new bizagi.workportal.services.db,this.configureOfflineEvents()),this.isOfflineFormsV2Supported&&(e.context="workflow",e.database=this.database,this.multiactionService=new bizagi.render.services.multiactionservice(this),this.renderDataService=void 0!==bizagi.render.services.service?new bizagi.render.services.service(e):bizagi.render.services.service,this.formService=this.renderDataService.getFormService(),this.syncService=this.renderDataService.getSyncService(),this.fetchWorker=new bizagi.workportal.services.fetchWorker(this),this.pullWorker=new bizagi.workportal.services.pullWorker(this),this.shouldSynchronize&&this.configureOfflineHandlers(),this.configurePushCaseHandler()),bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&"offline"===bizagi.getNativeComponent()&&bizagiapp.offlineModuleReady()},multiaction:function(){return this.multiactionService},configureOfflineHandlers:function(){var e=this;$(document).on("fetch-offline-processes",$.proxy(e.fetchOfflineData,e)),$(document).on("get-offline-categories",$.proxy(e.getOfflineCategoriesHandler,e)),$(document).on("get-offline-recent-processes",$.proxy(e.getRecentProcessesHandler,e)),$(document).on("create-startform-case",$.proxy(e.createStartFormHandler,e)),$(document).on("get-offline-cases",$.proxy(e.getOfflineCasesHandler,e)),$(document).on("get-offline-case-workitems",$.proxy(e.getOfflineWorkitemsHandler,e)),$(document).on("delete-offline-case",$.proxy(e.getOfflineWorkitemsHandler,e)),$(document).off("tryPushData.offline"),$(document).on("tryPushData.offline",$.proxy(e.pushOfflineDataHandler,e)),$(document).off("cleanDatabases.offline"),$(document).on("cleanDatabases.offline",$.proxy(e.cleanDatabasesHandler,e)),$(document).off("retry-download-offline-forms"),$(document).on("retry-download-offline-forms",$.proxy(e.fetchOfflineData,e)),$(document).off("routing-get-offline-task-sync-error"),$(document).on("routing-get-offline-task-sync-error",(function(t,r){e.getTaskSyncError(r)})),$(document).on("get-sync-errors-list",$.proxy(e.getSyncErrorsListHandler,e)),$(document).off("get-inbox-sync-errors"),$(document).on("get-inbox-sync-errors",$.proxy(e.getInboxSyncErrorsHandler,e)),$(document).off("retry-sync-single-offline-case"),$(document).on("retry-sync-single-offline-case",(function(t,r){e.retrySyncSingleOfflineCaseNative(r)}))},configurePushCaseHandler:function(){var e=this;$(document).off("tryPushCase.offline"),$(document).on("tryPushCase.offline",(function(t,r){var i=r.deferred||new $.Deferred;e.tryPushOfflineCaseHandler(r).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))})),$(document).off("retrySyncCase.offline"),$(document).on("retrySyncCase.offline",(function(t,r){var i=r.deferred||new $.Deferred;r.isRetry=!0,e.tryPushOfflineCaseHandler(r).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))}))},configureOfflineEvents:function configureOfflineEvents(){var self=this;if(bizagi.isMobileDevice()){if(void 0!==navigator.connection)"undefined"==typeof Connection||navigator.connection.type!=Connection.NONE&&"unknown"!=navigator.connection.type?self.online=!0:self.online=!1;else{var queryString=bizagi.readQueryString(),queryoffline=!queryString||!queryString.online||eval(queryString.online);self.online=queryoffline}$(document).off("online.services"),$(document).on("online.services",$.proxy(self.onlineServicesHandler,self)),$(document).off("offline.services"),$(document).on("offline.services",$.proxy(self.offlineServicesHandler,self)),window.addEventListener("online",(function(){self.online=!0})),window.addEventListener("offline",(function(){self.online=!1}))}},getOfflineCategoriesHandler:function(e,t){var r=this;(t=t||{}).enableOfflineForm=!0,r.getCategories(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineCategories(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline categories")}))},getRecentProcessesHandler:function(){var e=this;e.getRecentProcesses().then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineRecentProcesses(e)})).fail((function(t){e.defaultErrorHandler(t,"error getting recent processes")}))},createStartFormHandler:function(e,t){var r=this;(t=t||{}).categoryName="",t.isOfflineForm=!0,r.createNewCase(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)})).fail((function(e){r.defaultErrorHandler(e,"error creating a new case with start form")}))},getOfflineCasesHandler:function(e,t){var r=this,i={enableOfflineForm:!0};i.inputtray=t,r.getCasesListBeta(i).then((function(e){e.inboxType=t,bizagiapp.setOfflineInboxCases(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline cases")}))},getOfflineWorkitemsHandler:function(e,t){var r=this;(t=t||{}).isOfflineForm=t.isOfflineForm||!0,t.idCase=t.idCase||"",r.getWorkitems(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline workitems")}))},deleteOfflineCaseHandler:function(e,t){var r=this;(t=t||{}).idCase=t.idCase||"",r.deleteCase(t).then((function(){bizagi.util.isNativePluginSupported()&&bizagiapp.offlineCaseDeleted("success")})).fail((function(e){bizagiapp.offlineCaseDeleted("error"),r.defaultErrorHandler(e,"error deleting an offline case")}))},pushOfflineDataHandler:function(e){this.online&&this.pushOfflineData()},cleanDatabasesHandler:function(){var e=this;e.database.restartDatabases().then((function(){bizagi.util.isiOSSmartphoneDevice()&&bizagi.util.isNativePluginSupported()||(bizagi.webpart.publish("bz-summary-item-clear"),e.showTaskFeed(),e.online||$(document).trigger("offline.inbox"),bizagi.webpart.publish("bz-update-list-sync-errors-cases"))})).fail((function(t){e.defaultErrorHandler(t,"error cleaning database")}))},tryPushOfflineCaseHandler:function(e){var t=this;if(t.online&&e)return t.syncSingleOfflineCase(e).then((function(t){return"task"===e.offlineType&&(t.IdCase=e.idCase),t})).fail((function(e){t.defaultErrorHandler(e,"error trying to push offline case")}));var r=bizagi.localization.getResource("workportal-login-network-error","The internet connection appears to be offline. Please verify and try again"),i=JSON.stringify({error:{errorType:"NetworkError",message:r},message:r,type:"error"});return $.Deferred().reject(i).promise()},syncSingleOfflineCase:function(e){return"task"===e.offlineType?this.pullWorker.syncSingleOfflineTaskCase(e):this.pullWorker.syncSingleOfflineStartCase(e)},onlineServicesHandler:function(){void 0!==this.lastOnlineTimestamp&&Date.now()-this.lastOnlineTimestamp<100||(this.online=!0,this.isOfflineFormsV2Supported&&this.shouldSynchronize&&(this.returnOnlineStatus(),this.lastOnlineTimestamp=Date.now()))},offlineServicesHandler:function(){this.online=!1},getSyncErrorsListHandler:function(){var e=this;e.getSyncErrorsList().then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineSyncErrorList(e)})).fail((function(t){e.defaultErrorHandler(t,"Error getting sync error list"),bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineSyncErrorList([])}))},getInboxSyncErrorsHandler:function(){$.when(this.getInboxSyncErrors()).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineInboxSyncErrors(e)})).fail((function(e){bizagiapp.setOfflineInboxSyncErrors({}),this.defaultErrorHandler(e,"Error getting inbox sync errors")}))},showTaskFeed:function(){var e={updateDataList:!0,page:1},t=bizagi.util.getLastProcessInbox();bizagi.util.isEmpty(t)||bizagi.util.isEmpty(t.processInfo)||(-1!=t.processInfo.idWorkflow?e.idWorkflow=t.processInfo.idWorkflow:bizagi.util.isEmpty(t.processInfo.smartInboxId)||(e.smartInboxId=t.processInfo.smartInboxId)),bizagi.webpart.publish("bz-update-list-cases",e)},getOutboxCasesCount:function(){var e=this,t=new $.Deferred,r=0;return $.when(e.database.getOutboxCases()).then((function(e){r+=e.rows?e.rows.length:0})).always((function(){$.when(e.database.getOutboxTaskCasesFilteredBySyncStatus("none",!0)).done((function(e){r+=e.length})).always((function(){t.resolve(r)}))})),t.promise()},returnOnlineStatus:function(){var e=this;return e.saveWorkInProgress().always((function(){return e.getOutboxCasesCount().then((function(t){if(t>0)return bizagi.util.isNativePluginSupported()&&bizagiapp.openSyncDialog(),e.pushOfflineData()})).always((function(){var t=bizagi.util.getLastProcessInbox().processInfo.smartInboxId;bizagi.util.isiOSSmartphoneDevice()?e.fetchOfflineData():(bizagi.webpart.publish("bz-update-list-cases",{updateDataList:!0,smartInboxId:t||void 0}),bizagi.util.isOfflineErrorsViewSupported()&&bizagi.webpart.publish("bz-update-list-sync-errors-cases"))}))}))},fetchOfflineData:function(){this.isOfflineFormsV2Supported&&this.fetchWorker.fetch()},pushOfflineData:function(){var e=this;if(e.isOfflineFormsV2Supported)return e.pullWorker.pull().then((function(t){return e.showSyncMessage(t),t})).fail((function(t){var r=!(!t||!t.type);return e.showSyncMessage(!1,r),t}))},getCurrentUser:function(e){return this.online?this._super(e):$.when({idUser:1,user:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",domain:"undefined"!=typeof BIZAGI_DOMAIN?BIZAGI_DOMAIN:"domain",delegateUserName:"",idDelegateUser:-1,groupSeparator:",",language:"en-US",decimalSeparator:".",decimalDigits:"2",symbol:"$",ShortDateFormat:"M/d/yyyy",TimeFormat:"h:mm tt",LongDateFormat:"dddd, MMMM d, yyyy",twoDigitYearMax:2029,twoDigitYearMaxDelta:13,uploadMaxFileSize:"1048576",isMultiOrganization:"false",associatedStakeholders:[],sUserProperties:[]})},getAllProcesses:function(e){var t=this;return e.inputtray=e.inputtray||"inbox",t.online&&"inbox"==e.inputtray?t._super(e):t.database.getAllProcesses(e).then((function(r){if(r=JSON.parse(r),e.skipAggrupate)return t.includeAllProcessesItem(r),r;var i={},a=t.createDefaultCategories(e,r);for(key in i.categories=[],a)i.categories.push({name:key,workflows:a[key].workflows});return i}))},getAllSmartInbox:function(){var e=this;return bizagi.util.isMobileSmartInboxEnabled()?e.online?e._super().then((function(t){return e.database.saveAvailableSmartInboxes(t),t})):e.database.getAvailableSmartInboxes().then((function(t){return e.availableSmartInboxes=t,e.database.getAvailableOfflineSmartInboxes()})).then((function(t){return $.map(e.availableSmartInboxes,(function(e){return $.extend(e,{offline:-1!=t.indexOf(e.id)})}))})):$.Deferred().resolve([]).promise()},markSmartInboxAsAvailableOffline:function(e){return this.database.markSmartInboxAsAvailableOffline(e)},getLastProcessInboxWorkflow:function(){return this.online?this._super():bizagi.util.getLastProcessInboxProcessInfo()},getCasesByWorkflow:function(e){return e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray?this.online?this._super(e):this.getCasesByWorkflowForInboxOffline(e):this.getCasesByWorkflowForOtherTrays(e)},getCasesByWorkflowForInboxOffline:function(e){return this.getCustomizedColumnsDataTasks(e).then((function(e){return e=JSON.parse(e),$.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.radNumber,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?e.cases.rows[t].radnumber=a.Value:null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getCasesByWorkflowForOtherTrays:function(e){return this.database.getCustomizedColumnsData(e).then((function(e){return e=JSON.parse(e),$.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?e.cases.rows[t].radnumber=a.Value:null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getCustomizedColumnsDataTasks:function(e){var t,r,i=this,a=-1;return e.idWorkflow=e.idWorkflow||e.idWfClass,(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),null!=e.idWorkflow&&bizagi.util.validateFeatureSupport("offlineCustomizedColumns")&&(a=e.idWorkflow),i.database.getProcessCustomColumnsHeaders(a).then((function(a){t=a.headers,r=a.type;var s=$.extend({isOpen:!0},e);return i.database.getOfflineCases(s)})).then((function(a){return i.parseCustomizedColumnDataTaskResponse(e,a,t,r)}))},parseCustomizedColumnDataTaskResponse:function(e,t,r,i){for(var a=t.elements,s={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},o=0,n=a.length;o<n;o++){var l=a[o];if(this.isValidRadNumber(e.radNumber,l)){var c=this.buildCaseData(l),d=l.systemColumns,u=this.buildDefaultSystemHeaders();"process"==i&&(d=l.processColumns),null!=d&&(c.fields=[],r.forEach((function(e){"radnumber"==e.fieldName?c.casenumberdisplayname=e.displayName:("process"==i?1==e.isCustomColumn:1==u[e.fieldName])&&c.fields.push({Value:d[e.fieldName]||"",DisplayName:e.displayName,DataType:e.type,isRadNumber:"radnumber"==e.fieldName})}))),s.cases.rows.push(c),s.cases.lstIdCases.push(l[0])}}return s.cases.totalPages=s.cases.page=s.cases.rows.length>0?1:0,JSON.stringify(s)},buildCaseData:function(e){return{id:e[0],radNumber:e.radNumber,idWFClass:e[10],idWorkFlow:e[10],taskState:e.taskState,isFavorite:e[9],isEdited:e.isEdited,offlineType:"task",isOpen:!0,isOfflineForm:!0,fields:[{Value:e.wfclsdisplayname,DisplayName:e.wfclsdisplayname,DataType:"VarChar",isRadNumber:!1},{Value:e[12],DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]}},getMenuAuthorization:function(){return this.online?this._super():$.when({permissions:[{Cases:["NewCase","Pending","Closed","Search"]},{AnalysisReports:["BAMProcess","BAMTask","AnalyticsProcess","AnalyticsTask","AnalyticsSensor","AnalysisQueries","BAMResourceMonitor"]},{Admin:["UserAdmin","Licenses","EntityAdmin","CaseAdmin","AlarmAdmin","EncryptionAdmin","MobileUpdatesAdmin","AsynchronousWorkitemRetries","UserPendingRequests","AuthenticationLogQuery","BusinessPolicies","Profiles","UserDefaultAssignation","GRDimensionAdmin","ThemeBuilder"]},{CurrentUserAdministration:["CurrentUser"]},{LogOut:[]},{Search:[]},{SmartFolders:[]},{CustomFolders:[]},{BizagiQueries:[]},{AnalysisQueries:[]},{StateLog:[]},{PrintableVersion:[]}]})},getInboxSummary:function(e){var t=this.online;return!e||"false"!=e.inputtray&&"true"!=e.inputtray||(t=!1),t?this._super(e):$.when({inboxSummary:{Red:7,Yellow:0,Green:0,Black:0,All:7}})},getCategories:function(e){if(this.online)return this._super(e);var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),t.enableOfflineForm=e.enableOfflineForm||!1,t.groupByApp=e.groupByApp||!1,this.database.getCategories(t)},createNewCase:function(e){return(e=e||{}).isOfflineForm?this.database.createNewCase(e):this._super(e)},getWorkitems:function(e){return(e=e||{}).isOfflineForm?bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getCase?this.getNativeWorkItems(e):this.database.getWorkitems(e):this._super(e)},getNativeWorkItems:function(e){var t=new $.Deferred;return bizagiapp.getCase(e.idCase,(function(e){var r=JSON.parse(e);t.resolve(r)}),(function(e){t.reject(e)})),t.promise()},getCaseSummary:function(e){return(e=e||{}).isOfflineForm?this.database.getSummary(e):this._super(e)},deleteCase:function(e){return e=e||{},this.database.deleteCase(e)},getCaseSubprocesses:function(e){return(e=e||{}).isOfflineForm?$.when({subProcesses:[]}):this._super(e)},getOverrides:function(){return{}},getCasesListBeta:function(e){var t=this;return(e=e||{}).inputtray=e.inputtray||"inbox","inbox"===e.inputtray?t.online?($.when(t.saveWorkInProgress()).then((function(){t.fetchOfflineData()})).fail((function(){console.log("getCasesListBeta => Error in saveWorkInProgress promise")})),t._super(e)):t.getCasesListBetaForInbox(e):"drafts"===e.inputtray||"outbox-new"===e.inputtray?t.getCasesListBetaForDraftsOrOutBox(e):t.getCasesListBetaForOtherTrays(e)},getCasesListBetaForInbox:function(e){var t=this;return e.isOpen=!0,e.idWfClass=null!=e.idWfClass?e.idWfClass:-1,$.when(t.getProcessCustomColumnsHeaders(e),t.database.getOfflineCases(e)).then((function(e,r){var i=t.getTaskFeedData(r);return e&&e.headers&&(i.headers=e.headers),i}))},getCasesListBetaForDraftsOrOutBox:function(e){var t=this;return t.database.getCasesList(e).then((function(e){return t.getTaskFeedData(e)}))},getCasesListBetaForOtherTrays:function(e){var t=this;return e.isOpen=!1,t.database.getOfflineCases(e).then((function(e){return t.getTaskFeedData(e)}))},getLastSelectionCustomColumns:function(){var e=bizagi.util.getLastProcessInbox(),t=e.processInfo.idWorkflow,r=e.processInfo.smartInboxId;if(!bizagi.util.isEmpty(e.processColumnsInfo)&&!bizagi.util.isEmpty(e.processColumnsInfo.processColumns))return $.Deferred().resolve(e.processColumnsInfo.processColumns).promise();$.Deferred().resolve(void 0).promise();return(null!=r?this.getSmartInboxCustomColumnsHeaders({smartInboxId:r}):this.getProcessCustomColumnsHeaders({idWfClass:t})).then((function(e){return bizagi.util.setLastProcessInboxProcessColumns(e.headers),e.headers}))},getProcessCustomColumnsHeaders:function(e){return this.database.getProcessCustomColumnsHeaders(e.idWfClass)},getSmartInboxCustomColumnsHeaders:function(e){return null!=e.smartInboxId?this.database.getSmartInboxCustomColumnsHeaders(e.smartInboxId):void 0},getMobileCasesList:function(e){return"inbox"===e.inputtray?this._super(e):getCasesListBeta(e)},getTaskFeedData:function(e){for(var t=bizagi.localization.getResource("workportal-taskfeed-overdue"),r=bizagi.localization.getResource("workportal-taskfeed-today"),i=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),a=bizagi.localization.getResource("workportal-taskfeed-upcomming"),s={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:!1},o=new Date,n=o.getMonth(),l=o.getDate(),c=o.getFullYear(),d=0;e.elements.length>d;d++){var u=e.elements[d];void 0!==u.offlineType&&"task"===u.offlineType&&(u[3]=u.endDate);var p={},f=u[3];if(""!==u[3]){var g=new Date(u[3]),m=g.getDate(),h=g.getMonth(),y=g.getFullYear();new Date(y,h,m,0,0,0)-new Date(c,n,l,0,0,0)<0?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p=this.getTaskFeedStatus("1|"+t,"red","overdue","overdue")):(n===h&&l===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=g.getTime()<o.getTime()?this.getTaskFeedStatus("2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),"red","today","overdue"):this.getTaskFeedStatus("2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),"yellow","today","ontime")):n===h&&l+1===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=this.getTaskFeedStatus("3|"+i,"yellow","tomorrow","ontime")):(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p=this.getTaskFeedStatus("4|"+a,"green","upcoming","upcoming")),p&&u.taskstate&&(p.state=u.taskstate))}else u[3]="--",p=this.getTaskFeedStatus("1|"+t,"red","overdue","overdue");s.elements.push($.extend({},u,p,{endDate:f,idworkitem:u[1]}))}return s},getTaskFeedStatus:function(e,t,r,i){return status={group:e,state:t,type:r,icon:i}},summaryCaseDetails:function(e){var t=e||{},r=e.idWorkitem||0;return t.inputtray=t.inputtray||"inbox",t.isOfflineForm?this.getCaseSummaryDataContent(e).done((function(e){e.currentState=e.currentState||[];var t=e.currentState.length;e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosed="true"!=e.isOpen,e.showAssignees=e.countAssigness>=1,e.showSubProcess=e.countSubProcesses>=1,e.showForm="true"==e.hasGlobalForm,e.allowsReassign="false";for(var i=0;i<t;i++)e.currentState[i].idWorkItem==r&&(e.allowsReassign=e.currentState[i].allowsReassign);for(var a=[],s=0,o=0;o<e.currentState.length;o++)"false"==e.currentState[o].isEvent&&"true"==e.currentState[o].assignToCurrentUser&&e.currentState[o].idWorkItem!=r&&(a[s++]=e.currentState[o]);return e.currentStateTypes=a,e.showActivities=a.length>=1,e})):this._super(t)},getCaseSummaryDataContent:function(e){var t=this;return t.getCaseSummary(e).then((function(e){return e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),e}))},getCustomizedColumnsData:function(e){return e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray?this._super(e):this.database.getCustomizedColumnsNewData(e).then((function(e){return JSON.parse(e)}))},getRecentProcesses:function(e){return e=e||{},this.online?this._super(e):this.database.getRecentProcesses(e)},startProcess:function(e){return e=e||{},this.online?this._super(e):$.when({hasStartForm:!1,idProcess:e.idProcess,displayName:e.displayName,caseInfo:{}})},getShortCuts:function(e){return e=e||{},this.online?this._super(e):$.when([])},getSearchLists:function(){return this.online?this._super():$.when([])},getCollectionIcon:function(e){return e=e||{},this.online?this._super(e):$.when([])},getRecentOfflineProcesses:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("process-handler-getRecentProcesses"),data:e,dataType:"json",type:"GET",avoidLoader:!0}).then((function(e){var t=e.processes||[],r={processes:[]};if(!bizagi.util.isObjectEmpty(t))for(var i,a=-1;i=t[++a];)i.hasOfflineForm&&r.processes.push(i);return r}))},getOfflineProcessesHierarchy:function(){var e={removeOnlineItems:"true"};return $.ajax({url:this.serviceLocator.getUrl("offline-getProcessTree"),data:e,dataType:"json",type:"GET",avoidLoader:!0})},getOfflineTasks:function(){var e={};return e.pageSize=this.maxOfflineCases,e.page=1,$.ajax({url:this.serviceLocator.getUrl("offline-tasks"),data:e,dataType:"json",type:"GET",avoidLoader:!0})},serializeOfflineCustomizedColumns:function(e,t){var r=[];return t.forEach((function(t){var i={};e.forEach((function(e,r){e.fieldName&&(i[e.fieldName]=t[r])})),r.push(i)})),r},deserializeOfflineCustomizedColumns:function(e,t){var r=[];return t.forEach((function(t,i){var a=r[i];null==a&&(a=[]),e.forEach((function(e,r){a[r]=t[e.fieldName]})),r[i]=a})),r},addEvalPropertyToOfflineHeaders:function(e){var t={taskstate:"*VAR*.workItems[0].State",wfclsdisplayname:"*VAR*.categoryName",currenttask:"*VAR*.workItems[0].TaskName",cascreationdate:"*VAR*.creationDate",wiestimatedsolutiondate:"*VAR*.endDate",idworkitem:"*VAR*.workItems[0].idWorkItem",taskid:"*VAR*.workItems[0].idTask",hassyncerror:"!bizagi.util.isEmpty(*VAR*.syncStatus)",syncerror:"bizagi.util.isEmpty(*VAR*.syncStatus) ? undefined : *VAR*.syncDetails"};return e.map((function(e){return t[e.fieldName]&&(e.eval=t[e.fieldName],e.varSymbol="*VAR*"),e}))},getOfflineSystemHeaders:function(){return["isEdited","isOpen","syncStatus","isDraft","syncDetails","formsRenderVersion","isOfflineForm","offlineType","hassyncerror","syncerror"].map((function(e){return{displayName:e,fieldName:e}}))},getCardViewCustomizedColumns:function(e){var t,r=this,i={headers:[],rows:[],currentPage:1,totalPages:1,totalRecords:0};return e.inputtray=e.inputtray||"inbox",r.online&&"inbox"===e.inputtray?($.when(r.saveWorkInProgress()).then((function(){r.fetchOfflineData()})).fail((function(){console.log("getCardViewCustomizedColumns => Error in saveWorkInProgress promise")})),r._super(e)):("inbox"===e.inputtray?e.isOpen=!0:(e.idWfClass=-1,e.isOpen="drafts"===e.inputtray,delete e.sortData),(null!=e.smartInboxId?r.database.getSmartInboxCustomColumnsHeaders(e.smartInboxId):r.database.getProcessCustomColumnsHeaders(e.idWfClass)).then((function(i){return t=(t=i.headers).concat(r.getOfflineSystemHeaders()),t=r.addEvalPropertyToOfflineHeaders(t),e.headers=t,e.customColumnsType=i.type,r.database.getCustomColumnsData(e)}),(function(e){return r.defaultErrorHandler(e,"OFFLINE: getCardViewCustomizedColumns => Error retrieving headers"),console.warn(),i})).then((function(e){return i.headers=t,i.rows=r.deserializeOfflineCustomizedColumns(t,e),i.pageSize=e.length,i.totalRecords=e.length,i}),(function(e,t){return r.defaultErrorHandler({headersErr:e,rowsErr:t},"OFFLINE: getCardViewCustomizedColumns => Error retrieving rows"),console.warn(),i})))},downloadOfflineCustomizedColumns:function(){var e=this;if(this.online&&this.isOfflineFormsV2Supported){var t=bizagi.util.getLastProcessInboxProcessInfo(),r=-1,i=null;bizagi.util.validateFeatureSupport("offlineCustomizedColumns")&&t&&t.idWorkflow&&(r=t.idWorkflow);var a={pageSize:100,page:1,avoidLoader:!0};return-1!=r&&(a.idWfClass=r),-1!=t.smartInboxId&&(a.smartInboxId=i=t.smartInboxId),this.getCardViewCustomizedColumns(a).then((function(t){var a=t.headers,s=t.rows;if(!a||!s)return $.Deferred().reject("Headers or rows are missing in the custom columns service response").promise();var o=new bizagiQueue;return o.add(e.database.saveProcessCustomColumnsHeaders(-1,e.filterSystemHeaders(a))),-1!=r?o.add(e.database.saveProcessCustomColumnsHeaders(r,a)):null!=i&&o.add(e.database.saveSmartInboxCustomColumnsHeaders(i,a)),e.serializeOfflineCustomizedColumns(a,s).forEach((function(t){var a,s=t.idcase+"-"+t.idworkitem;-1!=r?a=e.database.updateTaskWorkItemCustomColumnsByType(s,"process",t):null!=i&&(a=e.database.updateTaskWorkItemCustomColumnsByType(s,"smartinbox",t,i)),null!=a&&o.add(a)})),o.execute()})).fail((function(t){return e.defaultErrorHandler(t,"Error downloading the customized columns.")}))}},getMobileOfflineActivities:function(e){var t=this;return t.isActivityAlreadyDownloaded(e.idCase,e.idWorkitem).then((function(r){if(r)return null;bizagi.util.console.log("Force offline => Task is NOT already downloaded. Downloading...");var i={radNumber:e.radNumber,idWorkitem:e.idWorkitem||null};return t.getMobileActivities(i)})).then((function(r){if(null==r)return null;var i=t.fetchWorker.serializeActivities(r),a=e.idCase+"-"+e.idWorkitem,s=i[a];if(void 0===s)return $.Deferred().reject({type:"error",message:"Problem retrieving the activity from the server"}).promise();return s.isOnDemand=!0,t.database.saveOfflineTasks(i)})).then((function(r){return null==r?null:t.updateCustomColumns(e,void 0)}))},updateCustomColumns:function(e,t){var r=this;if(!bizagi.util.isEmpty(e.idWfClass)){var i=t.headers,a=t.rows,s=r.serializeOfflineCustomizedColumns(i,a),o=new bizagiQueue;return bizagi.util.isEmpty(e.idWorkflow)||(o.add(r.database.saveProcessCustomColumnsHeaders(-1,r.filterSystemHeaders(i))),o.add(r.database.saveProcessCustomColumnsHeaders(e.idWorkflow,i))),s.forEach((function(e){var t=e.idcase+"-"+e.idworkitem,i=r.database.updateTaskWorkItemCustomColumnsByType(t,"process",e);o.add(i)})),o.execute()}},downloadActivityOnDemand:function(e){var t=this;return bizagi.loading.start(),t.getMobileOfflineActivities(e).then((function(){return t.isTaskFormAlreadyDownloaded(e.idCase,e.idWorkitem)})).then((function(r){return!r||!!e.executeOfflineEntryPipeline&&t.formService.verifyFormEntryPipeline(e)})).then((function(r){return r?$.when(t.formService.downloadOfflineTaskForm({idCase:e.idCase,idWorkitem:e.idWorkitem,executeOfflineEntryPipeline:e.executeOfflineEntryPipeline})):{wasFormDownloaded:!1,hasEntryPipeline:!1,wasPipelineExecuted:!1}})).always((function(){bizagi.loading.stop()}))},downloadStartFormOnDemand:function(e){var t=this;return t.isStartFormAlreadyDownloaded(e).then((function(r){if(!r&&!1!==t.online)return t.formService.downloadOfflineStartForm({idProcess:e})}))},showSyncMessage:function(e,t){var r=bizagi.util.isValidResource("workportal-mobile-offline-sync-successful")?bizagi.localization.getResource("workportal-mobile-offline-sync-successful"):"Synchronization successful",i="success";e||(r=bizagi.util.isValidResource("workportal-mobile-offline-sync-fail")?bizagi.localization.getResource("workportal-mobile-offline-sync-fail"):"Synchronization failed",i=t&&!bizagi.util.isNativePluginSupported()?"":"error"),bizagi.util.isNativePluginSupported()?bizagiapp.synchronizationFinished(i):bizagi.util.showNotification({text:r,type:i})},defaultErrorHandler:function(e,t){return"object"==_typeof(e)?bizagi.util.console.error(t,e):bizagi.util.console.error(t+":"+e),e},createDefaultCategories:function(e,t,r){r={};var i=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),a={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:i,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};r[i]=[],r[i].workflows=[],r[i].workflows.push(a),t.workflows&&$.each(t.workflows.workflow,(function(e,t){r[t.category]||(r[t.category]=[],r[t.category].workflows=[]),r[t.category].workflows.push(t),a.count+=Number(t.count)}))},isActivityAlreadyDownloaded:function(e,t){return this.database.getTask(e+"-"+t).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isTaskFormAlreadyDownloaded:function(e,t){return this.database.getTaskForm({idCase:e,idWorkitem:t}).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isStartFormAlreadyDownloaded:function(e){return this.database.getStartForm({idProcess:e}).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isValidRadNumber:function(e,t){return void 0===e||""===e.toString()||e.toString()===t[0]||e==t[0]||e.toString()==t.radNumber||e==t.radNumber},buildDefaultSystemHeaders:function(){return{radnumber:!0,wfclsdisplayname:!0,cascreationdate:!0,wiestimatedsolutiondate:!0,cassolutiondate:!0}},filterSystemHeaders:function(e){var t=[],r=this;return e.forEach((function(e){r.isInboxHeaderASystemColumn(e.fieldName)&&t.push(e)})),t},updateSyncErrorsStatus:function(){this.getSyncErrorsList().then((function(e){var t=bizagi.util.isEmpty(e)?0:e.length;$(document).trigger("update-sync-errors-icon",{errors:t})}))},saveWorkInProgress:function(){var e=new $.Deferred;return void 0!==this.activeForm&&this.activeForm.params&&"task"===this.activeForm.params.offlineType&&!0===this.activeForm.params.isOfflineForm?(document.activeElement.blur(),this.activeForm.saveWorkInProgress()):(e.resolve(),e.promise())},retrySyncSingleOfflineCaseNative:function(e){var t=this;e.isSingleSync=e.isSingleSync||!0,e.isRetry=e.isRetry||!0,t.syncSingleOfflineCase(e).then((function(){bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})})).fail((function(e){bizagi.util.showMobileToast({type:"error",message:bizagi.localization.getResource("workportal-offline-sync-failed")})})).always((function(){setTimeout((function(){t.getSyncErrorsListHandler()}),100)}))},downloadOfflineTaskForm:function(e){return this.formService.downloadOfflineTaskForm(e)},downloadOfflineStartForm:function(e){return this.formService.downloadOfflineStartForm(e)},syncOfflineStartCase:function(e){return this.syncService.syncOfflineStartCase(e)},syncOfflineTaskCase:function(e){return this.syncService.syncOfflineTaskCase(e)},getInboxSyncErrors:function(){return this.database.getInboxSyncErrors()},getSyncErrorsList:function(){return this.database.getSyncErrorsList()},getTaskSyncError:function(e){return this.database.getTaskSyncError(e)}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{},{init:function(e){e&&void 0!==e.oldOfflineServicesAlreadyEnabled&&(e.oldOfflineServicesAlreadyEnabled=!bizagi.util.isOfflineFormsV2Supported()),this._super(e),bizagi.util.isOfflineFormsV2Supported()||(void 0!==bizagi.workportal.services.db.old&&(this.database=new bizagi.workportal.services.db.old),this.enableOfflineEvents())},enableOfflineEvents:function enableOfflineEvents(){var self=this;if(bizagi.util.isOfflineFormsV2Supported())self._super();else{if(bizagi.util.isTabletDevice()){if(void 0!==navigator.connection)"undefined"==typeof Connection||navigator.connection.type!=Connection.NONE&&"unknown"!=navigator.connection.type?self.online=!0:self.online=!1;else{var queryString=bizagi.readQueryString(),queryoffline=!queryString||!queryString.online||eval(queryString.online);self.online=queryoffline}$(document).off("online.services"),$(document).on("online.services",(function(){self.online=!0,bizagi.log("online.services"),self.returnOnlineStatus()})),$(document).off("offline.services"),$(document).on("offline.services",(function(){bizagi.log("offline.services"),self.online=!1}))}$(document).off("tryPushData.offline"),$(document).on("tryPushData.offline",(function(e){self.online&&self.pushOfflineData()}))}},returnOnlineStatus:function(){if(bizagi.util.isOfflineFormsV2Supported())this._super();else{var e=this;$.when(e.logoutUser()).always((function(){$.when(e.authenticatedUser()).always((function(){$.when(e.pushOfflineData()).always((function(t){e.fetchOfflineData(t)}))}))}))}},fetchOfflineData:function(e){if(bizagi.util.isOfflineFormsV2Supported())this._super(e);else if(bizagi.util.hasOfflineFormsEnabled()){var t=new bizagi.workportal.services.fetchWorker.old(this),r="";$.when(t.fetch()).done((function(e){bizagi.log("Sync Completed"),bizagi.util.isTabletDevice()&&(r=bizagi.util.isValidResource("workportal-mobile-offline-sync-successful")?bizagi.localization.getResource("workportal-mobile-offline-sync-successful"):"Successful Synchronization",bizagi.util.showNotification({text:r,type:"success"}))})).fail((function(e){bizagi.log("Sync Failed"),bizagi.util.isTabletDevice()&&0!==e&&(r=bizagi.util.isValidResource("workportal-mobile-offline-sync-fail")?bizagi.localization.getResource("workportal-mobile-offline-sync-fail"):"Failed Synchronization",bizagi.util.showNotification({text:r,type:"error"}))}))}},pushOfflineData:function(){if(bizagi.util.isOfflineFormsV2Supported())return this._super();if(bizagi.util.hasOfflineFormsEnabled()){var e=new bizagi.workportal.services.pullWorker.old(this);return $.when(e.pull()).then((function(e){bizagi.log("Offline cases syncronized, all data sended")}),(function(e){bizagi.log("Error syncronizing cases")}))}},syncOfflineCases:function(e){return $.ajax({url:this.serviceLocator.getUrl("offline-sendForm"),data:{idCase:e.idCase,idWFClass:e.idWfClass,awCaseCreationContext:JSON.stringify(e.objToSend),idWorkflow:e.idWfClass},type:"POST",dataType:"json",serviceType:"LOAD"})},processesHierarchyTofetchForms:function(e){var t={};return t.idChangeSet=e.changeSet,$.ajax({url:this.serviceLocator.getUrl("offline-getForms"),data:t,dataType:"json"})},getCurrentUser:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);if(this.online)return this._super(e);var t=new $.Deferred,r={idUser:1,user:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",domain:"undefined"!=typeof BIZAGI_DOMAIN?BIZAGI_DOMAIN:"domain",delegateUserName:"",idDelegateUser:-1,groupSeparator:",",language:"en-US",decimalSeparator:".",decimalDigits:"2",symbol:"$",ShortDateFormat:"M/d/yyyy",TimeFormat:"h:mm tt",LongDateFormat:"dddd, MMMM d, yyyy",twoDigitYearMax:2029,twoDigitYearMaxDelta:13,uploadMaxFileSize:"1048576",isMultiOrganization:"false",associatedStakeholders:[],sUserProperties:[]};return t.resolve(r),t.promise()},getAllProcesses:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);return e.inputtray=e.inputtray||"inbox","inbox"==e.inputtray?this._super(e):$.when(this.database.getAllProcesses(e)).pipe((function(t){if(t=JSON.parse(t),e.skipAggrupate)return t;var r={},i={},a=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),s={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:a,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};for(key in i[a]=[],i[a].workflows=[],i[a].workflows.push(s),t.workflows&&$.each(t.workflows.workflow,(function(e,t){i[t.category]||(i[t.category]=[],i[t.category].workflows=[]),i[t.category].workflows.push(t),s.count+=Number(t.count)})),r.categories=[],i)r.categories.push({name:key,workflows:i[key].workflows});return r}))},getCasesByWorkflow:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);if(e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray){if(this.online)return this._super(e);var t=new $.Deferred;return t.resolve({rows:[],totalPages:0,page:1,lstIdCases:[]}),t.promise()}var r=new $.Deferred;return $.when(this.database.getCustomizedColumnsData(e)).pipe((function(e){e=JSON.parse(e),$.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?e.cases.rows[t].radnumber=a.Value:null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),r.resolve(e.cases)})),r.promise()},getMenuAuthorization:function(){if(bizagi.util.isOfflineFormsV2Supported())return this._super();if(this.online)return this._super();var e=new $.Deferred;return e.resolve({permissions:[{Cases:["NewCase","Pending","Closed","Search"]},{AnalysisReports:["BAMProcess","BAMTask","AnalyticsProcess","AnalyticsTask","AnalyticsSensor","AnalysisQueries","BAMResourceMonitor"]},{Admin:["UserAdmin","Licenses","EntityAdmin","CaseAdmin","AlarmAdmin","EncryptionAdmin","MobileUpdatesAdmin","AsynchronousWorkitemRetries","UserPendingRequests","AuthenticationLogQuery","BusinessPolicies","Profiles","UserDefaultAssignation","GRDimensionAdmin","ThemeBuilder"]},{CurrentUserAdministration:["CurrentUser"]},{LogOut:[]},{Search:[]},{SmartFolders:[]},{CustomFolders:[]},{BizagiQueries:[]},{AnalysisQueries:[]},{StateLog:[]},{PrintableVersion:[]}]}),e.promise()},getInboxSummary:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super();var t=this.online;if(!e||"false"!=e.inputtray&&"true"!=e.inputtray||(t=!1),t)return this._super(e);var r=new $.Deferred;return $.when('{"inboxSummary":{"Red":7,"Yellow":0,"Green":0,"Black":0,"All":7}}').pipe((function(e){var t=JSON.parse(e);r.resolve(t.inboxSummary)})),r.promise()},getCategories:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);if(this.online)return this._super(e);var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),t.enableOfflineForm=e.enableOfflineForm||!1,t.groupByApp=e.groupByApp||!1,this.database.getCategories(t)},createNewCase:function(e){return e=e||{},bizagi.util.isOfflineFormsV2Supported()||!e.isOfflineForm?this._super(e):this.database.createNewCase(e)},getWorkitems:function(e){return e=e||{},bizagi.util.isOfflineFormsV2Supported()||!e.isOfflineForm?this._super(e):bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getCase?this.getNativeWorkItems(e):this.database.getWorkitems(e)},getNativeWorkItems:function(e){var t=new $.Deferred;return bizagiapp.getCase(e.idCase,(function(e){var r=JSON.parse(e);t.resolve(r)}),(function(e){t.reject(e)})),t.promise()},getCaseSummary:function(e){return e=e||{},bizagi.util.isOfflineFormsV2Supported()||!e.isOfflineForm?this._super(e):this.database.getSummary(e)},deleteCase:function(e){return e=e||{},bizagi.util.isOfflineFormsV2Supported()?this._super(e):this.database.deleteCase(e)},getCaseSubprocesses:function(e){if(e=e||{},bizagi.util.isOfflineFormsV2Supported()||!e.isOfflineForm)return this._super(e);var t=new $.Deferred;return t.resolve({subProcesses:[]}),t.promise()},getOverrides:function(){return{}},getCasesListBeta:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);var t=this;if((e=e||{}).inputtray=e.inputtray||"inbox","inbox"===e.inputtray||"outbox-finished"==e.inputtray){if(t.online&&"inbox"===e.inputtray)return t._super(e);var r=new $.Deferred;return r.resolve({page:1,totalPages:1,elements:[]}),r.promise()}var i=new $.Deferred;return $.when(t.database.getCasesList(e)).pipe((function(e){e=JSON.parse(e);var r=t.getTaskFeedData(e);i.resolve(r)})),i.promise()},getMobileCasesList:function(e){return bizagi.util.isOfflineFormsV2Supported()||"inbox"===e.inputtray?this._super(e):getCasesListBeta(e)},getTaskFeedData:function(e){if(bizagi.util.isOfflineFormsV2Supported())return this._super(e);for(var t=bizagi.localization.getResource("workportal-taskfeed-overdue"),r=bizagi.localization.getResource("workportal-taskfeed-today"),i=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),a=bizagi.localization.getResource("workportal-taskfeed-upcomming"),s={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:!1},o=new Date,n=o.getMonth(),l=o.getDate(),c=o.getFullYear(),d=0;e.elements.length>d;d++){var u=e.elements[d],p={},f=u[3];if(""!==u[3]){var g=new Date(u[3]),m=g.getDate(),h=g.getMonth(),y=g.getFullYear();new Date(y,h,m,0,0,0)-new Date(c,n,l,0,0,0)<0?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p={group:"1|"+t,state:"red",type:"overdue",icon:"overdue"}):n===h&&l===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=g.getTime()<o.getTime()?{group:"2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),state:"red",type:"today",icon:"overdue"}:{group:"2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),state:"yellow",type:"today",icon:"ontime"}):n===h&&l+1===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p={group:"3|"+i+", "+bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd"),state:"yellow",type:"tomorrow",icon:"ontime"}):(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p={group:"4|"+a,state:"green",type:"upcoming",icon:"upcoming"})}else u[3]="--",p={group:"1|"+t,state:"red",type:"overdue",icon:"overdue"};s.elements.push($.extend({},u,p,{endDate:f,idworkitem:u[1]}))}return s},summaryCaseDetails:function(e){var t=e||{};if(t.inputtray=t.inputtray||"inbox",bizagi.util.isOfflineFormsV2Supported()||!t.isOfflineForm)return this._super(t);var r=$.Deferred(),i=e.idWorkitem||0;return $.when(this.getCaseSummaryDataContent(e)).done((function(e){e.currentState=e.currentState||[];var t=e.currentState.length;e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosed="true"!=e.isOpen,e.showAssignees=e.countAssigness>=1,e.showSubProcess=e.countSubProcesses>=1,e.showForm="true"==e.hasGlobalForm,e.allowsReassign="false";for(var a=0;a<t;a++)e.currentState[a].idWorkItem==i&&(e.allowsReassign=e.currentState[a].allowsReassign);for(var s=[],o=0,n=0;n<e.currentState.length;n++)"false"==e.currentState[n].isEvent&&"true"==e.currentState[n].assignToCurrentUser&&e.currentState[n].idWorkItem!=i&&(s[o++]=e.currentState[n]);e.currentStateTypes=s,e.showActivities=s.length>=1,r.resolve(e)})),r.promise()},getCaseSummaryDataContent:function(e){var t=this;if(bizagi.util.isOfflineFormsV2Supported())return t._super(e);var r=new $.Deferred;return $.when(t.getCaseSummary(e)).done((function(e){e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),r.resolve(e)})),r.promise()},getCustomizedColumnsData:function(e){if(e.inputtray=e.inputtray||"inbox",bizagi.util.isOfflineFormsV2Supported()||"inbox"===e.inputtray)return this._super(e);var t=new $.Deferred;return $.when(this.database.getCustomizedColumnsNewData(e)).pipe((function(e){t.resolve(JSON.parse(e))})),t.promise()},getRecentProcesses:function(e){return e=e||{},bizagi.util.isOfflineFormsV2Supported()||this.online?this._super(e):this.database.getRecentProcesses(e)},startProcess:function(e){if(e=e||{},bizagi.util.isOfflineFormsV2Supported()||this.online)return this._super(e);var t=new $.Deferred,r={hasStartForm:!1,idProcess:e.idProcess,displayName:e.displayName,caseInfo:{}};return t.resolve(r),t.promise()},getShortCuts:function(e){if(e=e||{},bizagi.util.isOfflineFormsV2Supported()||this.online)return this._super(e);var t=new $.Deferred;return t.resolve([]),t.promise()},getSearchLists:function(){if(bizagi.util.isOfflineFormsV2Supported()||this.online)return this._super();var e=new $.Deferred;return e.resolve([]),e.promise()},getCollectionIcon:function(e){if(e=e||{},bizagi.util.isOfflineFormsV2Supported()||this.online)return this._super(e);var t=new $.Deferred;return t.resolve([]),t.promise()}}),bizagi.workportal.services.routing.extend("bizagi.workportal.services.routing",{},{init:function(e){this._super(e)},getRoute:function(e){new $.Deferred;if(this.params=e||this.params,void 0===e.offlineAction||"next"!==e.offlineAction&&"nextWithoutValidations"!==e.offlineAction)return this._super(e);var t=this.routeToGlobalFormWithoutData();return $.extend(t.moduleParams,e),bizagi.loading.stop(),$.Deferred().resolve(t).promise()}}),bizagi.workportal.diagnostics=bizagi.workportal.diagnostics||{},$.Class.extend("bizagi.workportal.diagnostics.db",{},{init:function(){this.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",this.createDatabases()},createDatabases:function(){var e=this.globalId.hashCode();this.dbErrors=new PouchDB("Diag_Errors_"+e,{auto_compaction:!0})},deleteDatabases:function(){var e=$.Deferred(),t=[this.dbErrors],r=0,i=function(i,a){i?e.reject(i):++r==t.length&&e.resolve()};return t.forEach((function(e){e.destroy(i)})),e.promise()},restartDatabases:function(){return(void 0).deleteDatabases().always((function(){(void 0).createDatabases()}))}}),bizagi.workportal.diagnostics.db.extend("bizagi.workportal.diagnostics.db",{},{saveError:function(e,t){try{return(t=JSON.parse(JSON.stringify(t)))._id=""+e,bizagi.util.db.saveDocument(this.dbErrors,t)}catch(e){bizagi.util.console.error(this.Class.fullName+": Error parsing the error object",e,t)}},getError:function(e){return bizagi.util.db.getDocument(this.dbErrors,""+e)},getErrorsList:function(e){var t={map:function(e){e.timestamp&&emit(e.timestamp)}},r={include_docs:!0,limit:e,conflicts:!1,descending:!1};return bizagi.util.db.executeQuery(this.dbErrors,t,r).then((function(e){return e.rows.map((function(e){return e.doc&&(delete e.doc._id,delete e.doc._rev),e.doc}))}))},deleteError:function(e){return bizagi.util.db.deleteDocument(this.dbErrors,""+e)}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{DIAGNOSTICS_COMPONENT_NAME:"bizagi.workportal.services.service.diagnostics",DIAGNOSTICS_SYNC_AJAX_PARAMS:{TYPE:"POST",DATATYPE:"json"},DIAGNOSTICS_PACKAGE_MAX_ERRORS:15,DIAGNOSTICS_PACKAGE_SYNC_INTERVAL:6e4,DIAGNOSTICS_PACKAGE_MAX_SIZE_REQUEST_MB:3,DIAGNOSTICS_PACKAGE_MAX_RETRY:3},{init:function(e){this._super(e),this.device=bizagi.util.detectDevice(),this.diagnosticsServiceEnabled=bizagi.util.isMobileErrorTracesEnabled(),this.diagnosticsServiceEnabled&&(this.configureDiagnosticsHandlers(),this.setDiagnosticsDefaultData())},setDiagnosticsDefaultData:function(){this.lastSyncDatetime=null,this.diagnosticstErrorsDb=this.getDiagnosticsDatabaseInstance()},configureDiagnosticsHandlers:function(){var e=this;setInterval((function(){e.syncDiagnosticsError()}),e.Class.DIAGNOSTICS_PACKAGE_SYNC_INTERVAL)},addDiagnosticsError:function(e,t,r,i,a){var s=this.createDiagnosticsErrorInstance(e,t,r,i,a);s&&this.saveDiagnosticsErrorInDatabase(s)},createDiagnosticsErrorInstance:function(e,t,r,i,a){return this.validateDiagnosticsError(e)?newError={error:e,message:bizagi.util.escapeHtml(t),source:r,line:i,stackTrace:a,componentType:this.getCurrentDiagnosticsEventComponentType(),queueEvents:this.getCurrentDiagnosticsEventsQueue(),queueHTTP:this.getCurrentDiagnosticsHttpQueue(),userAgent:window.navigator.userAgent,when:bizagi.util.getCurrentDatetime(),timestamp:bizagi.util.getCurrentDatetimestamp(),retryCount:0}:(console.log("ERROR: => Don't possible throw error (error is required) ",this.Class.DIAGNOSTICS_COMPONENT_NAME),null)},getCurrentDiagnosticsHttpQueue:function(){return bizagi.services.ajax?bizagi.services.ajax.mobileHttpQueue:void 0},getCurrentDiagnosticsEventsQueue:function(){return this.getDataservice()?this.getDataservice().getQueueListEvents():void 0},getCurrentDiagnosticsEventComponentType:function(){var e=this.getDataservice()?this.getDataservice().getQueueListEvents():void 0,t=null;return e.length>0&&(t=e[e.length-1]),t?t.componentType:void 0},getDataservice:function(){return bizagiWorkportal.deviceFactory.workportal.dataService},getDiagnosticsDatabaseInstance:function(){return null==_typeof(bizagi.workportal.diagnostics.db)||bizagi.util.isMashupContext()?void 0:new bizagi.workportal.diagnostics.db},getDiagnosticsErrorInDatabase:function(e){return this.diagnosticstErrorsDb.getError(e)},saveDiagnosticsErrorInDatabase:function(e){return this.diagnosticstErrorsDb.saveError(e.timestamp,e)},deleteDiagnosticsErrorInDatabase:function(e){return this.diagnosticstErrorsDb.deleteError(e.timestamp)},deleteDiagnosticsErrorListInDatabase:function(e){for(var t=[],r=0;r<e.length;r++)t.push(this.deleteDiagnosticsErrorInDatabase(e[r].Message));return $.when.apply(t)},updateOrDeleteDiagnosticsErrorInDatabase:function(e){var t=e.Message;return t.retryCount>=this.Class.DIAGNOSTICS_PACKAGE_MAX_RETRY?this.diagnosticstErrorsDb.deleteError(t.timestamp):(t.retryCount=t.retryCount+1,this.diagnosticstErrorsDb.saveError(t.timestamp,t))},updateOrDeleteDiagnosticsErrorListInDatabase:function(e){for(var t=[],r=0;r<e.length;r++)t.push(this.updateOrDeleteDiagnosticsErrorInDatabase(e[r]));return $.when.apply(t)},getCurrentDiagnosticsErrorList:function(){return this.diagnosticstErrorsDb.getErrorsList(this.Class.DIAGNOSTICS_PACKAGE_MAX_ERRORS)},validateDiagnosticsError:function(e){var t=!1;return e&&this.diagnosticsServiceEnabled&&(t=!0),t},syncDiagnosticsError:function(){var e=this;e.getCurrentDiagnosticsErrorList().then((function(t){if(t.length>0){var r=e.getDiagnosticsPackageErrors(t);e.sendDiagnosticsErrorPackage(r)}}))},getDiagnosticsSystemErrorURL:function(){return this.serviceLocator.getUrl("diagnostics-sync-system-error")},getDiagnosticsPackageErrors:function(e){for(var t=0,r=[],i=0;i<e.length&&i<this.Class.DIAGNOSTICS_PACKAGE_MAX_ERRORS&&t<this.Class.DIAGNOSTICS_PACKAGE_MAX_SIZE_REQUEST_MB;i++){var a=e[i],s={DateTime:a.when,Username:bizagi.currentUser.user,Source:this.device,Title:a.message,Message:a},o=bizagi.util.getSizeJsonObjectInMegaBytes(s);(t+o<this.Class.DIAGNOSTICS_PACKAGE_MAX_SIZE_REQUEST_MB||0==r.length)&&(r.push(s),t+=o)}return r},sendDiagnosticsErrorPackage:function(e){var t=this,r=t.getDataservice();if(r&&r.online){var i=$.ajax({url:t.getDiagnosticsSystemErrorURL(),data:JSON.stringify(e),dataType:t.Class.DIAGNOSTICS_SYNC_AJAX_PARAMS.DATATYPE,type:t.Class.DIAGNOSTICS_SYNC_AJAX_PARAMS.TYPE,contentType:"application/json",avoidLoader:!0});$.when(i).then((function(r){return console.log("sync system error was sended <Respose>: ",r," <error_package>: ",e),t.deleteDiagnosticsErrorListInDatabase(e)})).fail((function(r){return console.log("sync system error was NOT sended <error_in_rest>: ",r," <error_package>: ",e),t.updateOrDeleteDiagnosticsErrorListInDatabase(e)}))}else console.log("Error in size request => ,",t.Class.DIAGNOSTICS_COMPONENT_NAME," Network status => ",r.online)}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{DIAGNOSTICS_OBSERVER_COMPONENT_NAME:"bizagi.workportal.services.service.diagnostics.observer",DIAGNOSTICS_OBSERVER_ELEMENT_OBSERVED:document.body,DIAGNOSTICS_OBSERVER_MAX_EVENTS_IN_QUEUE:10,DIAGNOSTICS_OBSERVER_MAX_PATH_EVENT:5,DIAGNOSTICS_OBSERVER_OBSERVER_OPTIONS:{attributes:!0,childList:!0,characterData:!0,subtree:!0},DIAGNOSTICS_OBSERVER_MAX_SIZE_HTML_EVENT_MB:1,DIAGNOSTICS_OBSERVER_COMPONENT_TYPES:{FORM:"form",DISCUSSIONS:"discussions",ACTION_SHEET:"action-sheet",FILES:"files",MAIN_MENU:"main-menu",SUMMARY_CASE:"summary-case"}},{init:function(e){this._super(e),this.diagnosticsServiceEnabled=bizagi.util.isMobileErrorTracesEnabled(),this.diagnosticsServiceEnabled&&(this.setDiagnosticsObserverDefaultData(),this.configureDiagnosticsObserverHandlers())},setDiagnosticsObserverDefaultData:function(){this.diagnosticsObserverEventsQueue=[],this.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},configureDiagnosticsObserverHandlers:function(){this.setTouchEndObserver(),this.eventsObserver()},setTouchEndObserver:function(){var e=this;window.ontouchend=null,window.ontouchend=function(t){e.addDiagnosticsObsercerEvent(e.getEventObject(t))}},eventsObserver:function(){var e=this;$(e.Class.DIAGNOSTICS_OBSERVER_ELEMENT_OBSERVED).ready((function(){new e.MutationObserver((function(){e.setTouchEndObserver()})).observe(e.Class.DIAGNOSTICS_OBSERVER_ELEMENT_OBSERVED,e.Class.DIAGNOSTICS_OBSERVER_OBSERVER_OPTIONS)}))},getQueueListEvents:function(){return this.diagnosticsObserverEventsQueue},getEventObject:function(e){return{type:e.type,componentType:e.composedPath?this.getDiagnosticsElementComponentType(e.composedPath()):void 0,dateTime:bizagi.util.getCurrentDatetime(),srcElement:e.composedPath?this.getDiagnosticsElementPath(e.composedPath()):void 0}},addDiagnosticsObsercerEvent:function(e){this.diagnosticsObserverEventsQueue.length>=this.Class.DIAGNOSTICS_OBSERVER_MAX_EVENTS_IN_QUEUE&&this.diagnosticsObserverEventsQueue.shift(),this.diagnosticsObserverEventsQueue.push(e)},getDataservice:function(){return bizagiWorkportal.deviceFactory.workportal.dataService},getDiagnosticsElementPath:function(e){var t=[];for(j=0;j<e.length&&j<this.Class.DIAGNOSTICS_OBSERVER_MAX_PATH_EVENT;j++){var r=$(e[j]),i={id:r.prop("id"),class:r.prop("class"),text:r.prop("innerText")};t.push(i)}return bizagi.util.getSizeJsonObjectInMegaBytes(t)<this.Class.DIAGNOSTICS_OBSERVER_MAX_SIZE_HTML_EVENT_MB?t:[]},getDiagnosticsElementComponentType:function(e){var t=this.validateDiagnosticsIfContainsElement;for(j=0;j<e.length;j++){var r=$(e[j]),i=this.getDiagnosticsElementComponentTypeByClass(r);if(i)return i;if(i=this.getDiagnosticsElementComponentTypeById(r))return i;if(this.validateDiagnosticsKendoView(r)&&t(">div.km-content",r)){if(t(">div.km-content >div.bz-form",r))return this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.FORM;if(t(">div.km-content div.bz-wp-box-discussion",r)||t(">div.km-content div.ui-bz-wp-discussions-box-main",r))return this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.DISCUSSIONS;if(t(">div.km-content div.bz-wp-box-files",r))return this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.FILES}}return bizagi.util.getLastProcessInboxInputTray()},getDiagnosticsElementComponentTypeByClass:function(e){var t=void 0;return e.hasClass("bz-form")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.FORM:e.hasClass("summary-case")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.SUMMARY_CASE:e.hasClass("bz-action-sheet")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.ACTION_SHEET:e.hasClass("bz-wp-box-discussion")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.DISCUSSIONS:e.hasClass("bz-wp-box-files")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.FILES:e.hasClass("menu-content")&&(t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.MAIN_MENU),t},getDiagnosticsElementComponentTypeById:function(e){var t=void 0;return"summary-case"==e.attr("id")?t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.SUMMARY_CASE:"menu-content"==e.attr("id")&&(t=this.Class.DIAGNOSTICS_OBSERVER_COMPONENT_TYPES.MAIN_MENU),t},validateDiagnosticsKendoView:function(e){return e.hasClass("km-view")&&"view"==e.attr("data-role")},validateDiagnosticsIfContainsElement:function(e,t){return $(e,t).length>0}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{DIAGNOSTICS_COMPONENT_NAME:"bizagi.workportal.services.service.diagnostics.error.observer",DIAGNOSTICS_WAIT_APPLICATION_STARTED:45e3},{init:function(e){this._super(e),this.diagnosticsServiceEnabled=bizagi.util.isMobileErrorTracesEnabled(),this.diagnosticsServiceEnabled&&this.configureDiagnosticsErrorObserverHandlers()},configureDiagnosticsErrorObserverHandlers:function(){var e=this;window.onerror=function(t,r,i,a,s){e.sendDiagnosticsError(s,t,r,i)},setTimeout((function(){e.getErrorsInAjaxImplementation()}),e.Class.DIAGNOSTICS_WAIT_APPLICATION_STARTED)},sendDiagnosticsError:function(e,t,r,i){var a=this.getDataservice();a&&null!=a.diagnosticstErrorsDb&&a.addDiagnosticsError(e,t,r,i)},getDataservice:function(){return bizagiWorkportal.deviceFactory.workportal.dataService},getJqueryAjax:function(){return bizagi.services.ajax},getErrorsInAjaxImplementation:function(){var e=this.getJqueryAjax();if(e&&e.mobileHttpErrorsQueue&&e.mobileHttpErrorsQueue.length>0)for(var t=0;t<e.mobileHttpErrorsQueue.length;t++)this.sendDiagnosticsError(e.mobileHttpErrorsQueue[t])}});
//# sourceMappingURL=../../../../Maps/tablet_ios_native/workportalnative.tablet.production.js.map
